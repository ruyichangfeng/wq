 <include file="Public/header.html" />
<link rel="stylesheet" type="text/css" href="__ROOT__/Public/lib/froala_editor/css/font-awesome.min.css?1">
<link rel="stylesheet" type="text/css" href="__ROOT__/Public/lib/froala_editor/css/froala_editor.min.css" >
<link rel="stylesheet" type="text/css" href="__ROOT__/Public/lib/layui/css/modules/laydate/default/laydate.css" >
</head>

<body>
	<div class="x-nav">
		<span class="layui-breadcrumb">
              <a><cite>首页</cite></a>
              <a><cite>规则管理</cite></a>
            </span>
		<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right;height:30px;padding: 0 15px;"  href="javascript:location.replace(location.href);" title="刷新"><i class="layui-icon" style="line-height:30px">ဂ</i></a>
	</div>
	<div class="x-body">
		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
			<ul class="layui-tab-title">
				<li class="layui-this">规则设置</li>
			</ul>
			<div class="layui-tab-content">
				<div class="layui-tab-item layui-show">
					<form id="form-article-add" class="layui-form layui-form-pane">
						<div class="layui-form-item">
							<label class="layui-form-label">
                                <span class='x-red'>*</span>金币名称
                            </label>
							<div class="layui-input-block">
								<input type="text" name="coinname" lay-verify="coinname" value="{$rule['coinname']}" autocomplete="off" placeholder="崛企币" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                                <span class='x-red'>*</span>锤子名称
                            </label>
							<div class="layui-input-block">
								<input type="text" name="hammername" autocomplete="off" placeholder="金刚锤" value="{$rule['hammername']}" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">
                                <span class='x-red'>*</span>金币单价
                            </label>
							<div class="layui-input-block">
								<input type="text" name="coinprice" autocomplete="off" value="{$rule['coinprice']}" placeholder="空制在80个汉字，160个字符以内" class="layui-input">
								<span style="color: red; font-size: 12px;font-weight:bold">建议1元等于4个金币</span>
							</div>
						</div>
						
						<fieldset>
							<legend>分享送锤子规则</legend>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label"  style="width: 150px;">被邀请人免费获得</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="tjrs" value="{$rule['tjrs']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">把锤子，注册后邀请人获得</div>
									<div class="layui-input-inline" style="width: 150px;">
										<input type="text" name="czgs" value="{$rule['czgs']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">把锤子</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label"  style="width: 150px;">被邀请人每消费</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="byqrxf" value="{$rule['byqrxf']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">个金币，邀请人获得</div>
									<div class="layui-input-inline" style="width: 150px;">
										<input type="text" name="yqrhd" value="{$rule['yqrhd']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">把锤子</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">红包1：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="hb1gs" value="{$rule['hb1gs']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">个锤子，中奖权重：</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="weight1" value="{$rule['weight1']}" class="layui-input" type="text"  autocomplete="off">
									</div>
								</div>
							</div>
							
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">红包2：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="hb2gs" value="{$rule['hb2gs']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">个锤子，中奖权重：</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="weight2" value="{$rule['weight2']}" class="layui-input" type="text"  autocomplete="off">
									</div>
								</div>
							</div>
							
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">红包3：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="hb3gs" value="{$rule['hb3gs']}" autocomplete="off" class="layui-input">
									</div>
									<div class="layui-form-mid">个锤子，中奖权重：</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="weight3" value="{$rule['weight3']}" class="layui-input" type="text"  autocomplete="off">
									</div>
								</div>
							</div>
						</fieldset>
						<fieldset>
							<legend>做任务送锤子规则</legend>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label" style="width: 120px;">完善个人资料</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="my_data" value="{$rule['my_data']}" autocomplete="off" class="layui-input">
									</div>									
									<div class="layui-form-mid">把锤子</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">填写地址</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="area" value="{$rule['area']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">把锤子</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">验证手机号</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="phone" value="{$rule['phone']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">把锤子</div>
								</div>
							</div>
						</fieldset>
						
						<fieldset>
							<legend>晒单送锤子规则</legend>
							<div class="layui-form-item" pane="">								
								<label class="layui-form-label" style="width: 120px;">赠送方式</label>
								<div class="layui-input-block" style="left: 10px;">
									<input type="radio" name="sd_type" value="1" title="首次赠送" <?php if($rule['sd_type']==1){ echo 'checked';} ?> >
      								<input type="radio" name="sd_type" value="2" title="每天赠送一次" <?php if($rule['sd_type']==2){ echo 'checked';} ?> >   
      				
								</div>																										
							</div>
							
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label" style="width: 120px;">最低评论字数</label>
									<div class="layui-input-inline">
										<input type="text" name="sd_zs" value="{$rule['sd_zs']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">字符</div>
								</div>
							</div>
							
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label" style="width: 120px;">锤子数量</label>
									<div class="layui-input-inline">
										<input type="text" name="sd_num" value="{$rule['sd_num']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">把</div>
								</div>
							</div>							
						</fieldset>
						
						<fieldset>
							<legend>结束返现抽奖规则</legend>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label" style="width: 120px;">奖池返现：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="truebfb" value="{$rule['truebfb']}" autocomplete="off" class="layui-input">
									</div>									
									<div class="layui-form-mid">倍</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">最低返现：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="min" value="{$rule['min']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">倍</div>
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">最高返现：</label>
									<div class="layui-input-inline" style="width: 100px;">
										<input type="text" name="max" value="{$rule['max']}" autocomplete="off" class="layui-input">
									</div>								
									<div class="layui-form-mid">倍</div>
								</div>
							</div>
						</fieldset>
						
						<fieldset>
							<legend>分享 设置</legend>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label" >分享标题</label>
									<div class="layui-input-inline" style="width: 500px;">
										<input type="text" name="sharetitle" value="{$rule['sharetitle']}" autocomplete="off" class="layui-input">
									</div>									
								</div>
							</div>
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">分享描述</label>
									<div class="layui-input-inline" style="width: 1000px;">
										<input type="text" name="sharedesc" value="{$rule['sharedesc']}" autocomplete="off" class="layui-input">
									</div>								
								</div>
							</div>
							<div class=" layui-form-item">
					      		<label class="layui-form-label" >分享图标</label>
						      	<div class="layui-input-block">
						      	  	<button type="button" class="layui-btn" onclick="$('#sharelogo').click();">
								     	<i class="layui-icon">&#xe67c;</i>上传图片
								 	</button>
								  	<input style="display: none;" type="file" id="sharelogo"  onchange="previewImage(this,2,'sharelogo_val')"   multiple  class="input-file">
				                </div>
			                   	<img id="imghead2" border="0"  style="margin-top: 5px;max-height:150px;"                   	
			                   	<?php 
			                   	   	if( empty($rule['sharelogo']) ){
			                   	   	   	echo 'src="__ROOT__/Public/images/icon.jpg"   onclick="$(\'#sharelogo\').click();"';
			                   	   	}else{
			                   	       	echo 'src="__ROOT__/Uploads/'.$rule['sharelogo'].'"';
			                   	   	}
			                    ?>
			                   >
					      	</div>
						</fieldset>
						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">联系我们</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="lianxi"  id='lianxi_edit' name="lianxi" class="layui-textarea"><?php if(empty($rule['lianxi'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['lianxi']; } ?></textarea>
						    </div>
						</div>

						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">锤子换取规则</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="hqgz"  id='hqgz_edit' name="hqgz" class="layui-textarea"><?php if(empty($rule['hqgz'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['hqgz']; } ?></textarea>
						    </div>
						</div>
						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">邀请规则</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="yqgz"  id='yqgz_edit' name="yqgz" class="layui-textarea"><?php if(empty($rule['yqgz'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['yqgz']; } ?></textarea>
						    </div>
						</div>
						 
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">竞拍规则</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="cjwt"  id='cjwt_edit' name="cjwt" class="layui-textarea"><?php if(empty($rule['cjwt'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['cjwt']; } ?></textarea>
						    </div>
						</div>
						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">用户协议</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="yhxy"  id='yhxy_edit' name="yhxy" class="layui-textarea"><?php if(empty($rule['yhxy'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['yhxy']; } ?></textarea>
						    </div>
						</div>
						
						
						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">分享后活动规则</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="fxhdgz"  id='fxhdgz_edit' name="fxhdgz" class="layui-textarea"><?php if(empty($rule['fxhdgz'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['fxhdgz']; } ?></textarea>
						    </div>
						</div>
						
						<div class="layui-form-item layui-form-text">
						    <label class="layui-form-label">奖池返现规则</label>
						    <div class="layui-input-block">
						      <textarea placeholder="请输入内容"  lay-verify="cashbackrule"  id='cashbackrule_edit' name="cashbackrule" class="layui-textarea"><?php if(empty($rule['cashbackrule'])){ echo '<p></p><p></p><p></p>';}else{ echo $rule['cashbackrule']; } ?></textarea>
						    </div>
						</div>
						
						<fieldset>
							<legend>免费送锤子规则</legend>
							<span style="color: red; font-size: 12px;font-weight:bold">注意：为了让该功能更灵活的自定义，故下面配置不好通过程序来验证正确性。各位可以根据前台冻结金币送锤子来测试效果。前台选择产生多少个匹配结果，就需要添加多少条数据。</span><br />
							<span style="color: red; font-size: 12px;font-weight:bold">例如：若锁定时间固定为4天，16天，32天，64天，锁定40金币，则共有4条数据。锁定其他金额的话，每次也需要加对应的4条数据，这个和锁定时间有关系。</span>
							<div class="layui-form-item" id="p_type">
								<div class="layui-form layui-form-pane">
									<label class="layui-form-label" style="width: 120px;">锁定金币
						      	<span class="layui-btn layui-btn-small" style="height: 18px;line-height: 18px; padding: 0px 3px;" onclick="add_guize()" >
						      		<i class="layui-icon"></i>
						      	</span>
						      </label>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="sdjb[]" value="{$rule['sdjb'][0]}" class="layui-input" type="text" placeholder="￥" autocomplete="off">
									</div>
									<div class="layui-form-mid">个，锁定时间</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="sdsj[]" value="{$rule['sdsj'][0]}" class="layui-input" type="text" placeholder="￥" autocomplete="off">
									</div>
									<div class="layui-form-mid">天,送锤子</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="sczgs[]" value="{$rule['sczgs'][0]}" class="layui-input" type="text" placeholder="0" autocomplete="off">
									</div>
									 <div class="layui-form-mid">个</div>
								</div>
							</div>
	
							<div id="p_type1">
								<for start="1" end="$sdjbcount">
									<div class="layui-form-item" id='dd{$i}'>
										<div class="layui-form layui-form-pane">
											<label class="layui-form-label" style="width: 120px;">锁定金币
							      	<span class="layui-btn layui-btn-small" style="height: 18px;line-height: 18px; padding: 0px 3px;" onclick="delt('dd{$i}')" >
							      		<i class="layui-icon"></i>
							      	</span>
							      </label>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="sdjb[]" value="{$rule['sdjb'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											<div class="layui-form-mid">个，锁定时间</div>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="sdsj[]" value="{$rule['sdsj'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											<div class="layui-form-mid">天,送锤子</div>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="sczgs[]" value="{$rule['sczgs'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											 <div class="layui-form-mid">个</div>
										</div>
									</div>
								</for>
							</div>
						</fieldset>
						
						
						<fieldset>
							<legend>金币充值规则</legend>
								<div class="layui-form-item" id="p_type_2">
									<div class="layui-form layui-form-pane">
										<label class="layui-form-label" style="width: 120px;">充值
							      	<span class="layui-btn layui-btn-small" style="height: 18px;line-height: 18px; padding: 0px 3px;" onclick="add_jbguize()" >
							      		<i class="layui-icon"></i>
							      	</span>
							     </label>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="czjb[]" value="{$rule['czjb'][0]}" class="layui-input" type="text" placeholder="￥" autocomplete="off">
									</div>
									<div class="layui-form-mid">个金币，需要</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="jbjg[]" value="{$rule['jbjg'][0]}" class="layui-input" type="text" placeholder="￥" autocomplete="off">
									</div>
									<div class="layui-form-mid">元,送锤子</div>
									<div class="layui-input-inline" style="width: 100px;">
										<input name="sczgs2[]" value="{$rule['sczgs2'][0]}" class="layui-input" type="text" placeholder="0" autocomplete="off">
									</div>
									 <div class="layui-form-mid">个</div>
								</div>
							</div>
	
							<div id="p_type2">
								<for start="1" end="$czjbcount">
									<div class="layui-form-item" id='dd2{$i}'>
										<div class="layui-form layui-form-pane">
											<label class="layui-form-label" style="width: 120px;">充值
							      	<span class="layui-btn layui-btn-small" style="height: 18px;line-height: 18px; padding: 0px 3px;" onclick="delt2('dd2{$i}')" >
							      		<i class="layui-icon"></i>
							      	</span>
							      </label>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="czjb[]" value="{$rule['czjb'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											<div class="layui-form-mid">个金币，需要</div>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="jbjg[]" value="{$rule['jbjg'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											<div class="layui-form-mid">元,送锤子</div>
											<div class="layui-input-inline" style="width: 100px;">
												<input name="sczgs2[]" value="{$rule['sczgs2'][$i]}" class="layui-input" type="text" placeholder="" autocomplete="off">
											</div>
											 <div class="layui-form-mid">个</div>
										</div>
									</div>
								</for>
							</div>
						</fieldset>
    						
						<div class="layui-form-item">
							<button type="button" class="layui-btn" lay-submit="" lay-filter="subfrom">
                                保存
                            </button>
                            <input type="hidden" id="sharelogo_val" value="" >
						</div>
					</form>
					<div style="height:100px;"></div>
				</div>
			</div>
		</div>
	</div>
	<include file="Public/footer.html" />
	<script type="text/javascript" src="__ROOT__/Public/js/jquery.min.js"></script>
    <script type="text/javascript" src="__ROOT__/Public/js/tools.js"></script> 
	<script type="text/javascript" src="__ROOT__/Public/lib/froala_editor/js/froala_editor.min.js"></script>
	<script type="text/javascript" src="__ROOT__/Public/lib/froala_editor/js/plugins/colors.min.js"></script>
	<script type="text/javascript" src="__ROOT__/Public/lib/froala_editor/js/plugins/font_family.min.js"></script>
	<script type="text/javascript" src="__ROOT__/Public/lib/froala_editor/js/plugins/font_size.min.js"></script>
	<script type="text/javascript" src="__ROOT__/Public/lib/froala_editor/js/langs/zh_cn.js"></script>
	<script>
		
		$('#hqgz_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		
		$('#lianxi_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		$('#cjwt_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		$('#yhxy_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		$('#yqgz_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		
		$('#fxhdgz_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		$('#cashbackrule_edit').editable({
			 inlineMode: false,
			 language: "zh_cn",
			 alwaysBlank: true, 
			 imageUploadURL:"{:U('Home/MainCtr/Goods/upload_img')}",
		})
		
		
		
		var id=10;
		
		function add_guize(){ 
		  	  $("#p_type").clone(true).find('span').attr("onclick","delt('dd"+id+"');").html('<i class="layui-icon"></i>')
		  	  .parent().parent().parent().attr("id","dd"+id)
		  	  .appendTo("#p_type1");
		  	  id++;
		}
		
		function delt(id){
		  	  $("#"+id).remove();
		}
		
		function add_jbguize(){ 
		  	  $("#p_type_2").clone(true).find('span').attr("onclick","delt2('dd2"+id+"');").html('<i class="layui-icon"></i>')
		  	  .parent().parent().parent().attr("id","dd2"+id)
		  	  .appendTo("#p_type2");
		  	  id++;
		}
		
		function delt2(id){
		  	  $("#"+id).remove();
		}
		
		layui.use(['form','element', 'layedit'], function() {
			var form = layui.form,
				layedit = layui.layedit;
			$ = layui.jquery;

			layedit.set({
				uploadImage: {
					url: "{:U('Home/MainCtr/rule/uploadImg')}",
					type: 'post' //默认post
				}
			});
			//创建一个编辑器
			var editLianxi = layedit.build('lianxi');
			var editHqgz = layedit.build('hqgz');
			var editCjwt = layedit.build('cjwt');
			var editYhxy = layedit.build('yhxy');
			var editYqgz = layedit.build('yqgz');

			form.verify({
				coinname: function(value) {
					layedit.sync(editLianxi);
					layedit.sync(editHqgz);
					layedit.sync(editCjwt);
					layedit.sync(editYqgz);
					layedit.sync(editYhxy);
					if(value.length < 2) {
						return '标题至少得2个字符！';
					}
				}
			});
			/*var sdsj =new Array();
			$("input[name='sdsj[]']").each(function(){
				$val = $(this).val();
				sdsj.push($val);
			});	
			
			
			var sdjb =new Array();
			$("input[name='sdjb[]']").each(function(){
				$val = $(this).val();
				sdjb.push($val);
			});	
			alert(sdsj);
			alert(sdjb);
			var sdsjqc=unique5(sdsj);
			var sdjbqc=unique5(sdjb);
			if(){
				
			}*/
			//if(sdsj)
			//监听提交
			form.on('submit(subfrom)', function(datas) {
				
				
				
				var tjing = layer.msg('提交中...', {icon: 16,shade: 0.3,time: 60*1000}); 
		        var form=document.forms[0];
		        
			    var formData = new FormData(form); 
			    
			   	if($("#sharelogo_val").val()!=''){
			      	formData.append("sharelogo",convertBase64UrlToBlob($("#sharelogo_val").val()));
				} 
				$.ajax({
					type: 'POST',
					url: "{:U('Home/MainCtr/Rule/rule_insert')}",
					 data :formData,
			         dataType:"text",
			         processData : false,         
			         contentType : false,   
					 success: function(data) {
						if(data == '1') {
							layer.msg('提交成功', {
								icon: 1,
								offset: '40%',
								time: 2000,
								shade: 0.3
							}, function() {
								location.reload();
							});
						} else if(data == '2') {
							layer.msg('提交失败', {
								icon: 2,
								offset: '40%',
								time: 2000,
								shade: 0.3
							});
						} else {
							layer.msg(data, {
								icon: 2,
								offset: '40%',
								time: 2000,
								shade: 0.3
							});
						}
					}
				});
				return false;
			});
		});
		
		// 思路：获取没重复的最右一值放入新数组 
		function unique5(array){ 
		var r = []; 
		for(var i = 0, l = array.length; i < l; i++) { 
		 for(var j = i + 1; j < l; j++) 
		  if (array[i] === array[j]) j = ++i; 
		 r.push(array[i]); 
		 } 
		 return r; 
		}
		
		function previewImage(file,flag,ob){		
		     var img =$('#imghead'+flag);
		     var oFile = file.files[0]; 	    
		     if(!new RegExp("(jpg|jpeg|png)+","gi").test(oFile.type)){  
		          layer.msg("图片上传：文件类型必须是JPG、JPEG、PNG", {icon: 2,offset: '40%',time:2000,shade: 0.3});
		          return;  
		     }
		     var reader = new FileReader();  
		     var tjing =  layer.msg('图片加载中', {icon: 16,shade: 0.3,time: 60*1000});
		     reader.onload = function(e) {  
		        var base64Img= e.target.result;
		        var _ir=ImageResizer({  
		        resizeMode:"auto"  
		        ,dataSource:base64Img  
		        ,dataSourceType:"base64"  
		        ,maxWidth:1200   
		        ,maxHeight:1200 
		        ,onTmpImgGenerate:function(img){ }   
		        ,success:function(resizeImgBase64,canvas){
				layer.close(tjing);
				img.attr("src",resizeImgBase64);  
			    $('#'+ob).val(resizeImgBase64.substr(22));
				
		        },debug:false});            
		     };  
		     reader.readAsDataURL(oFile);  
		}
		
		function convertBase64UrlToBlob(urlData){
		    var bytes=window.atob(urlData.split(',')[1]);    
		    var ab = new ArrayBuffer(bytes.length);
		    var ia = new Uint8Array(ab);
		    for (var i = 0; i < bytes.length; i++) {
		        ia[i] = bytes.charCodeAt(i);
		    }
		    return new Blob( [ab] , {type : 'image/jpg'});
		}
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
</body>

</html>