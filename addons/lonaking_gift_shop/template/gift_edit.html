{template 'common/header'}
<div class="main">
	<ul class="nav nav-tabs">
		<li class=""><a href="{php echo $this->createWebUrl('shopManage');}">商户管理</a></li>
		<li class=""><a href="{php echo $this->createWebUrl('terminalManage');}">核销终端管理</a></li>
		<li class="active"><a href="{php echo $this->createWebUrl('giftManage');}">礼品管理</a></li>
		<li class=""><a href="{php echo $this->createWebUrl('adminManage');}">管理员管理</a></li>
		<li><a href="{php echo $this->createWebUrl('adManage');}">广告管理</a></li>
		<li><a href="{php echo $this->createWebUrl('giftOrderManage');}">兑换记录</a></li>
		<li><a href="{php echo $this->createWebUrl('checkRecordManage');}">核销记录</a></li>
		<li><a href="{php echo $this->createWebUrl('tplNoticeConfig');}">模板消息设置</a></li>
		<li><a href="{php echo $this->createWebUrl('updatePage');}">手动更新</a></li>
	</ul>
	<form class="form-horizontal form" id="setting-form" action=""
		method="post">
		<div class="panel panel-default">
			<div class="panel-heading">基本信息设置</div>
			<div class="panel-body">
				<!-- id-->
				<div class="form-group hide">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">id</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[id]"
							value="{$gift['id']}" />
							<span class="help-block">id,隐藏</span>
					</div>
				</div>
				<!-- name-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">礼品名称</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[name]"
							value="{$gift['name']}" required/>
							<span class="help-block">礼品名称，建议字数不要太多</span>
					</div>
				</div>
				<!-- 排序-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">排序</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[sort]"
							   value="{$gift['sort']}" required/>
						<span class="help-block">排序越高，越在前面展示,默认为1</span>
					</div>
				</div>
				<!-- 类别 -->
				<div class="form-group hide">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">礼品类别</label>
					<div class="col-sm-8">
						<select name="gift[type]" class='form-control'>
							{loop $gift_type $type}
								<option value="{$type}" {if $gift['type'] == $type} selected{/if}>{$type}</option>
							{/loop}
						</select>
					</div>
				</div>
				<!-- 商户-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">商户名称</label>
					<div class="col-sm-8">
						<select name="gift[shop_id]" class='form-control'>
							<option value="" >----请选择----</option>
							{loop $shops $shop}
							<option value="{$shop['id']}" {if $gift['shop_id'] == $shop['id']} selected{/if}>{$shop['name']}</option>
							{/loop}
						</select>
					</div>
				</div>
				<!-- 礼品模式 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">礼品模式</label>
					<div class="col-sm-8">
						<select name="gift[mode]" class='form-control' id="gift-mode-selector">
							<option value="1" {if $gift['mode'] == 1} selected{/if}>微信红包(认证服务号可用)</option>
							<option value="2" {if $gift['mode'] == 2} selected{/if}>充值卡</option>
							<option value="3" {if $gift['mode'] == 3} selected{/if}>实物礼品</option>
							<option value="4" {if $gift['mode'] == 4} selected{/if}>自领礼品(用户前往某地自行领取)</option>
							<option value="5" {if $gift['mode'] == 5} selected{/if}>优惠券(需要使用商家优惠券模块)</option>
						</select>
						<span class="help-block">这里选择礼品的模式是什么，不同的模式用户兑换礼品所需要的资料是不同的</span>
					</div>
				</div>

				<!-- 价格 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">所需积分</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[price]"
							value="{$gift['price']}" />
						<span class="help-block">需要此数量积分才可兑换该礼品</span>
					</div>
				</div>
				<!-- 剩余 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">数量</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[num]"
							value="{$gift['num']}" />
						<span class="help-block">剩余数量</span>
					</div>
				</div>
				<!-- 领取限制 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">领取限制</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[limit_num]"
							   value="{$gift['limit_num']}" />
						<span class="help-block">每人限制兑换次数，0为不限制</span>
					</div>
				</div>
				<!-- 状态 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">状态</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[status]" value="1" {if $gift['status'] == '1'}checked="true"{/if}> 在售
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[status]" value="0" {if $gift['status'] == '0'}checked="true"{/if}>停止
						</label>
						<span class="help-block">设置礼品开放兑换或者停止兑换</span>
					</div>
				</div>

				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">购买成功后跳转</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[success_redirect]"
							   value="{$gift['success_redirect']}" />
						<span class="help-block">默认为空，用户兑换成功后，将会跳转到此页面，不设置将不跳转</span>
					</div>
				</div>

				<!-- 是否自动审核-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">状态</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[auto_success]" value="1" {if $gift['auto_success'] == '1'}checked="true"{/if}> 自动通过
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[auto_success]" value="0" {if $gift['auto_success'] == '0'}checked="true"{/if}>人工审核
						</label>
						<span class="help-block">设置礼品开放兑换或者停止兑换</span>
					</div>
				</div>
				<!-- 是否抽奖模式-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">是否抽奖模式</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[raffle]" value="1" {if $gift['raffle'] == '1'}checked="true"{/if}> 抽奖模式
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[raffle]" value="0" {if $gift['raffle'] == '0'}checked="true"{/if}>普通模式
						</label>
						<span class="help-block">设置为抽奖模式后，用户兑换该礼品，可能不会得到礼品，中奖的概率请在下面设置</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">是否隐藏</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[hide]" value="1" {if $gift['hide'] == '1'}checked="true"{/if}> 隐藏
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[hide]" value="0" {if $gift['hide'] == '0'}checked="true"{/if}>不隐藏
						</label>
						<span class="help-block">设置礼品是否隐藏，当举办一些线下活动的时候，特殊时期的礼品可能只对待特殊人群</span>
					</div>
				</div>
				<!-- 图片-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">礼品图片</label>
					<div class="col-sm-8">
						{php echo tpl_form_field_image('gift[pic]', $gift['pic'])}
						<span class="help-block">礼品图片，建议大小230*200</span>
					</div>
				</div>
				<!-- 礼品详情-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">礼品详情</label>
					<div class="col-sm-8">
						{php echo tpl_ueditor('gift[description]', $gift['description']);}
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default " style="display: none" id="raffle-mode">
			<div class="panel-heading">抽奖模式配置</div>
			<div class="panel-body">
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机下限</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[raffle_min]"
							   value="{$gift['raffle_min']}" />
						<span class="help-block"></span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机上限</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[raffle_max]"
							   value="{$gift['raffle_max']}" />
						<span class="help-block"></span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机数命中</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[raffle_send_num]"
							   value="{$gift['raffle_send_num']}" />
						<span class="help-block">系统会随机上限和下限中取出1个数，若与这里设置的随机数命中某个数字相等，则抽奖成功，否则为未抽到奖。设置案例：1,5,20,36,100</span>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default select-panel" style="display: none" id="mode-detail-1">
			<div class="panel-heading">微信红包模式配置</div>
			<div class="panel-body">
				<!-- 红包价格 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">红包金额</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[hongbao_money]"
							   value="{$gift['hongbao_money']}" />
						<span class="help-block">单位:分!1元＝100分,10元＝1000分,当礼品模式为红包的时候，这个设置才会生效,若红包模式为随机红包，此金额将会成为红包的基础金额，实际金额为此金额＋随机数</span>
					</div>
				</div>
				<!-- 是否随机红包-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">红包模式</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[hongbao_mode]" value="1" {if $gift['hongbao_mode'] == '1'}checked="true"{/if}> 定额红包
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[hongbao_mode]" value="2" {if $gift['hongbao_mode'] == '2'}checked="true"{/if}> 随机红包
						</label>
						<span class="help-block">随机红包将会发出随机红包金额</span>
					</div>
				</div>
				<!-- 随机红包 设置-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机加成下限</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[hongbao_min]"
							   value="{$gift['hongbao_min']}" />
						<span class="help-block">单位:分！若红包为随机红包，这一项请务必设置,建议为0</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机加成上限</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[hongbao_max]"
							   value="{$gift['hongbao_max']}" />
						<span class="help-block">单位:分！若红包为随机红包，这一项请务必设置</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">随机数命中</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[hongbao_send_num]"
							   value="{$gift['hongbao_send_num']}" />
						<span class="help-block">系统会随机在随机红包上限和下限中取出1个数，若与这里设置的某个数字相等，则用户会抢到随机红包金额为基础红包+随机数＝总红包金额的红包奖励，若没有在随机数中，用户只能获得基础红包。设置案例：1,5,20,36,100</span>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-defaul select-panelt" style="display: none" id="mode-detail-2">
			<div class="panel-heading">话费充值模式配置</div>
			<div class="panel-body">
				<!-- 充值话费金额 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">话费金额</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[mobile_fee_money]"
							   value="{$gift['mobile_fee_money']}" />
						<span class="help-block">当礼品模式为充值卡的时候，这个设置才会生效</span>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default select-panel" style="display: none" id="mode-detail-3">
			<div class="panel-heading">实物礼品模式配置</div>
			<div class="panel-body">
				<!-- 支付方式-->
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">支付方式</label>
					<div class="col-sm-9">
						<label class="radio-inline">
							<input type="radio" name="gift[pay_way_switch]" value="1" {if $gift['pay_way_switch'] == '1'}checked="true"{/if}> 微信支付
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[pay_way_switch]" value="2" {if $gift['pay_way_switch'] == '2'}checked="true"{/if}> 货到付款
						</label>
						<label class="radio-inline">
							<input type="radio" name="gift[pay_way_switch]" value="3" {if $gift['pay_way_switch'] == '3'}checked="true"{/if}> 微信支付+货到付款
						</label>
						<span class="help-block">设置礼品开放兑换或者停止兑换</span>
					</div>
				</div>
				<!-- 实物礼品的邮费设置 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">邮费</label>
					<div class="col-sm-8">
						<input type="number" class="form-control" name="gift[send_price]"
							   value="{$gift['send_price']}" />
						<span class="help-block">当礼品模式为实物礼品的时候，这个设置才会生效</span>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default select-panel" style="display: none" id="mode-detail-4">
			<div class="panel-heading">自领礼品模式配置</div>
			<div class="panel-body">
				<!-- 自领礼品位置 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">领取地点</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[ziling_address]"
							   value="{$gift['ziling_address']}" />
						<span class="help-block">当礼品模式为自领模式的时候，这个设置才会生效</span>
					</div>
				</div>
				<!-- 自领礼品电话 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">联系方式</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[ziling_mobile]"
							   value="{$gift['ziling_mobile']}" />
						<span class="help-block">当礼品模式为自领模式的时候，这个设置才会生效</span>
					</div>
				</div>
				<!-- 自领礼品核销密码 -->
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">核销密码</label>
					<div class="col-sm-8">
						<input type="text" class="form-control" name="gift[check_password]"
							   value="{$gift['check_password']}" />
						<span class="help-block">核销密码,管理员绑定的时候，输入此密码即可与该礼品绑定，绑定后就可以核销这个礼品</span>
					</div>
				</div>
			</div>
		</div>
		<div class="panel panel-default select-panel" style="display: none" id="mode-detail-5">
			<div class="panel-heading">优惠券选择：注意，如果选择优惠券，所有优惠券信息需要前往优惠券模块设置，这里的设置将无效</div>
			<div class="panel-body">
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">选择优惠券</label>
					<div class="col-sm-8">
						<select name="gift[coupon_id]" class='form-control'>
							{loop $coupons $c}
							<option value="{$c['id']}" {if $gift['coupon_id'] == $c['id']} selected{/if}>{$c['name']}</option>
							{/loop}
						</select>
					</div>
				</div>
			</div>
		</div>
		<div class="form-group col-sm-12">
			<input name="token" type="hidden" value="{$_W['token']}" /> <input
				type="submit" class="btn btn-primary col-lg-1" name="submit"
				value="提交" />
		</div>
	</form>
</div>
{php $this->giftService->checkRegister($this->module);}
<script type="text/javascript">
	$(function(){
		showRight();
		$("#gift-mode-selector").change(function () {
			showRight();
		});
		$('input[name="gift[raffle]"]').change(function () {
			showRight();
		})
	});
	function showRight(){
		var mode = $("#gift-mode-selector").val();
		var raffle = $('input[name="gift[raffle]"]:checked').val();
		var select = "#mode-detail-"+mode;
		$(".select-panel").hide();
		$(select).show();
		if(raffle == 1){
			$("#raffle-mode").show();
		}else {
			$("#raffle-mode").hide();
		}
	}
</script>
{template 'common/footer'}