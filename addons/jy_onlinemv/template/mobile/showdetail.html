{template 'inc/header'}
<style type="text/css">
	.hd-box{height:30px;line-height:30px;width:100%;margin-top:-6px;background-color:#fff;}
	.hd-box-div{max-width:100px;float:right;margin-left:5px;padding-top:4px;}
	.l-name{padding:1px 3px;border-radius:4px;color:{$setting['color']};border:1px solid {$setting['color']};}
	.mn-title{width:18%;float:left;border:1px solid {$setting['color']};}
	.menu-one{border-top-left-radius:30px;border-bottom-left-radius:30px;height:38px;line-height:38px;}
	.menu-two{border-top-right-radius:30px;border-bottom-right-radius:30px;height:38px;line-height:38px;}
	#user-comment{width:100%;height:40px;line-height:40px;padding-left:5px;}
	.btn-mess{color:#ffffff;font-size:14px;float:right;padding:3px 10px;border-radius:6px;}
	.font-color{color:#9b9a9a;font-size:14px;}
</style>
<body>
	<header class="swiper-container" style="max-height:244px;">
		{if $setting['type'] == 1}
	        {if $member == 1 || $member == 3}
	        	<!-- <a href="{php echo $this->createMobileUrl('video',array('id'=>$infos['id']));}">
	        		<img src="{php echo tomedia($infos['thumb'])}" width="100%" style="max-height:214px;" />
	        	</a> -->
	        	<video id="shake_action" src="{$authUrl}" controls="controls" autoplay="autoplay" style="max-height:214px;" width="100%" >您的浏览器不支持</video>
			{else}
				<!-- <a href="{php echo $this->createMobileUrl('proved',array('id'=>$infos['id']));}">
	        		<img src="{php echo tomedia($infos['thumb'])}" width="100%" style="max-height:214px;" />
	        	</a> -->
	        	<video id="shake_action" src="{$authUrl}" controls="controls" autoplay="autoplay" style="max-height:214px;" width="100%" >您的浏览器不支持</video>
			{/if}
		{/if}
		{if $setting['type'] == 2}
			<div style="max-height:214px;" id="show-video">
				{if $member == 1 || $member == 3}
					{php echo htmlspecialchars_decode($infos['l_video_address']);}
				{else}
					{php echo htmlspecialchars_decode($infos['s_video_address']);}
				{/if}
			</div>		
		{/if}
	    

		<div class="hd-box" style="">
			<div class="hd-box-div" style="margin-right:17px;">
				<img src="../addons/jy_onlinemv/images/mess.png" alt="icon" style="width:15px;height:15px;margin-right:5px;" />
				<p style="float:right;margin-top:-3px;" id="messages">{php echo $infos['comnum']}</p>
			</div>
			
			<div id="inter-love" class="hd-box-div" style="">
				{if $dolike}
				<img src="../addons/jy_onlinemv/images/heart2.png" alt="icon" style="width:15px;height:15px;margin-right:5px;" />
				{else}
				<img src="../addons/jy_onlinemv/images/heart3.png" alt="icon" style="width:15px;height:15px;margin-right:5px;" />
				{/if}
				<p style="float:right;margin-top:-3px;" id="loves">{php echo $infos['dolike']}</p>
			</div>
			<div id="user-share" class="hd-box-div" style="">
				<img src="../addons/jy_onlinemv/images/share.png" alt="icon" style="width:13px;height:13px;margin-right:5px;" />
				<p style="float:right;margin-top:-3px;" id="shares">{php echo $infos['share']}</p>
			</div>
		</div>
	</header>
	<section>
		<div class="storeinfo" style="margin-top:1px;margin-bottom:2px;padding:7px 5% 11px;">
			<div class="s-name">
				<div class="nm" style="color:#414141;font-size:18px;">{$infos['videoname']}</div>
				
			</div>
			<div class="poi" style="margin-top:3px;">
				{loop $linfo $item}
					<span class="l-name">{$item['name']}</span>
				{/loop}
			<div style="color:#414141;float:right;">{php echo date("Y年m月d日",$infos['createtime']);}</div>	
			</div>
			
		</div>
		{if $infos['isopenm'] == 1}
		<div class="showcontent" style="height:23px;min-height:23px;padding:9px 5%;">
			<div class="title" style="font-size:17px;{if $setting['color']} color:{$setting['color']}; {/if}" >{$infos['mdwz']}</div>
		</div>
		{loop $valist $row}
			<div class="showcontent" style="min-height:18px;padding:9px 5% 14px;margin-top:1px;">
				<div style="width:70%;float:left;height:25px;overflow:hidden;">
					<span style="color:#9b9a9a;font-size:16px;">{$row['btncon']}：</span>
					<span style="color:#9b9a9a;font-size:16px;">{$row['content']}</span>
				</div>
				<div style="width:80px;float:right;">
					<a href="{$row['url']}" style="padding:3px 4px;border-radius:5px;font-weight:600;font-size:15px;{if $setting['color']} color:{$setting['color']};border:1px solid {$setting['color']}; {/if}">点击查看</a>
				</div>
			</div>
		{/loop}
		{/if}
		<div class="showcontent" id="desc" style="min-height:25px;padding:40px 5% 20px 5%;text-align:center;margin-top:1px;">
			<div class="menu-one mn-title title" id="vdetail" style="margin-left:29%;color:#fff;{if $setting['color']} background-color:{$setting['color']}; {/if}" >详情</div>
			<div class="menu-two mn-title title" id="vmessage" style="{if $setting['color']} color:{$setting['color']}; {/if}" >评论</div>
		</div>
		<div class="showcontent" id="vdesc" style="margin-top:0px;padding-top:24px;">
			<div class="content">

				{php echo htmlspecialchars_decode($infos['details']);}
			</div>
		</div>
		<div class="showcontent" id="release" style="min-height:70px;display:none;margin-top:0px;padding-top:24px;">
			<div class="content">
				<textarea name="message" id="user-comment" placeholder="快来说说你的感想吧" style="border:1px solid #dddddd;"></textarea>
				<span class="btn-mess" id="btn-mess" style="{if $setting['color']} background-color:{$setting['color']}; {/if}">发布</span>
			</div>
		</div>
		<div class="showcontent" style="margin-top:0px;min-height:10px;font-size:16px;color:#989898;padding-bottom:0px;">全部评论</div>
		<div class="point" style="display:none;margin:0px;">
			{loop $vclist $sto}
			<div class="point-div" style="margin:1px 0px;padding:20px 5%;">
				<div class="con">
					
					<div class="detail">
						
						<div class="pic" style="height:110px;">
							{if $sto['avatar']}
							<img src="{php echo tomedia($sto['avatar']);}" width="110px" height="110px">
							{else}
							<img src="{ONLINEMV_IMAGE}123.png" width="110px" height="110px">
							{/if}
						</div>
						<div class="title" style="margin-left:0%;max-width:54%;">
							{php $name =  mb_substr($sto['nickname'],0,10,'utf-8');}
							<p class="font-color">{$name}</p>
							<p class="font-color">
								{if $sto['release'] == 0}
									{php echo date("Y-m-d H:i:s",$sto['createtime']);}
								{/if}
								{if $sto['release'] == 1}
									刚刚
								{/if}
								{if $sto['release'] == 2}
									{$sto['releasetime']}分钟前
								{/if}
								{if $sto['release'] == 3}
									{$sto['releasetime']}小时前
								{/if}
							</p>
							{php $content =  mb_substr($sto['content'],0,20,'utf-8');}
							<p class="font-color" style="word-wrap: break-word;word-break:break-all;">{$content}</p>
						</div>	
					</div>

				</div>
			</div>
			{/loop}
			
		</div>
	</section>
	<div class="upload" style="display:none;background-color:#ffffff;" data-page="{$page}">
		<div class="showindex" style="display:none;width:20%;margin:0px auto;">
			<img src="{ONLINEMV_IMAGE}123.gif" width="20px;">
			<div style="float:left;">加载中</div>
		</div>
	</div>
	
	<input id="page" type="hidden" name="page" value="{if $pindex} {$pindex} {else}1{/if}">
	<input id="isscroll" type="hidden" name="page" value="1">
	<div class="copyright" style="background-color:#ffffff;margin-top:-20px;margin:0px;padding-bottom:0px;">
		<a href="{$setting['copyrighturl']}" style="{if $setting['color']} color:{$setting['color']}; {/if}" >&copy{$setting['copyright']}</a>
	</div>
	<div style="width:100%;height:60px;background-color:#ffffff;"></div>	
	<footer>
		
	</footer>
	{if $member == 0}
	 <div class="weui_tabbar" style="max-width:640px;height:50px;line-height:50px;">
            <!-- <a id="watch-now" class="weui_tabbar_item watch-now" style="border-right:1px solid #E3E3E3;padding:0px;">
                
                <p class="weui_tabbar_label" style="font-size:16px;">
                	立即观看
                	
                </p>
            </a> -->
            
            <a href="{php echo $this->createMobileUrl('topmember',array('id'=>$infos['id']));}" class="weui_tabbar_item" style="padding:0px;flex:2;border-right:1px solid #E3E3E3;{if $setting['color']} background-color:{$setting['color']}; {/if}">
                
                <p class="weui_tabbar_label" style="color:#ffffff;font-size:16px;">{if $setting['buynow']}{$setting['buynow']}{else}成为会员{/if}</p>
            </a>
            
    </div>
    {/if}
</body>
<script src="{ONLINEMV_JS}swiper.min.js"></script>
<script>
    var swiper = new Swiper('.swiper-container', {
        paginationClickable: true,
        spaceBetween: 0,
        centeredSlides: true,
        autoplay: 3500,
        autoplayDisableOnInteraction: false
    });
</script>

<script type="text/javascript">
	$(function(){
		{if $member == 0}
		swal({   
			title: "是否充值",   
			text: "充值购买后才可以观看完整视频",   
			type: "warning",   
			showCancelButton: true,   
			confirmButtonColor: "#DD6B55",  
			confirmButtonText: "去充值",   
			cancelButtonText: "试看",   
			closeOnConfirm: false,   
			closeOnCancel: true }, 
			function(isConfirm){   
				if (isConfirm) {    
					window.location.href = "{php echo $this->createMobileUrl('topmember',array('id'=>$infos['id']));}"; 
				} else {     
					// window.location.href = "{php echo $this->createMobileUrl('proved',array('id'=>$infos['id']));}";  
				} 
			});
		{/if}

		{if $member == 2}
			swal({   
			title: "是否购买本视频",   
			text: "购买后才可以观看完整视频",   
			type: "warning",   
			showCancelButton: true,   
			confirmButtonColor: "#DD6B55",  
			confirmButtonText: "购买",   
			cancelButtonText: "试看",   
			closeOnConfirm: false,   
			closeOnCancel: true }, 
			function(isConfirm){   
				if (isConfirm) {     
					// window.location.href = "{php echo $this->createMobileUrl('video',array('id'=>$infos['id'],'buy'=>'buy'));}";
					// window.location.href = "{php echo $this->createMobileUrl('showdetail',array('id'=>$infos['id'],'buy'=>'buy'));}";
					var vid = {$infos['id']};
					var url = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('buyvideo'),2)}"+"&rad="+Math.random();
					$.ajax({
						type: 'POST',
			    		url: url,
				    	data: {vdo:'buy',vid:vid},
				    	success:function(datas){
				    		if(datas.statue==1){
				    			swal(datas.msg);
				    			url = location.href;
				    			window.location.href=url;

				    		}else if(datas.statue==2){
				    			swal(datas.msg);
				    			return false;
				    		}else{
				    			swal('购买失败');
				    		}
				    	},
				    	error:function(datas){

					    },
				    	dataType:'json',
					})
				} else {
					// var ifram = document.getElementsByTagName('iframe');
					// alert('hh');
					// iframe.click();
					// window.location.href = "{php echo $this->createMobileUrl('proved',array('id'=>$infos['id']));}";  
				} 
			});
		{/if}
	});
</script>

<script type="text/javascript">
var params = {
    {if empty($infos['videoname'])}
    title: "{$setting['sharetitle']}",
    {else}
    title: "{$infos['videoname']}",
    {/if}
    {if !empty($infos['remark'])}
    desc: "{$infos['remark']}",
    {else}
    desc: "{$setting['sharedesc']}",
    {/if}
    {if empty($infos['logo'])}
    imgUrl: "{php echo tomedia($setting['sharelogo'])}",
    {else}
    imgUrl: "{php echo tomedia($infos['logo'])}",
    {/if}
    success:function(){
    	var url = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('ajaxshare'),2)}"+"&rad="+Math.random();
    	var vid = "{$id}";
    	$.ajax({
			type: 'POST',
    		url: url,
	    	data: {vid:vid},
	    	success:function(datas){
	    		if(datas.statue==1){
	    			$('#shares').html(datas.number);
	    		}else{	
	    		}
	    	},
	    	error:function(datas){

		    },
	    	dataType:'json',
		});
    }
};
wx.ready(function () {
    wx.showOptionMenu();
    wx.onMenuShareAppMessage.call(this, params);
    wx.onMenuShareTimeline.call(this, params);
});
</script>
<script type="text/javascript">
$(function(){
	$("#page").val(1);
	$("#isscroll").val(1);
})
$(window).scroll(function(){
	var page = parseInt($("#page").val())+1;
	var isscroll = $("#isscroll").val();

	var vid="{$id}";
	var url = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('ajaxvmess'),2)}"+"&rad="+Math.random();
	if(isscroll==1){
		if ($(window).scrollTop() == $(document).height() - $(window).height()) {
			$(".upload").show();
			$("#isscroll").val(2);
			setTimeout(function(){
					$.ajax({
						type: 'POST',
			    		url: url,
				    	data: {page:page,vid:vid},
				    	success:function(datas){
				    		if(datas.statue==1){
				    			$(".point").append(datas.data);
					    		$("#page").val(datas.page);
					    		$("#isscroll").val(1);
					    		$(".upload").hide();
				    		}else{
				    			$("#isscroll").val(2);
				    			$(".showindex").html('已加载全部');
				    		}
				    	},
				    	error:function(datas){

					    },
				    	dataType:'json',
					})
				},1000);
		}
	}
})
</script>
<!-- 切换详情和评论 -->
<script type="text/javascript">
	$(function(){
		$('#vdetail').click(function(){
			$('#vdetail').attr('style',"margin-left:25%;color:#ffffff;background-color:{$setting['color']};");
			$('#vmessage').attr('style',"color:{$setting['color']}");

			$('#vdesc').show();
			$('#release').hide();
			$('.point').hide();
		});
		$('#vmessage').click(function(){
			$('#vdetail').attr('style',"margin-left:25%;color:{$setting['color']};");
			$('#vmessage').attr('style',"color:#ffffff;background-color:{$setting['color']}");

			$('#vdesc').hide();
			$('#release').show();
			$('.point').show();
		});
	});
</script>
<!-- 赞 -->
<script type="text/javascript">
	$('#inter-love').click(function(){
		var vid="{$id}";
		var url = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('setinterest'),2)}";
		$.ajax({
			type: 'POST',
    		url: url,
	    	data: {vid:vid},
	    	success:function(datas){
	    		if(datas.statue==1){
	    			swal('点赞成功!');
	    			$('#inter-love img').remove();
	    			$('#inter-love').prepend('<img src="../addons/jy_onlinemv/images/heart2.png" alt="icon" style="width:15px;margin-right:5px;" />');
	    			$('#loves').html(datas.number);
	    		}else{
	    			swal('已赞');
	    			
	    		}
	    	},
	    	error:function(datas){

		    },
	    	dataType:'json',
		})
	});
</script>
<!-- 发布评论 -->
<script type="text/javascript">
	$('#btn-mess').click(function(){
		var vid="{$id}";
		var umess = $('#user-comment').val();

		if(umess == ''){
			swal('请输入内容!');
			return false;
		}
		var url = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('setcomment'),2)}";
		$.ajax({
			type: 'POST',
    		url: url,
	    	data: {vid:vid,umess:umess},
	    	dataType:'json',
	    	success:function(datas){
	    		if(datas.statue==1){
	    			swal('发布成功!');
	    			$('#messages').html(datas.number);
	    			$('.point').prepend(datas.data);
	    			$('#user-comment').val('');
	    		}else{
	    			swal('网络繁忙,请稍后再试!');
	    		}
	    	},
	    	error:function(datas){

		    },
	    	
		});
	});
</script>
</html>