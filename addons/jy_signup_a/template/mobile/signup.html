{template 'common/header'}


  <link rel="stylesheet" type="text/css" href="../addons/jy_signup_a/css/header.css?13323">
  <link rel="stylesheet" type="text/css" href="../addons/jy_signup_a/css/notice.css">
{template style}
  <style>
  body{background: #fff;}
    .M_page {
        width:100%;
        background-color:#fff;
        -webkit-transform:none;
        color:#939393;
    }
    .M_detail {
        margin:7px 0 0;
    }
    .M_module {
        margin:7px 0 0;
    }
    .M_detail .mod_tab {
        height:30px;
        line-height:30px;
        width:95%;
        padding-left: 2%;
        overflow:hidden;
        color:#A2A2A2;
        font-size:12px;
    }
    .M_module .item-box {
        border-top: 1px solid #EAEAEA;
    }
    .M_module .item {
        background:#FFF;
        line-height: 35px;
        font-size: 12px;
        display: table;
        width: 100%;
        color:#666666;
        border-bottom: 1px solid #EAEAEA;
    }
    .M_module .item .input {
        font-size:13px;
        padding:10px 2px;
        width:95%;
        border: 0 none;
        margin-left: 10px
    }
    @media screen and (min-width: 414px){
      .M_module .item .input {
          font-size:13px;
          padding:10px 0;
          width:95%;
          border: 0 none;
          margin-left: 10px
      }
    }
    .M_module .item select {
        font-size:13px;
        padding:10px 0;
        width:95%;
        border: none;
        color: #a9a9a9;
        margin-left: 10px
    }
    .M_module .item .textarea {
        font-size:13px;
        padding:10px 0;
        border: 0 none;
        width: 95%;
    }
    .M_button {
        padding:10px;
    }
    .M_button .btn1 {
        width:100%;
        height:40px;
        line-height:40px;
        font-size:16px;
        color:#FFF;
        /*background:#46CEC0;*/
        text-align:center;
        border-radius: 4px;
        display:inline-block;
    }
    .M_button .btn2 {
        width:100%;
        height:40px;
        line-height:40px;
        font-size:16px;
        color:#FFF;
        background:#b8b8b8;
        text-align:center;
        border-radius: 4px;
        display:inline-block;
        margin-top:10px;
    }
    .M_result .result-btn {
        padding:20px 50px 20px;
    }
    .M_result .result-btn .btn {
        width: 100%;
        height: 40px;
        line-height: 40px;
        font-size: 16px;
        color: #FFF;
        /*background: #46CEC0;*/
        text-align: center;
        border-radius: 4px;
        display: inline-block;
    }
    .M_title {
        padding:10px 10px 0;
        font-size:16px;
        /*color:#46CEC0;*/
    }
    .M_result .result-icon {
        width:90px;
        height:80px;
        background:url("../addons/jy_signup_a/images/icon-result.png") no-repeat center center;
        background-size:45px;
        margin:0 auto;
    }
    .M_result .result-text {
        color:#828282;
        font-size:16px;
        line-height:150%;
        text-align: center;
    }
    #share{
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,.8);
      display: none;
    }
    #share>img{width: 100%}
    input,select{outline: none;border:none;background:none;-webkit-appearance:none}
    /*#sex,#education{padding: 0 10px}*/
    {if IMS_VERSION>=0.8}
    .help-block img{
       max-width: 100%;
       max-height: 250px;
    }
    {/if}
  </style>
 </head>
 <body>

    <header>
      <a href="javascript:history.go(-1)"><div class="navbar-btn floL"><img class="icon-back" src="../addons/jy_signup_a/images/header-back.png"></div></a>
      <a href="{php echo $this->createMobileUrl('geren')}"><div class="navbar-btn floR"><img class="icon-back" src="../addons/jy_signup_a/images/header-person.png"></div></a>
      <h1 class="latecolorbg" style="margin:0;padding:0">{if !empty($sitem['aname'])}{$sitem['aname']}{else}报名{/if}</h1>
    </header>

   <div class="M_page" id="wannago" style="-webkit-transform-origin: 0px 0px; opacity: 1; -webkit-transform: scale(1, 1)">
    <!-- 活动标题 -->
    <div class="M_title latecolor">
     {$hd['hdname']}
    </div>
    <div class="col-xs-12">
    <!-- 联系方式 -->
    {if !empty($ziliao)}
     <div class="M_detail M_module">
      <div class="mod_tab">
       <span>报名信息</span>
      </div>
      <div class="item-box">
      {loop $ziliao $z}

       <div class="item">
          {if $z['type']==2}
              <input id="{$z['id']}" value="{$zl_val[$z['id']]}" type="text" placeholder="请输入{$z['name']}{if $z['enabled']==1}(必填){/if}" class="input" />
          {/if}
          {if $z['type']==3}
            <select id="{$z['id']}">
              <option value="0">请选择{$z['name']}{if $z['enabled']==1}(必选){/if}</option>
              {loop $xx[$z['id']] $x}
              <option value="{$x['name']}" {if $x['name']==$zl_val[$z['id']]} selected {/if}>{$x['name']}</option>
              {/loop}
            </select>
          {/if}
          {if $z['type']==6}
            {if !empty($cy)}
              <input id="{$z['id']}" value="{$zl_val[$z['id']]}" type="tel" placeholder="请输入手机号码{if $z['enabled']==1}(必填){/if}" class="input" />
            {else}
              <input id="{$z['id']}" value="{$member['mobile']}" type="tel" placeholder="请输入手机号码{if $z['enabled']==1}(必填){/if}" class="input" />
            {/if}
          {/if}
          {if $z['type']==7}
            {if !empty($cy)}
              <input id="{$z['id']}" value="{$zl_val[$z['id']]}" type="text" placeholder="请输入真实姓名{if $z['enabled']==1}(必填){/if}" class="input" />
            {else}
              <input id="{$z['id']}" value="{$member['nicheng']}" type="text" placeholder="请输入真实姓名{if $z['enabled']==1}(必填){/if}" class="input" />
            {/if}
          {/if}
           {if $z['type']==8}
           <span>{$z['name']}</span>

              {php echo tpl_form_field_image('img'.$z['id'], $zl_val[$z['id']])}
              <script type="text/javascript">
                   $(function(){
                      {php $zl_val[$z['id']] = explode(',',$zl_val[$z['id']])}
                      {if !empty($zl_val[$z['id']][0])}
                      {loop $zl_val[$z['id']] $r}
                         $('.js-image-img101').parent().find('.js-image-preview').append('<input type="hidden" value="{$r}" name="img101[]" /><img src="{php echo tomedia($r)}" data-id="{php echo md5($r)}"  />');
                       {/loop}
                       {/if}
                   })
              </script>
          {/if}
       </div>
       {/loop}
       <!-- -->
      </div>
     </div>
     {/if}


     <!-- 说点啥 -->
     <div class="M_detail M_module">

      <div class="mod_tab">
       <span>评论</span>
      </div>
      <div class="item-box" style="line-height:100%;">
       <div class="item" style="line-height:100%;">
        <textarea class="textarea" name="saywhat" id="saywhat" placeholder="评论还没写？不可以呦~写下您对本次活动的期许，让小看更好地为您准备惊喜。"></textarea>
       </div>
      </div>
     </div>
         </div>
		 
     <div class="M_button">
      <a class="btn1 btn-buy s_save latecolorbg" href="javascript:submitFunc()">提交报名</a>
      {if !empty($cy)  }

        {if !empty($xz) && empty($hd['qx'])  }
        {else}
		  {if !empty($hd['paiwei'])  ||   $xz['status']==1 }
          <a href="javascript:noFunc();" class="btn2">我不参加了</a>
          {/if}

        {/if}
      {/if}
      <a href="{php echo $this->createMobileUrl('detail',array('id'=>$id))}" class="btn2">取&nbsp;&nbsp;&nbsp;&nbsp;消</a>
     </div>

  {template footer}
   </div>

   <div class="M_page" id="resultPage" style="display:none">
    <div class="M_result">
        <div class="result-icon"></div>
        <div class="result-text">
          恭喜！您已成功报名
          <br/>{$hd['hdname']}
        </div>

        <div class="result-btn">
          <a href="{php echo $this->createMobileUrl('myplan')}" class="btn latecolorbg">查看我的报名</a>
        </div>
    </div>

    <div class="M_button">
      <a href="javascript:void(0);" class="btn1" id="shareBtn" style="margin-bottom:10px;">分享给好友</a>
      <a href="{php echo $this->createMobileUrl('index')}" class="btn1">查看更多活动</a>
    </div>
  </div>

  <div id="share"><img src="../addons/jy_signup_a/images/favor_weixin.png"></div>
  <script src="../addons/jy_signup_a/js/notice.js"></script>
  <script>

  $(function(){
    $('title').html("{$hd['hdname']}");
  })
  window.onload = function(){

    var sex = $("#sex").val();
    var education = $("#education").val();
    if(sex == "0"){
      $("#sex").css("color","#a9a9a9");
    }else{
      $("#sex").css("color","#000");
    }
    if(education == "0"){
      $("#education").css("color","#a9a9a9");
    }else{
      $("#education").css("color","#000");
    }

  }
  $("#sex").change(function() {
    if($(this).val() == "0"){
      $("#sex").css("color","#a9a9a9");
    }else{
      $("#sex").css("color","#000");
    }
  });
  $("#education").change(function() {
    if($(this).val() == "0"){
      $("#education").css("color","#a9a9a9");
    }else{
      $("#education").css("color","#000");
    }
  });
  </script>
  <script>
  function submitFunc(){
    var ziliao='';

    var saywhat = $("#saywhat");

     {if $hd['is_must']==1}
      if(!saywhat.val()){
              showNoticeFunc("请填写评论!");
              return false;
        }
     {/if}
    {loop $ziliao $z}
      {if $z['type']==2 || $z['type']==3 || $z['type']==6 || $z['type']==7|| $z['type']==8}
      var zl_{$z['id']}=$("#{$z['id']}").val();
      {/if}
      {if $z['enabled']==1}
        {if $z['type']==3}
          if(zl_{$z['id']} == 0){
              showNoticeFunc("请选择{$z['name']}");
              return false;
            }
        {/if}
        {if $z['type']==2 || $z['type']==7}
          if(!zl_{$z['id']}){
                showNoticeFunc("请输入{$z['name']}");
                return false;
              }
        {/if}
        {if $z['type']==6}
          var myreg = /^1[345789]\d{9}$/;
          if(zl_{$z['id']}.length==0) {
             showNoticeFunc('请输入手机号码！');
             return false;
          }
          if(zl_{$z['id']}.length!=11 || !myreg.test(zl_{$z['id']})) {
              showNoticeFunc('请输入有效的手机号码！');
              return false;
          }
        {/if}
      {/if}
      {if $z['type']==8}
          ziliao+="&zl_{$z['id']}=";
          var img_{$z['id']} = $("input[name='img{$z['id']}[]']");
          var i_{$z['id']} = 0;
          $("input[name='img{$z['id']}']").each(function(){
                 if(i_{$z['id']}==0){
                    ziliao+= $(this).val();
                 }else{
                   ziliao+= ","+$(this).val();
                 }
                 i_{$z['id']}++;
          });

         {else}
         ziliao+="&zl_{$z['id']}="+zl_{$z['id']};
      {/if}

    {/loop}

    var pl = $("#saywhat").val();
    // alert(ziliao);
    // return false;
      if(pl){
          ziliao+="&pl="+pl;
      }

    $.post("{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('signup',array('op'=>'add','id'=>$id)),2)}"+ziliao,function(data){
        if (data == 1) {
            $("#wannago").hide();
            $("#resultPage").show();
        }
        else if(data==2)
        {
          {if $weixin==1}
            window.location.href="{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('money',array('id'=>$id)),2)}";
          {else}
            window.location.href="{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('pc_money',array('id'=>$id,'mid'=>$mid)),2)}";
          {/if}
        }
        else if(data==3)
        {
          showNoticeFunc("{$hd['diyjf']}");
        }
        else if(data==4)
        {
          showNoticeFunc("该活动仍未开始！");
        }
        else if(data==5)
        {
          showNoticeFunc("该活动仍已经结束！");
        }
        else{
            showNoticeFunc("报名失败！");
        }
    });
  }

  function noFunc(){
    $.post("{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('signup',array('op'=>'no','id'=>$id)),2)}",function(data){
          if (data == 1) {
              showNoticeFunc("取消报名成功！");
              setTimeout(function(){
                  window.location.href="{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('detail',array('id'=>$id)),2)}";
              }, 1500);
          }
          else if(data==2)
          {
            showNoticeFunc("取消报名成功！报名费用将在工作人员审核后退还给你!");
            setTimeout(function(){
                  window.location.href="{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('detail',array('id'=>$id)),2)}";
              }, 2000);
          }
          else if(data==3)
          {
            showNoticeFunc("你已被选中，无法取消报名！");
          }
          else if(data==4)
          {
            showNoticeFunc("你未报名该活动，无法进行取消！返回重试！");
          }
          else{
              showNoticeFunc("操作失败！"+data);
          }
      });
  }

  $("#shareBtn").bind("click",function(){
    $("#share").show();
  });
  $("#share").bind("click",function(){
    $(this).hide();
  });

  //
  function validatemobile(mobile) {
      var myreg = /^1[345789]\d{9}$/;
      if(mobile.length==0) {
         showNoticeFunc('请输入手机号码！');
         return false;
      }
      if(mobile.length!=11 || !myreg.test(mobile)) {
          showNoticeFunc('请输入有效的手机号码！');
          return false;
      }
      return true;
  }
  function IsEmail(email){
    var str = email.trim();
    if(str.length!=0){
      reg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
      if(!reg.test(str)){
          return false;
      }
    }
    return true;
  }
  </script>
  {if $weixin==1}

    {php $signPackage=$_W['account']['jssdkconfig'];}
    <script>

        var appid = '{$_W['account']['jssdkconfig']['appId']}';
        var timestamp = '{$_W['account']['jssdkconfig']['timestamp']}';
        var nonceStr = '{$_W['account']['jssdkconfig']['nonceStr']}';
        var signature = '{$_W['account']['jssdkconfig']['signature']}';

        wx.config({
            debug: false,
            appId: appid,
            timestamp: timestamp,
            nonceStr: nonceStr,
            signature: signature,
            jsApiList: ['checkJsApi','onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo',]
        });
    </script>
    <script type="text/javascript">
        var params = {
            {if empty($sitem['sharetitle'])}
            title:"活动管理",
            {else}
            title: "{$sitem['sharetitle']}",
            {/if}
            {if empty($sitem['sharedesc'])}
            desc: "活动管理!",
            {else}
            desc: "{$sitem['sharedesc']}",
            {/if}
            link: "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('index'),2)}",
            {if empty($sitem['sharelogo'])}
            imgUrl: "{$_W['siteroot']}addons/jy_signup_a/icon.jpg",
            {else}
            imgUrl: "{$_W['attachurl']}{$sitem['sharelogo']}",
            {/if}
        };
        wx.ready(function () {
            wx.showOptionMenu();
            wx.onMenuShareAppMessage.call(this, params);
            wx.onMenuShareTimeline.call(this, params);

            {if !empty($sitem['gps'])}
            wx.getLocation({
                type: 'wgs84', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                success: function (res) {
                    var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                    var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
                    var speed = res.speed; // 速度，以米/每秒计
                    var accuracy = res.accuracy; // 位置精度
                    $.post("{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('location'),2)}"+"&lat="+latitude+"&lng="+longitude,function(data){
                        if (data == 1) {
                        }
                        else{
                            alert("提交地理位置失败！");
                        }
                    });
                }
            });
            {/if}

        });
    </script>
    {/if}
<script>
    $(".mui-image-preview").on('click','img',function(){
      var id = $(this).attr('data-id');
      $(".js-submit").attr('data-id',id);
      return false;
        // alert(id);
    })

</script>
 </body>
</html>
