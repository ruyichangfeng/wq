<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<title>{$school['title']}</title>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/mGrzxTeacher.css?v=4.8" />
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/greenStyle.css?v=4.80120" />
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/pageContent.css?v=4.80120" />
<script type="text/javascript" src="{MODULE_URL}public/mobile/js/jquery-1.10.1.min.js?v=4.9"></script>
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/activityNotice.css?v=4.80120" />
{php echo register_jssdks();}
</head>
<body>
<div id="titlebar" class="header mainColor">
	<div class="l">
		<a class="backOff" style="background:url({OSSURL}public/mobile/img/ic_arrow_left_48px_white.svg) no-repeat;background-size: 55% 55%;background-position: 50%;" href="javascript:history.go(-1);"></a>
	</div>
	<div class="m">
       <span style="font-size: 18px">内容详情</span>   
	</div>
</div>
<div id="titlebar_bg" class="_header"></div>
<input type="hidden"  id="hide_sid"  value="{$it['sid']}">
<input type="hidden"  id="hide_tid"  value="{$it['tid']}">
<input type="hidden"  id="hide_schoolid"  value="{$schoolid}">
<input type="hidden"  id="hide_weid"  value="{$weid}">
			<header class="headerTtitle">
		<h3 class="title">{$leave['title']}</h3>
		{if $teacher['status'] == 2 || $leave['tid'] == $it['tid']}
		<div class="queryResult">
			<img src="{OSSURL}public/mobile/img/headerLeftBg.png" class="img-responsive">
			<span>查看结果</span>
		</div>
		{/if}
	</header>
		<div class="publishInfo">
			<span class="source">发布：{$leave['tname']}</span>
			<span class="time">{php echo (date('m-d H:m',$leave['createtime']))}</span>
			<span class="read"></span>
		</div>
		<div class="content">		
			<p id="neirong">{php echo htmlspecialchars_decode($leave['content'])}</p><br/>
			{if $leave['video']}
			<video id="videocon" controls width="100%"  height="264" poster="{php echo tomedia($school['logo']);}" webkit-playsinline playsinline>
				<source src="{php echo tomedia($leave['video'])}" type='video/mp4' />
				<p class="vjs-no-js">你的浏览器不支持该视频</a></p>
			</video>
			{/if}
			{if $leave['audio']}
				<div class="app-audio" style="undefinedanimation:undefined;box-sizing: border-box;">
					<div class="inner" style="text-align: left;position: relative;">
						<div id="audio-music-4" data-reload="false" class="wx audioLeft clearfix" data-src="{php echo tomedia($leave['audio'])}">
							<img style="width: 40px;height: 40px;display: inline-block;" alt="语音头像" class="audioLogo" width="40" height="40" src="{if $thisteacher['thumb']}{php echo tomedia($thisteacher['thumb'])}{else}{php echo tomedia($school['tpic'])}{/if}">
							<span class="audioBar js-play" style="display: block; margin: 5px 0;width: 185px; height: 42px;display: inline-block;left: 55px; top: 0; background: url(./resource/images/app/sprite_v5.png) 0 0 no-repeat;background-size: 400px 175px;cursor: pointer;">
								<img style="display:none" src="./resource/images/app/player.gif" class="audioAnimation" data-garbage="true">
								<i style="display: block;margin: 12px 15px;width: 13px;height: 17px;left: 21px;top: 12px;z-index: 2;background: url(./resource/images/app/sprite_v5.png) 0 0 no-repeat;background-size: 400px 175px;background-position: -180px -105px;" class="audioStatic"></i>
								<span style="" class="audioLoading" data-garbage="true"><i class="fa fa-spinner fa-pulse"></i></span>
							</span>
							<span style="position: absolute; font-size: 14px;color: #999;left: 250px;bottom: 5px;" class="audio-time">{$leave['audiotime']}’</span>
							<div class="js-audio-wx" data-id="audio-music-4" id="jp_jplayer_1" style="width: 0px; height: 0px;">
								<img id="jp_poster_1" style="width: 0px; height: 0px; display: none;">
								<audio id="jp_audio_1" autoplay="autoplay" preload="none" src="{php echo tomedia($leave['audio'])}"></audio>
							</div>
						</div>
					</div>
				</div>				
			{/if}			
			{if !empty($picarr['p1'])}<br/><img src="{php echo tomedia($picarr['p1']);}" alt="" />{/if}
			{if !empty($picarr['p2'])}<br/><img src="{php echo tomedia($picarr['p2']);}" alt="" />{/if}
			{if !empty($picarr['p3'])}<br/><img src="{php echo tomedia($picarr['p3']);}" alt="" />{/if}
			{if !empty($picarr['p4'])}<br/><img src="{php echo tomedia($picarr['p4']);}" alt="" />{/if}
			{if !empty($picarr['p5'])}<br/><img src="{php echo tomedia($picarr['p5']);}" alt="" />{/if}
			{if !empty($picarr['p6'])}<br/><img src="{php echo tomedia($picarr['p6']);}" alt="" />{/if}
			{if !empty($picarr['p7'])}<br/><img src="{php echo tomedia($picarr['p7']);}" alt="" />{/if}
			{if !empty($picarr['p8'])}<br/><img src="{php echo tomedia($picarr['p8']);}" alt="" />{/if}
			{if !empty($picarr['p9'])}<br/><img src="{php echo tomedia($picarr['p9']);}" alt="" />{/if}	
					
		
		</div>	
		{if !empty($ZY_contents)}
		<div class="questionContent">
			<div class="questionBox">
				  <input type="hidden" id="txtQuestionnaireId" value="{$leaveid}">
					  {if !empty($testAA)}<span style="color:red;"> 你已经提交过本次问卷，不能再提交了哦~</span></br></br>
<span style="color:blue">你的回答：</span>
					  {/if}
				{loop $ZY_contents $key $row}
				 
					
					 {if $ZY_contents[$key]['type'] == '1'}
					 
					 <div class="question" name="{$ZY_contents[$key]['qorder']}" tag="a"> {$ZY_contents[$key]['qorder']}.&nbsp{$ZY_contents[$key]['title']}
					 {loop $ZY_contents[$key]['content'] $keys $rows}
				
						 {if $testAA[$ZY_contents[$key]['qorder']] == $keys }
						 	 <p class="answerOption"><span class="radioOptionsIco" readonly>
						  <img src="{OSSURL}public/mobile/img/radioChecked_01.png" alt="图片无法显示" class="img-unresponsive" readonly>
							  {else}
							   <p class="answerOption"><span class="radioOptionsIco">
                                        <img src="{OSSURL}public/mobile/img/radioNochecked_02.png" alt="图片无法显示" class="img-responsive">
	                                        {/if}
                                        <input type="radio" name="answerOption_{$ZY_contents[$key]['qorder']}" tag="{$keys}">
                                    </span>
{$ZY_contents[$key]['content'][$keys]['title']} {if ((!empty($testAA))&&($ZY_contents[$key]['content'][$keys]['is_answer'] == "Yes"))}<span style="color:red;">  【答案】</span>{/if}
                                    
                                    </p>
					{/loop}
					</div>
					{elseif $ZY_contents[$key]['type'] == '2'}
					<div class="question" name="{$ZY_contents[$key]['qorder']}" tag="b">
						 {$ZY_contents[$key]['qorder']}.&nbsp{$ZY_contents[$key]['title']}
					 {loop $ZY_contents[$key]['content'] $keys $rows}


 <p class="answerOption">
					<span class="checkBoxOptionsIco">
						
	{if in_array($keys, $testAA[$ZY_contents[$key]['qorder']]) }
					 <img src="{OSSURL}public/mobile/img/checkBoxChecked_01.png" alt="图片无法显示" class="img-responsive">
				{else}
									<img src="{OSSURL}public/mobile/img/checkBoxNochecked_02.png" alt="图片无法显示" class="img-responsive">	{/if}
										
									<input type="checkbox" name="answerOption_{$ZY_contents[$key]['qorder']}" tag="{$keys}">
								</span>
{$ZY_contents[$key]['content'][$keys]['title']}{if ((!empty($testAA))&&($ZY_contents[$key]['content'][$keys]['is_answer'] == "Yes"))}<span style="color:red;">  【答案】</span>{/if}

				</p>
				
				{/loop}
				</div>
					{elseif $ZY_contents[$key]['type'] == '3'}
					<div class="question" name="{$ZY_contents[$key]['qorder']}" tag="c">
						 {$ZY_contents[$key]['qorder']}.&nbsp{$ZY_contents[$key]['title']}
					<p class="answerOption">
					{if !empty($testAA[$ZY_contents[$key]['qorder']]) }
							<textarea name="txtAnswerOption" cols="3" rows="4" placeholder="{$testAA[$ZY_contents[$key]['qorder']]}" tag="b65f7ee0-2b6c-4e75-935c-2a56aa88d400" disabled ></textarea>
							{else}
							<textarea name="txtAnswerOption" cols="3" rows="4" placeholder="请回答。。。。。。" tag="b65f7ee0-2b6c-4e75-935c-2a56aa88d400" ></textarea>
							{/if}
						</p>
					</div>
					{/if}
					
					 
					 {/loop}
					 {if empty($testAA)}
					 <button type="button" id="btSubmit">提交</button>
					 {/if}
				</div>
				</div>
				{/if}			
{php include $this->template('comad');}
</body>
<script src="{OSSURL}public/mobile/js/faceMap.js?v=5.61" type="text/javascript"></script>
{php include $this->template('port');}
<script>
		$(".queryResult").on("click", function() {
	{if !empty($ZY_contents)}
		window.location.href = "{php echo $this->createMobileUrl('questatistics', array('schoolid' => $schoolid,'leaveid'=>$leaveid), true)}"
	{else}
		showCheckBox();
	{/if}
});
function showCheckBox(){
    window.location.href = "{php echo $this->createMobileUrl('recod', array('schoolid' => $schoolid,'noticeid'=>$leave['id']), true)}"
};
icon_replace($("#neirong"));
WeixinJSHideAllNonBaseMenuItem();
/**微信隐藏工具条**/
function WeixinJSHideAllNonBaseMenuItem(){
	if (typeof wx != "undefined"){
		wx.ready(function () {
			
			wx.hideAllNonBaseMenuItem();
		});
	}
}
$(function () {
	//背景音乐播放
	var myaudio = document.getElementById("jp_audio_1");
	//myaudio.play();
	$(".audioBar").on("touchstart", function (e) {
		e.stopPropagation();
		if ($(this).hasClass("on")) {
			myaudio.pause();
		} else {
			myaudio.play();
		}
	});
});	
</script>
{if empty($testAA)}
<script>
	var hasSubmit = 'False';
	var hasObject = 'True';

	$(".radioOptionsIco").click(function () {
		var value = $(this).children("img").attr("src");
		if (value == "{OSSURL}public/mobile/img/radioChecked_01.png") {
			$(this).children("img").attr("src", "{OSSURL}public/mobile/img/radioNochecked_02.png");
			$(this).children("input").removeAttr("checked");
		} else {
			$(this).children("img").attr("src", "{OSSURL}public/mobile/img/radioChecked_01.png");
			$(this).children("input").attr("checked", "checked");
			$(this).parent().siblings(".answerOption").find(".radioOptionsIco").children("img").attr("src", "{OSSURL}public/mobile/img/radioNochecked_02.png");
			$(this).parent().siblings(".answerOption").find(".radioOptionsIco").children("input").removeAttr("checked");
		}
	})
	$(".checkBoxOptionsIco").click(function() {
		var value = $(this).children("img").attr("src");
		if (value == "{OSSURL}public/mobile/img/checkBoxChecked_01.png") {
			$(this).children("img").attr("src", "{OSSURL}public/mobile/img/checkBoxNochecked_02.png");
			$(this).children("input").removeAttr("checked");
		} else {
			$(this).children("img").attr("src", "{OSSURL}public/mobile/img/checkBoxChecked_01.png");
			$(this).children("input").attr("checked", "checked");
		}
	});

	$(".btnTrue").click(function () {
		$(".popUpBox").css("display", "none");
		if (hasObject == "True" && hasSubmit == "True") {
			btnSubmit();
		}
	});
	$(".btnFalse").click(function () {
		location.href = "/1046/Notify";
		$(".popUpBox").css("display", "none");
	});


	$("#btSubmit").click(function () {
		if (hasObject == "False" || hasSubmit == "True") {
			$(".popUpBox").css("display", "block");
		}
		else {
			btnSubmit();
		}
	});
        //提交
	function btnSubmit() {
		var zy_sid             = $("#hide_sid").val();
		var zy_tid             = $("#hide_tid").val();
		var zy_weid            = $("#hide_weid").val();
		var zy_schoolid        = $("#hide_schoolid").val();
		var txtQuestionnaireId = $("#txtQuestionnaireId").val();

		var txtItemJson = "";
		var d = 0;
		$(".questionContent").find('.question').each(function () {
			d++;
			var txtQueId = $(this).attr("name");
			var txtQueType = $(this).attr("tag");
			//问答题
			if (txtQueType == "c") {
				var txtQueAnswerId = $(this).find("[name=txtAnswerOption]").attr("tag");
				var txtAnserContent = $(this).find('[name=txtAnswerOption]').val();
				
				if( txtAnserContent.indexOf('"') != -1 )
				{
				    txtAnserContent1 = txtAnserContent.replace(/"/g,"“");
				}else{
					txtAnserContent1 = txtAnserContent ;
				}
				//alert(txtAnserContent1);
				if (txtAnserContent != "") {
                        txtItemJson += "{\"tmid\":\"" + txtQueId + "\",\"type\":\"" + txtQueType + "\",\"huida\":\"" + txtAnserContent1 + "\"},";
				}
			} else {
				var radioObj = $(this).find("[name=answerOption_" + txtQueId + "]");
				for (var j = 0; j < radioObj.length; j++) {
					if (radioObj[j].checked) {
						var txtQueAnswerId = $(radioObj[j]).attr("tag");
                            txtItemJson += "{\"tmid\":\"" + txtQueId +  "\",\"type\":\"" + txtQueType + "\",\"huida\":\"" + txtQueAnswerId + "\"},";
					}
				}

			}

		});
        if (txtItemJson != "") {
            txtItemJson = "[" + txtItemJson.substr(0, txtItemJson.length - 1) + "]";
        } else {
            jTips("还没填写任何内容！不能提交哦");
            return false;
        }
		    jConfirm('提交回答后不可修改，是否确认提交？', '确认对话框', function (r){
	        if(r){
		$.post("{php echo $this->createMobileUrl('indexajax',array('op'=>'tjzy'))}",{"tid":zy_tid, "sid":zy_sid,"weid":zy_weid,"schoolid":zy_schoolid,"userid":{$userid}, "txtQuestionnaireId": txtQuestionnaireId, "txtItemJson": txtItemJson, hasSubmit: hasSubmit },function(data){
					if(data.result){
						jTips(data.info);
						window.location.href = "{php echo $this->createMobileUrl('mnoticelist', array('schoolid' => $schoolid), true)}"
					}else{
						jTips(data.info);
						window.location.href = "{php echo $this->createMobileUrl('mnoticelist', array('schoolid' => $schoolid), true)}"
					}
		},'json');}else{
			return false;
		}});
	}
</script>
{/if}
{php include $this->template('newfooter');}
</html>