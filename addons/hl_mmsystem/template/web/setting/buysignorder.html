{template 'web/common/header'}
<style>
    .signDisplayNone{
        display:none;
    }
</style>
<div class="wrapper wrapper-content ">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>购买授权或延期升级</h5>
                    <h5 style="float: right"><a class="glyphicon glyphicon-refresh" href="{php echo $this->createWebUrl('buysignorder', array('signType' => $signTypeValue))}"></a></h5>
                    <div class="hr-line-dashed"></div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="tabs-container">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true"><i class="fa fa-lg fa-sitemap" style="color: #ed8902"></i>选购授权</a>
                                    </li>
                                    <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false"><i class="fa fa-lg fa-tasks" style="color: #e10c14"></i>我的订单</a>
                                    </li>
                                    </li>
                                </ul>
                                <div class="tab-content">
                                    <div id="tab-1" class="tab-pane active">
                                        <div class="panel-body">
                                            <form action="" class="form-horizontal" method="post" enctype="multipart/form-data" onsubmit="return check(this);">
                                                <div class="form-group form-inline">
                                                    <label class="col-sm-1 control-label">选择授权</label>
                                                    {loop $ApplyPriceData $index $item}
                                                    <div class="col-sm-1">
                                                        <input {if $index == '0'}checked {/if} type="radio" name="radioSign" value="{$item['sw_SignAppStyle']}" aria-label="{php echo m('cloudutil')->signWebsiteStyle($item['sw_SignAppStyle']);}" data-labelauty="{php echo m('cloudutil')->signWebsiteStyle($item['sw_SignAppStyle']);}"/>
                                                    </div>
                                                    {/loop}
                                                    {loop $AgentPriceData $index $item}
                                                    <div class="col-sm-1">
                                                        <input  type="radio" name="radioSign" value="{$item['sw_SignAppStyle']}" aria-label="{php echo m('cloudutil')->signWebsiteStyle($item['sw_SignAppStyle']);}" data-labelauty="{php echo m('cloudutil')->signWebsiteStyle($item['sw_SignAppStyle']);}"/>
                                                    </div>
                                                    {/loop}
                                                </div>
                                                <div class="hr-line-dashed"></div>
                                                <div class="form-group">
                                                    <label class="col-sm-1 control-label">权益说明</label>
                                                    <div class="col-sm-10">
                                                        <div class="m-b-sm">
                                                            <p style="color: #0baefd"><big><strong style="color: crimson">说明：</strong> 哈林云会员卡将陆续发布单店版会员管理系统、连锁多门店版会员管理系统、异业联盟版会员管理系统、各行业垂直版（首批覆盖10个垂直行业）、电商版（对接淘宝天猫等）会员管理系统，哈林科技将致力于打造一个互联网 + 电商 + 大数据 + 物联网 + 生态区块链集群的新会员营销体系应用圈。<h3 style="color: #B01D1D">我们始终相信没有绝对的新潮应用，但是有绝对的、长期性的会员管理营销！</h3></big></p>
                                                        </div>
                                                       <div class="signDiscription2">
                                                           <p><strong style="color: crimson">● </strong> 支持当前站点域名下，当前应用，<b style="color:crimson ">当前微信公众号</b>的商业使用权限（一公众号一使用授权）。</p>
                                                           <p><strong style="color: crimson">● </strong> <b style="color: #06c28b">应用授权一次性收费，技术服务费按年收费。</b></p>
                                                       </div>
                                                        <div class="signDiscription3 signDisplayNone" >
                                                            <p><strong style="color: crimson">● </strong> 支持当前站点域名下，当前应用，<b style="color:crimson ">不限微信公众号</b>的商业使用权限（一域名一应用无限微信公众号使用授权）。</p>
                                                            <p><strong style="color: crimson">● </strong> <b style="color: #06c28b">应用授权一次性收费，技术服务费按年收费。</b></p>
                                                        </div>
                                                        <div class="signDiscription4 signDisplayNone" >
                                                            <p><strong style="color: crimson">● </strong> 支持当前站点域名下，<span class="badge badge-primary" style="font-size: 14px;">任意挑选3个应用</span>，<span class="badge badge-info" style="font-size: 14px;">付费插件9折</span>，<span class="badge badge-danger" style="font-size: 14px;">不限微信公众号</span>的商业使用权限（一域名三应用无限微信公众号使用授权）。</p>
                                                            <p><strong style="color: crimson">● </strong> 签署代理合同、根据代理手册及代理合同享受相应代理政策，并履行相应代理义务。</p>
                                                            <p><strong style="color: crimson">● </strong> 颁发银牌代理授权证书。</p>
                                                            <p><a href="https://cos.halin.org.cn/HLWindows.rar" class="btn btn-block btn-outline btn-warning" style="width: 30%;" target="_blank"><i class="fa fa-paste"></i>  点击下载最新《代理手册白皮书》</a></p>
                                                        </div>
                                                        <div class="signDiscription5 signDisplayNone" >
                                                            <p><strong style="color: crimson">● </strong> 支持当前站点域名下，<span class="badge badge-primary" style="font-size: 14px;">任意挑选6个应用</span>，<span class="badge badge-info" style="font-size: 14px;">付费插件8折</span>，<span class="badge badge-danger" style="font-size: 14px;">不限微信公众号</span>的商业使用权限（一域名六应用无限微信公众号使用授权）。</p>
                                                            <p><strong style="color: crimson">● </strong> 签署代理合同、根据代理手册及代理合同享受相应代理政策，并履行相应代理义务。</p>
                                                            <p><strong style="color: crimson">● </strong> 颁发金牌代理授权证书。</p>
                                                            <p><a href="https://cos.halin.org.cn/HLWindows.rar" class="btn btn-block btn-outline btn-warning" style="width: 30%;" target="_blank"><i class="fa fa-paste"></i>  点击下载最新《代理手册白皮书》</a></p>
                                                        </div>
                                                        <div class="signDiscription6 signDisplayNone">
                                                            <p><strong style="color: crimson">● </strong> 支持当前站点域名下，<span class="badge badge-primary" style="font-size: 14px;">任意挑选10个应用</span>，<span class="badge badge-info" style="font-size: 14px;">付费插件7折</span>，<span class="badge badge-danger" style="font-size: 14px;">不限微信公众号</span>的商业使用权限（一域名十应用无限微信公众号使用授权）。</p>
                                                            <p><strong style="color: crimson">● </strong> 签署代理合同、根据代理手册及代理合同享受相应代理政策，并履行相应代理义务。</p>
                                                            <p><strong style="color: crimson">● </strong> 颁发钻石代理授权证书。</p>
                                                            <p><a href="https://cos.halin.org.cn/HLWindows.rar" class="btn btn-block btn-outline btn-warning" style="width: 30%;" target="_blank"><i class="fa fa-paste"></i>  点击下载最新《代理手册白皮书》</a></p>
                                                        </div>
                                                        <div class="signDiscription7 signDisplayNone">
                                                            <p><strong style="color: crimson">● </strong> 支持当前站点域名下，<span class="badge badge-primary" style="font-size: 14px;">不限应用</span>，<span class="badge badge-info" style="font-size: 14px;">付费插件5折</span>，<span class="badge badge-danger" style="font-size: 14px;">不限微信公众号</span>的商业使用权限（一域名无限应用无限微信公众号使用授权）。</p>
                                                            <p><strong style="color: crimson">● </strong> 签署代理合同、根据代理手册及代理合同享受相应代理政策，并履行相应代理义务。</p>
                                                            <p><strong style="color: crimson">● </strong> 颁发区域代理授权证书。</p>
                                                            <p><a href="https://cos.halin.org.cn/HLWindows.rar" class="btn btn-block btn-outline btn-warning" style="width: 30%;" target="_blank"><i class="fa fa-paste"></i>  点击下载最新《代理手册白皮书》</a></p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="hr-line-dashed"></div>
                                                <div class="form-group">
                                                    <label class="col-sm-1 control-label" style="margin-right: 20px;">服务期限</label>
                                                    <div class="col-sm-10 signDate2">
                                                        <input type="text" class="js-range-slider-2 true-false-slider2" />
                                                        <input type="hidden"  class="js-result-input-2 true-false-result2"  value="1" />
                                                    </div>
                                                    <div class="col-sm-10 signDate3 signDisplayNone" >
                                                        <input type="text" class="true-false-slider3" />
                                                        <input type="hidden"  class="true-false-result3"  value="1" />
                                                    </div>
                                                    <div class="col-sm-10 signDate4 signDisplayNone">
                                                        <input type="text" class="true-false-slider4"  />
                                                        <input type="hidden"  class="true-false-result4"   value="2"/>
                                                    </div>
                                                    <div class="col-sm-10 signDate5 signDisplayNone">
                                                        <input type="text" class="true-false-slider5"  />
                                                        <input type="hidden" class="true-false-result5"  value="2"  />
                                                    </div>
                                                    <div class="col-sm-10 signDate6 signDisplayNone">
                                                        <input type="text" class="true-false-slider6" />
                                                        <input type="hidden"  class="true-false-result6"  value="2"/>
                                                    </div>
                                                    <div class="col-sm-10 signDate7 signDisplayNone">
                                                        <input type="text" class="true-false-slider7"  />
                                                        <input type="hidden" class="true-false-result7"  value="2"/>
                                                    </div>
                                                </div>
                                                <div class="hr-line-dashed"></div>
                                                <div class="form-group">
                                                    <label  class="col-sm-1 control-label">授权价格</label>
                                                    <div class="col-sm-2">
                                                        {loop $ApplyPriceData $index $item}
                                                        <div class="input-group m-b signPrice{$item['sw_SignAppStyle']} {if $item['sw_SignAppStyle'] != '2'} signDisplayNone {/if}"><span class="input-group-addon">¥</span>
                                                            <input type="text" name="input-signPrice{$item['sw_SignAppStyle']}"  class="form-control  input-signPrice{$item['sw_SignAppStyle']}" value="{$item['sw_ApplyPrice']}" readonly>
                                                            <span class="input-group-addon" style="color: #B01D1D">永久授权</span>
                                                        </div>
                                                        {/loop}
                                                        {loop $AgentPriceData $index $item}
                                                        <div class="input-group m-b signPrice{$item['sw_SignAppStyle']} signDisplayNone"><span class="input-group-addon">¥</span>
                                                            <input type="text"   name="input-signPrice{$item['sw_SignAppStyle']}"  class="form-control input-signPrice{$item['sw_SignAppStyle']}" value="{$item['sw_AgentPrice']}" readonly>
                                                            <span class="input-group-addon" style="color: #B01D1D">永久授权</span>
                                                        </div>
                                                        {/loop}
                                                    </div>
                                                    <label  class="col-sm-1 control-label">技术服务费</label>
                                                    <div class="col-sm-2">
                                                        {loop $ApplyPriceData $index $item}
                                                        <div class="input-group m-b signServicePrice{$item['sw_SignAppStyle']} {if $item['sw_SignAppStyle'] != '2'} signDisplayNone {/if}"><span class="input-group-addon">¥</span>
                                                            <input type="text"  name="input-signServicePrice{$item['sw_SignAppStyle']}"  class="form-control input-signServicePrice{$item['sw_SignAppStyle']}" value="{$item['sw_ApplyServicePrice']}" readonly>
                                                            <span class="input-group-addon"  style="color: #B01D1D">/年</span>
                                                        </div>
                                                        {/loop}
                                                        {loop $AgentPriceData $index $item}
                                                        <div class="input-group m-b signServicePrice{$item['sw_SignAppStyle']} signDisplayNone"><span class="input-group-addon">¥</span>
                                                            <input type="text" name="input-signServicePrice{$item['sw_SignAppStyle']}" class="form-control input-signServicePrice{$item['sw_SignAppStyle']}" value="{$item['sw_AgentServicePrice']}" readonly>
                                                            <span class="input-group-addon" style="color: #B01D1D">/年</span>
                                                        </div>
                                                        {/loop}
                                                    </div>
                                                    <label  class="col-sm-1 control-label">应用插件</label>
                                                    <div class="col-sm-2">
                                                        {loop $ApplyPriceData $index $item}
                                                        <div class="input-group m-b signAppDiscount{$item['sw_SignAppStyle']}  {if $item['sw_SignAppStyle'] != '2'} signDisplayNone {/if}">
                                                            <input type="text" name="signAppDiscount{$item['sw_SignAppStyle']}"  class="form-control" value="{php echo (intval($item['sw_ApplyAppDiscount'])/100)*10}" readonly>
                                                            <span class="input-group-addon" style="color: #B01D1D">折{if ((intval($item['sw_ApplyAppDiscount'])/100)*10)==10 }（无折扣） {/if}</span>
                                                        </div>
                                                        {/loop}
                                                        {loop $AgentPriceData $index $item}
                                                        <div class="input-group m-b signAppDiscount{$item['sw_SignAppStyle']} signDisplayNone">
                                                            <input type="text"  name="signAppDiscount{$item['sw_SignAppStyle']}"  class="form-control" value="{php echo (intval($item['sw_AgentAppDiscount'])/100)*10}" readonly>
                                                            <span class="input-group-addon" style="color: #B01D1D">折{if ((intval($item['sw_AgentAppDiscount'])/100)*10)==10 }（无折扣） {/if}</span>
                                                        </div>
                                                        {/loop}
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="col-sm-1"></div>
                                                    <div class="col-sm-3 priceContent">
                                                        <div class="ibox">
                                                            <div class="ibox-content">
                                                                <h3>订单小计</h3>
                                                                <ul class="sortable-list connectList agile-list" id="orderPayMoneyData"></ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-sm-7 orderDescription">
                                                        <div class="ibox">
                                                            <div class="ibox-content">
                                                                <h3>订单说明及优惠说明</h3>
                                                                <ul class="sortable-list connectList agile-list" id="orderDiscountData"></ul>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>

                                                <div class="form-group">
                                                    <label  class="col-sm-3 control-label"></label>
                                                    <div class="col-sm-5">
                                                        <input name="signOrdersubmit" type="submit" value="确 认 购 买" class="btn btn-primary btn-lg">
                                                        <input type="hidden" name="token" value="{$_W['token']}" />
                                                        {$payDatajson}
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                    <div id="tab-2" class="tab-pane">
                                        <table class="table table-bordered">
                                            <thead>
                                            <tr>
                                                <th>订单编号</th>
                                                <th>应用类型</th>
                                                <th>购买类型</th>
                                                <th>服务期限</th>
                                                <th>享受插件折扣</th>
                                                <th>售价</th>
                                                <th>技术服务费</th>
                                                <th>应付金额</th>
                                                <th>优惠金额</th>
                                                <th>实付金额</th>
                                                <th>服务到期时间</th>
                                                <th>支付状态</th>
                                                <th>下单/支付时间</th>
                                                <th>订单备注</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {loop $SignOrderData $item}
                                            <tr>
                                                <td>{$item['sw_OrderNumber']}</td>
                                                <td>
                                                    {if $item['sw_SignApplyToken'] == 'fb4e0d5e'}
                                                    <span class="btn btn-primary btn-xs">单店通用版</span>
                                                    {/if}
                                                    {if $item['sw_SignApplyToken'] == '6cb732a6'}
                                                    <span class="btn btn-primary btn-xs">多店通用版</span>
                                                    {/if}
                                                    {if $item['sw_SignApplyToken'] == '509bd33e'}
                                                    <span class="btn btn-primary btn-xs">异业联盟通用版</span>
                                                    {/if}
                                                </td>
                                                <td>
                                                    {if $item['sw_SignAppStyle'] == 1}
                                                    <span class="btn btn-primary btn-xs">免费版</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 2}
                                                    <span class="btn btn-primary btn-xs">商业版</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 3}
                                                    <span class="btn btn-primary btn-xs">运营版</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 4}
                                                    <span class="btn btn-primary btn-xs">银牌代理</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 5}
                                                    <span class="btn btn-primary btn-xs">金牌代理</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 6}
                                                    <span class="btn btn-primary btn-xs">钻石代理</span>
                                                    {/if}
                                                    {if $item['sw_SignAppStyle'] == 7}
                                                    <span class="btn btn-primary btn-xs">区域代理</span>
                                                    {/if}
                                                   </td>
                                                <td>{$item['sw_Number']}年</td>
                                                <td>{$item['sw_SignAppDiscount']}折</td>
                                                <td>{$item['sw_SellPrice']}元</td>
                                                <td>{$item['sw_ServiceMoney']}元</td>
                                                <td>{$item['sw_HandleMoney']}元</td>
                                                <td>{$item['sw_DiscountMoney']}元</td>
                                                <td>{$item['sw_PayMoney']}元</td>
                                                <td>{php echo date('Y-m-d H:i:s', $item[sw_StatusEndTime]);}</td>
                                                <td>
                                                    {if $item['status'] == 1}
                                                    <span class="btn btn-danger btn-xs">已支付</span>
                                                    {/if}
                                                    {if $item['status'] == 0}
                                                    <span class="btn btn-warning btn-xs">未支付</span>
                                                    {/if}
                                                </td>
                                                <td>下单:{php echo date('Y-m-d H:i:s', $item[sw_AddTime]);}<br>支付:{php echo date('Y-m-d H:i:s', $item[sw_UpdateTime]);}</td>
                                                <td><span class="btn btn-danger btn-xs" onclick="viewRemarkHelp('{$item['sw_remarks']}')">备注(帮助)</span></td>
                                            </tr>
                                            {/loop}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function(){
        var signStyleValue = $('input[name="radioSign"]:checked ').val();
        ionRangeSliderValue(signStyleValue);
        signStyle_Check(signStyleValue);
        priceDiscountDes_return(signStyleValue);
    });
    $(":radio").labelauty({ minimum_width: "100px"});
    $("input[name='radioSign']").click(function(){
        var signStyleValue = $('input[name="radioSign"]:checked ').val();
        var SellNumber = $(".true-false-result"+signStyleValue).attr("value");
        ionRangeSliderCss(signStyleValue);
        ionRangeSliderValue(signStyleValue);
        signStyle_Check(signStyleValue);
        priceDiscountDes_return(signStyleValue);
        priceDiscountValue_return(signStyleValue,SellNumber);
    });
    function ionRangeSliderCss(signType) {

        for(var i=1; i<=8;i++){
            if(i != signType){
                $('.true-false-slider'+i).removeClass("js-range-slider-"+i);
                $('.true-false-result'+i).removeClass("js-result-input-"+i);
            }
        }
        $('.true-false-slider'+signType).addClass("js-range-slider-"+signType);
        $('.true-false-result'+signType).addClass("js-result-input-"+signType);
    }
    function ionRangeSliderValue(signType) {
        if(signType == 2 || signType == 3){
            var values = [1, 2, 3, 4, 5];
            var values_p = ["1年", "2年", "3年", "4年", "5年"];
        }
        if(signType == 4 || signType == 5 || signType == 6 || signType == 7){
            var values = [2, 4, 6];
            var values_p = ["2年", "4年", "6年"];
        }
        $(".js-range-slider-"+signType).ionRangeSlider({
            type: "single",
            grid: true,
            grid_snap: true,
            values: values,
            prettify: function (n) {
                var ind = values.indexOf(n);
                return values_p[ind];
            },
            onStart: function(data) {
                $(".js-result-input-"+signType).attr("value",values[0]);
                priceDiscountValue_return(signType,values[0]);
            },
            onChange: function(data) {
                $(".js-result-input-"+signType).attr("value",data.from_value);
                priceDiscountValue_return(signType,data.from_value);
            }
        });
    }
    function  signStyle_Check(signType){

        for(var i=1; i<=8;i++){
            $('.signDiscription'+i).addClass('signDisplayNone');
            $('.signDate'+i).addClass('signDisplayNone');
            $('.signPrice'+i).addClass('signDisplayNone');
            $('.signServicePrice'+i).addClass('signDisplayNone');
            $('.signAppDiscount'+i).addClass('signDisplayNone');
        }
        $('.signDiscription'+signType).removeClass('signDisplayNone');
        $('.signDate'+signType).removeClass('signDisplayNone');
        $('.signPrice'+signType).removeClass('signDisplayNone');
        $('.signServicePrice'+signType).removeClass('signDisplayNone');
        $('.signAppDiscount'+signType).removeClass('signDisplayNone');

    }
    function  priceDiscountDes_return(signType){
        var getUrl = "{php echo $this->createWebUrl('buysignorder', array('op' => 'ajaxGetPriceDiscountData'))}";
        var applyParams = {
            'applytype': signType
        };
        $.ajax({
            url: getUrl,
            data: applyParams,
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                if (data['message']['code'] == 0) {
                    $("#orderDiscountData").html(data['message']['msg']);
                } else {
                    $("#orderDiscountData").html("数据有误！");
                }
            }
        });
    }
    function  priceDiscountValue_return(signType,SellNumber){
    	var getUrl = "{php echo $this->createWebUrl('buysignorder', array('op' => 'ajaxGetSignOrderData'))}";
        var applyParams = {
            'SignApplyType': signType,
            'SellNumber': SellNumber,
        };
        $.ajax({
            url: getUrl,
            data: applyParams,
            type: 'POST',
            dataType: 'json',
            success: function (data) {
                if (data['message']['code'] == 0) {
                    $("#orderPayMoneyData").html(data['message']['msg']);
                } else {
                    $("#orderPayMoneyData").html("数据有误！");
                }
            }
        });
    }
</script>
<script>
    function  viewRemarkHelp(helpValue){
        swal({
            title: "订单备注",
            text: helpValue,
            html: true
    });
    }
</script>
{template 'web/common/footer'}