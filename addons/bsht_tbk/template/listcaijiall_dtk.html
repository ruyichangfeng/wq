{template 'header'}
<ul class="nav nav-tabs">
	<li><a href="{php echo $this->createWebUrl('listcaijiall_dtk');}" name="topbtn">采集库列表（未导入{$total2}条）</a></li>
</ul>
<style>
.table td span{display:inline-block;margin-top:4px;}
.table td input{margin-bottom:0;}
th{
	text-align: center !important;
}
td{
	text-align: center !important;
}
.red{color:red;font-weight:bold}
</style>
{if $op == 'display'}
<div class="main">

<div class="panel-heading">请先筛选后导入（筛选结果：{$total}条）</div>
	<div class="panel-body">
		<form action="./index.php" method="get" class="form-horizontal" role="form">
			<input type="hidden" name="c" value="site" />
			<input type="hidden" name="a" value="entry" />
        	<input type="hidden" name="m" value="bsht_tbk" />
        	<input type="hidden" name="do" value="listcaijiall_dtk" />
			
			<div class="form-group">
                
<div class="form-group">
           <label class="col-xs-3 col-sm-3 col-md-5 col-lg-1 control-label">佣金低于</label>
				<div class="col-sm-3 col-lg-1">
					<input class="form-control" name="yjdy" id="" placeholder="" type="text" value="{$_GPC['yjdy']}">
				</div> 

           <label class="col-xs-3 col-sm-3 col-md-5 col-lg-1 control-label">收入低于</label>
				<div class="col-sm-3 col-lg-1">
					<input class="form-control" name="srdy" id="" placeholder="" type="text" value="{$_GPC['srdy']}">
				</div> 

           <label class="col-xs-3 col-sm-3 col-md-5 col-lg-1 control-label">售价低于</label>
				<div class="col-sm-3 col-lg-1">
					<input class="form-control" name="sjdy" id="" placeholder="" type="number" value="{$_GPC['sjdy']}">
				</div> 
		</div>



			  <label class="col-xs-3 col-sm-3 col-md-5 col-lg-1 control-label">关键字</label>
				<div class="col-sm-3 col-lg-3">
					<input class="form-control" name="keywords" id="" placeholder="例如服装中所有女装就输入“女”" type="text" value="{$_GPC['keywords']}">
				</div>

               <label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">分类</label>
					<div class="col-sm-8 col-lg-1">
						<select name="cate_id" class="form-control">
<option value="999" {if empty($_GPC['cate_id'])}selected="selected"{/if}>全部商品</option>
<option value="0" {if intval($_GPC['cate_id']) == 0}selected="selected"{/if}>其他</option>
<option value="1" {if intval($_GPC['cate_id']) == 1}selected="selected"{/if}>女装</option>
<option value="9" {if intval($_GPC['cate_id']) == 9}selected="selected"{/if}>男装</option>
<option value="10" {if intval($_GPC['cate_id']) == 10}selected="selected"{/if}>内衣</option>
<option value="2" {if intval($_GPC['cate_id']) == 2}selected="selected"{/if}>母婴</option>
<option value="3" {if intval($_GPC['cate_id']) == 3}selected="selected"{/if}>化妆品</option>
<option value="4" {if intval($_GPC['cate_id']) == 4}selected="selected"{/if}>居家</option>
<option value="5" {if intval($_GPC['cate_id']) == 5}selected="selected"{/if}>鞋包配饰</option>
<option value="6" {if intval($_GPC['cate_id']) == 6}selected="selected"{/if}>美食</option>
<option value="7" {if intval($_GPC['cate_id']) == 7}selected="selected"{/if}>文体车品</option>
<option value="8" {if intval($_GPC['cate_id']) == 8}selected="selected"{/if}>数码家电</option>
						</select>
					</div>

                <label class="col-xs-2 col-sm-2 col-md-2 col-lg-1 control-label">分页显示量</label>
				<div class="col-sm-2 col-lg-1">
					<input class="form-control" name="psize" id="" placeholder="默认200个" type="text" value="{$_GPC['psize']}">
				</div>

				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">缩略图</label>
					<div class="col-sm-8 col-lg-1">
						<select name="thumb" class="form-control">
			  <option value="0" {if intval($_GPC['thumb']) == 0}selected="selected"{/if}>显示</option>	
			  <option value="1" {if intval($_GPC['thumb']) == 1}selected="selected"{/if}>隐藏</option>
						</select>
					</div>

				<div class=" col-xs-12 col-sm-2 col-lg-1">
					<button class="btn btn-info"><i class="fa fa-search"></i> 筛 选</button>
				</div>
			</div>

 			<div class="form-group">
			</div>
		</form>
		
	</div>
</div>
<div style="padding-left:10px">

<a class="btn btn-sm btn-danger" href="javascript:importrow4({$row['id']})"><i class="fa fa-mail-forward"></i> 采集单品</a>

<a class="btn btn-sm btn-danger" href="javascript:importrow1({$row['id']})"><i class="fa fa-mail-forward"></i> 采集大淘客领券直播整库</a>

<a class="btn btn-sm btn-danger" href="javascript:importrow2({$row['id']})"><i class="fa fa-mail-forward"></i> 采集大淘客实时跑量榜</a>

<a class="btn btn-sm btn-danger" href="javascript:importrow3({$row['id']})"><i class="fa fa-mail-forward"></i> 采集大淘客TOP100人气榜</a>

<br><br>
<a href="javascript:;" class="btn btn-sm btn-success mutadd">批量添加到商品库</a>


<a  onclick="return confirm('该操作比较耗时，确认吗？'); return false;" href="{php echo $this->createWebUrl('listcaijiall_dtk',array('op'=>'adddtk'))}" class="btn btn-sm btn-warning ">一键导入已采集商品</a>


&nbsp;&nbsp;&nbsp;&nbsp;
<a  onclick="return confirm('清空当前采集库，确认吗？'); return false;" href="{php echo $this->createWebUrl('itemall_op',array('op'=>'delall_caiji'))}" class="btn btn btn-danger ">清空采集库</a>

&nbsp;

<a data-href="{php echo $this->createWebUrl('listcaijiall_dtk',array('op'=>'delall'))}" href="javascript:;" class="btn btn-danger mutdelete" id="delallbtn" name="delallbtn">删除选中</a>

<a href="#delallbtn" class="btn btn-sm btn-link">到底部↓↓↓</a>

</div>

<br><br>
<form action="" method="post" class="form-horizontal" role="form">
	<div style="padding:15px;background: white;">
		<table class="table table-hover">
			<thead class="navbar-inner">
				<tr>
				    <th style="width:3em;">
                        <input type="checkbox" id="checkall"/>
                    </th>
					<th style="width:100px;">序号</th>
					<th style="width:110px;text-align:center">售价</th>
					<th style="width:110px;text-align:center">佣金</th>
					<th style="width:110px;text-align:center">收入</th>
					<th style="width:150px;text-align:center">所属分类</th>
					<th style="width:auto;text-align: left !important;">商品信息</th>
					{if $_GPC['thumb']==0 || empty($_GPC['thumb'])}
					<th style="width:150px">缩略图</th>
					{/if}
					<!--th style="width:100px">状态</th-->
					<th style="width:200px">修改/删除</th>
				</tr>
			</thead>
			<tbody>
				{loop $list $item}
				{if $item['cate_id']==999}{php $catename="未分类";}{/if}
				{if $item['cate_id']==0}{php $catename="其他";}{/if}
				{if $item['cate_id']==1}{php $catename="女装";}{/if}
				{if $item['cate_id']==9}{php $catename="男装";}{/if}
				{if $item['cate_id']==10}{php $catename="内衣";}{/if}
				{if $item['cate_id']==2}{php $catename="母婴";}{/if}
				{if $item['cate_id']==3}{php $catename="化妆品";}{/if}
				{if $item['cate_id']==4}{php $catename="居家";}{/if}
				{if $item['cate_id']==5}{php $catename="鞋包配饰";}{/if}
				{if $item['cate_id']==6}{php $catename="美食";}{/if}
				{if $item['cate_id']==7}{php $catename="文体车品";}{/if}
				{if $item['cate_id']==8}{php $catename="数码家电";}{/if}
				<tr>
				    <td><input type="checkbox" name="ids[]" value="{$item['id']}" style="font-size:10px"/></td>
					<td><input type="text" name="displayorder[{$item['id']}]" value="{$item['displayorder']}"  style="width:50px;font-size:10px;text-align: center;"></td>
					<td style="text-align:center"><label class="label label-success">￥{$item['itemfee']}</label></td>
					<td style="text-align:center"><label class="label label-success">{$item['shouru_bili']}%</label></td>
					<td style="text-align:center"><label class="label label-success">￥{$item['shouru_yongjin']}</label></td>
					<td style="text-align:center"><label class="label label-success">{$catename}</label></td>
					<td style="text-align: left !important;width:100%;">
					名称：<label class="label label-success">{$item['itemid']}</label>&nbsp;{$item['title']}<br>
					<!--口令：{$item['itemtkl']}<br>-->
					链接：<input style="width:65%" type="text" value="{$item['itemsurl']}"><br>
					<!--长链：{$item['itemurl']}<br>-->
					{if $item['itemyhj_tit']!='无'}优惠卷：{$item['itemyhj_tit']}<br>
					<!--优惠卷-口令：{$item['itemyhj_tkl']}<br>-->
					<!--优惠卷-链接：{$item['itemyhj_url']}<br>-->{/if}
					</td>
                    {if $_GPC['thumb']==0 || empty($_GPC['thumb'])}
                    <td><img src="{php echo tomedia($item['itempic'])}" style="width:50px"></td>
					{/if}

					<!--td>{if $item['status']}<label class="label label-success status" data-id='{$item["id"]}'>启用</label>{else}<label class="label label-default status" data-id='{$item["id"]}'>禁用</label>{/if}</td-->
					
					<td>
						<!--a href="{php echo $this->createWebUrl('listall', array('op' => 'post', 'id' => $item['id']))}" title="编辑" class="btn btn-sm btn-default"><i class="fa fa-edit"></i></a-->
						<a onclick="return confirm('删除此商品，确认吗？'); return false;" href="{php echo $this->createWebUrl('listcaijiall_dtk', array('op' => 'del','id' => $item['id']))}" title="删除" class="btn btn-sm btn-danger"><i class="fa fa-remove"></i></a>
					</td>
				</tr>
				{/loop}

                <tr>
				    <th style="width:3em;">
                        <input type="checkbox" id="checkallbottom"/>
                    </th>
					
				</tr>

				<tr>
	                <td colspan="6" style="text-align: left !important;">
	                	<input name="token" type="hidden" value="{$_W['token']}" />
	                    <input type="submit" class="btn btn-primary" name="submit" value="提交排序" />

						<a data-href="{php echo $this->createWebUrl('listcaijiall_dtk',array('op'=>'delall'))}" href="javascript:;" class="btn btn-danger mutdelete" id="delallbtn" name="delallbtn">删除选中</a>

						<a href="javascript:;" class="btn btn-info mutadd">批量添加到商品库</a>

						<a href="#topbtn" class="btn btn-sm btn-link">到顶部↑↑↑</a>
	                </td>
	            </tr>


			</tbody>
			
		</table>
		{$pager}
	</div>
</form>
</div>
<style>
	.masklayer{ display: none; width: 100%; height: 100%; position: fixed; z-index: 1000; top: 0px; left: 0px; background: rgba(0,0,0,0.7);}
	.mask{ display: none; width: 460px; height: auto; overflow: hidden; position: fixed; z-index: 2000; left: 50%; margin-left: -230px; background: #fff; top: 20%;}
	.mask .title{ width: 100%; height: 40px; line-height: 40px; background:#467ab3; position: relative; z-index: 10;}
	.mask .title span{ margin-left: 15px; color: #fff; font-size: 14px;}
	.mask .title .close{ width: 40px; height: 40px; position: absolute; display: block; top: 7px; right: -15px;color:#fff; z-index: 20;}
	.maskMain{  padding: 0px; height: auto; overflow: hidden; text-align: center; padding-bottom: 30px;}
	.maskMain a{ width: 40%; height: 46px; line-height: 46px; text-align: center; display: inline-block; background: #467ab3; color: #fff; border: 1px solid #000; margin: 30px 15px 0px 15px;}
</style>
<div class="masklayer" onclick="javascript:close1();" style="display: none;" id="masklayer1"></div>
<div class="mask maskOuter" style="display: none;" id="mask1">
			<p class="title">
				<span>读取大淘客领券直播</span>
				<em class="close" onclick="javascript:close1();">X</em>
			</p>
			<!--div class="maskMain">
				<form style="display: inline-block;width: 400px;" action="{php echo $this->createWebUrl('importall_dtk1')}" method="post" enctype="multipart/form-data" class="form-inline">
				<input type="text" id="page1" name="page1" value="1"/>  输入开始页码(默认第1页)
				<input type="text" id="pageend1" name="pageend1" value="1"/>  输入结束页码(默认第1页)
				<input type="hidden" name="token" value="{$_W['token']}" />
				<button class="btn btn-info" style="margin-left:5%;margin-top:20px;" type="submit">确认读取（每页200条）</button><br><br>例如导入1-16页请输入开始页码1，结束页码16即可
				</form>
			</div-->

			<div class="maskMain">
				<input type="text" id="page1" name="page1" value="1"/> 输入开始页码(默认第1页)
				<input type="text" id="pageend1" name="pageend1" value="1"/> 输入结束页码(默认第1页)
                 <button class="btn btn-info" style="margin-left:5%;margin-top:20px;" onclick="importall_dtk1()">确认读取（每页200条）</button>
			</div>
</div>


<div class="masklayer" onclick="javascript:close1();" style="display: none;" id="masklayer2"></div>
<div class="mask maskOuter" style="display: none;" id="mask2">
			<p class="title">
				<span>读取大淘客实时跑量榜</span>
				<em class="close" onclick="javascript:close1();">X</em>
			</p>
			<div class="maskMain">
				<form style="display: inline-block;width: 400px;" action="{php echo $this->createWebUrl('importall_dtk2')}" method="post" enctype="multipart/form-data" class="form-inline">
				<input type="hidden" name="token" value="{$_W['token']}" />
				<button class="btn btn-info" style="margin-left:5%;margin-top:20px;" type="submit">确认读取（100条）</button>
				</form>
			</div>
</div>

<div class="masklayer" onclick="javascript:close1();" style="display: none;" id="masklayer3"></div>
<div class="mask maskOuter" style="display: none;" id="mask3">
			<p class="title">
				<span>读取大淘客TOP100人气榜</span>
				<em class="close" onclick="javascript:close1();">X</em>
			</p>
			<div class="maskMain">
				<form style="display: inline-block;width: 400px;" action="{php echo $this->createWebUrl('importall_dtk3')}" method="post" enctype="multipart/form-data" class="form-inline">
				<input type="hidden" name="token" value="{$_W['token']}" />
				<button class="btn btn-info" style="margin-left:5%;margin-top:20px;" type="submit">确认读取100条）</button>
				</form>
			</div>
</div>


<div class="masklayer" onclick="javascript:close1();" style="display: none;" id="masklayer4"></div>
<div class="mask maskOuter" style="display: none;" id="mask4">
			<p class="title">
				<span>添加单品（仅限大淘客已收录商品）</span>
				<em class="close" onclick="javascript:close1();">X</em>
			</p>
			<div class="maskMain">
				<form style="display: inline-block;width: 400px;" action="{php echo $this->createWebUrl('importall_dtk4')}" method="post" enctype="multipart/form-data" class="form-inline">
				<input type="text" id="itemid" name="itemid" value=""/>
				<input type="hidden" name="token" value="{$_W['token']}" />
				<button class="btn btn-info" style="margin-left:5%;margin-top:20px;" type="submit">确认采集</button><br><br>请输入淘宝商品id或者是大淘客商品id
				</form>
			</div>
</div>



<div id="modal-module-menus-cheat"  class="modal fade" tabindex="-1">
        <div class="modal-dialog" style='width: 520px;'>
            <div class="modal-content">
                <div class="modal-header" style="height:50px"><button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button><h4>提示：即将导入
				{if $_GPC['cate_id']==7456}{php $catename2="未分类";}{/if}
				{if $_GPC['cate_id']==1}{php $catename2="女装";}{/if}
				{if $_GPC['cate_id']==9}{php $catename2="男装";}{/if}
				{if $_GPC['cate_id']==10}{php $catename2="内衣";}{/if}
				{if $_GPC['cate_id']==2}{php $catename2="母婴";}{/if}
				{if $_GPC['cate_id']==3}{php $catename2="化妆品";}{/if}
				{if $_GPC['cate_id']==4}{php $catename2="居家";}{/if}
				{if $_GPC['cate_id']==5}{php $catename2="鞋包配饰";}{/if}
				{if $_GPC['cate_id']==6}{php $catename2="美食";}{/if}
				{if $_GPC['cate_id']==7}{php $catename2="文体车品";}{/if}
				{if $_GPC['cate_id']==8}{php $catename2="数码家电";}{/if}
<font color="red">{$catename2}（共{$total}条）</font>已选商品到下列分类
				
				
				
				</h4></div>
                <div class="modal-body">
                  
				   {loop $cate $i}
				   <a data-id="{$i['id']}" data-href="{php echo $this->createWebUrl('listcaijiall_dtk',array('op'=>'addall'))}" href="javascript:;" class="btn btn-info mutaddok" style="margin:5px 5px;">{$i['name']}</a>
                   {/loop}
				   
				
				   <!--a data-id="{$i['id']}" data-href="{php echo $this->createWebUrl('listcaijiall_dtk',array('op'=>'addall'))}" href="javascript:;" class="btn btn-info mutaddok" style="margin:5px 5px;">点击确认添加</a-->
               

                </div>
            </div>
        </div>
</div>

<script>
function drop_confirm(msg, url){
            if (confirm(msg)){
            window.location = url;
            }
            }


function importall_dtk1(){
	var page1 = $('#page1').val();
	var pageend1 = $('#pageend1').val();
	drop_confirm('确认开始采集第'+page1+'页到第'+pageend1+'页数据？', './index.php?c=site&a=entry&do=importall_dtk1&m=bsht_tbk&page1='+page1+'&pageend1='+pageend1);
}


function importrow1(rowid){
	$('#rowid').val(rowid);
	$("#mask1").fadeIn(500);
	$("#masklayer1").fadeIn(500);
}
function importrow2(rowid){
	$('#rowid').val(rowid);
	$("#mask2").fadeIn(500);
	$("#masklayer2").fadeIn(500);
}
function importrow3(rowid){
	$('#rowid').val(rowid);
	$("#mask3").fadeIn(500);
	$("#masklayer3").fadeIn(500);
}
function importrow4(rowid){
	$('#rowid').val(rowid);
	$("#mask4").fadeIn(500);
	$("#masklayer4").fadeIn(500);
}
function close1(){
	$(".maskOuter").fadeOut(500);
	$(".masklayer").fadeOut(500);
}
</script>
<script>
require(['util'],function(util){
$('.mutdelete').click(function(){
            var url = $(this).data('href');
            var ids = [];
            var idss = [];
            $('input:checkbox[name="ids[]"]').each(function() {
                var _that = $(this)[0];
                if(_that.checked){
                    ids = ids.concat($(this).val());
                }else{
                    idss = idss.concat($(this).val());
                }
            });
            console.log(ids);
            if(confirm("您确定要删除么？")){
                $.post(url,{ids:ids},function(data){
                    util.message("删除成功","{php echo $_W['siteurl']}",'success');
                },'json');
            }
        });


$('.mutadd').click(function(){

$('#modal-module-menus-cheat').modal();

});

$('.mutaddok').click(function(){
            var url = $(this).data('href');
            var ids = [];
            var idss = [];
			var cateid = $(this).data('id');
            $('input:checkbox[name="ids[]"]').each(function() {
                var _that = $(this)[0];
                if(_that.checked){
                    ids = ids.concat($(this).val());
                }else{
                    idss = idss.concat($(this).val());
                }
            });
			
            console.log(cateid);
            if(confirm("您确定要导入么？")){
                $.post(url,{ids:ids,cateid:cateid},function(data){
                    util.message("导入成功","{php echo $_W['siteurl']}",'success');
                },'json');
            }
        });


});

$("#checkall").click(function(){
            console.log('checkall');
            $('input[name="ids[]"').each(function(){
                var _that = $(this)[0];
                if(_that.checked){
                    _that.checked = false;
                }else{
                    _that.checked = true;
                }
            });
        });


$("#checkallbottom").click(function(){
            $("#checkall").click();
        });


$('.status').click(function(){
	var label = $(this);
	$.ajax({
		url:'{php echo $this->createWebUrl("listall",array("op"=>"status"))}',
		type:'post',
		data:{id:label.attr('data-id')},
		success:function(status){
			if(status == '1'){
				if(label.hasClass('label-success')){
					label.removeClass('label-success').addClass('label-default');
					label.text('禁用');
				}else{
					label.removeClass('label-default').addClass('label-success');
					label.text('启用');
				}
			}
		}
	});
});
</script>
{elseif $op == 'post'}
<div class="panel panel-info">
		<div class="panel-body">
			<form action="" method="post" class="form-horizontal" role="form">
			<input type="hidden" name="id" value="{$item[id]}">
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">商品名称</label>
				<div class="col-sm-4">
					<input class="form-control" required="required" name="title" type="text" value="{$item['title']}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">排序</label>
				<div class="col-sm-4">
					<input class="form-control" name="displayorder" type="number" min="0" value="{$item['displayorder']}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">状态</label>
				<div class="col-sm-4">
					<label><input type="radio" name="status" checked="checked" value="0"> 禁用</label>
					<label style="margin-left: 10px;"><input type="radio" name="status" {if $item['status']}checked="checked"{/if} value="1"> 启用</label>
				</div>
			</div>
			<button type="submit" class="btn btn-primary" name="submit" value="提交">保存</button>
			<input type="hidden" name="token" value="{$_W['token']}" />
			</form>
	</div>
</div>
{/if}
{template 'footer'}
