<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>{$school['title']}</title>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/bindingFormFor.css" />
<link type="text/css" rel="stylesheet" href="{OSSURL}public/mobile/css/greenStyle.css?v=4.60120" />
<script type="text/javascript" src="{OSSURL}public/mobile/js/jquery-1.11.3.min.js?v=4.6"></script>
<script src="{OSSURL}public/mobile/js/jquery.js"></script>
<script src="{OSSURL}public/mobile/js/PromptBoxUtil.js"></script>
	<style>
		#birthday{
			border-bottom:1px solid #c6c6c6;position:relative;display:block;height:30px;line-height:30px;opacity:1;
		}
		#selMonth{
			margin-left:-40px;
			position:relative;
			z-index:10;
			opacity:0;
		}
		.bangdingForm{margin:5px 10px;background:#fff;border:1px solid #d0d0d0;border-radius:5px;}
		.bangdingBox .changeBox{margin:10px;display:none;}
		.bangdingBox .changeBox ul{width:95%;}
		.bangdingBox .changeBox ul li{width:99%;position:relative;padding:10px 0;overflow:hidden;}
		.bangdingBox .changeBox ul li span{display:block;height:30px;line-height:30px;}
		.bangdingBox .changeBox ul li span input{border:none;height:30px;font-size:15px;width:100%;border-bottom:1px solid #c6c6c6;}
		.bangdingBox .changeBox ul li span.l{position:absolute;width:100px;left:0;top:10px;color:#313131;}
		.bangdingBox .changeBox ul li span.r{margin-left:100px;border-bottom:1px solid #c6c6c6;position:relative;}
		.bangdingBox .changeBox ul li span.r label{width:100%;height:100%;display: block;text-align: left;}
		.bangdingBox .changeBox ul li span.r select{position:absolute;left:0;top:0;width:100%;height:100%;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;}
		.bangdingBox .changeBox ul li span.r i{width:0;height:0;border-width:0 0 6px 6px;border-style:solid;border-color:transparent transparent #666 transparent;position:absolute;right:5px;bottom:5px;}
		.bangdingBox .changeBox ul li span.remind{margin-left:100px;overflow:hidden;display:block;height:auto;}
		.bangdingBox .changeBox ul li span.remind i{float:left;width:12px;height:12px;margin-top:5px;}
		.bangdingBox .changeBox ul li span.remind i img{width:100%;height:100%;}
		.bangdingBox .changeBox ul li span.remind label{display:block;margin-left:15px;line-height:auto;font-size:14px;line-height:22px;text-align:left;}
		.submitBtn{margin:2px 10px 10px 10px;height:50px;line-height:50px;border-radius:5px;text-align:center;color:white;cursor:pointer;}
	</style>
</head>
<body>
<div class="all">
<div class="header mainColor">
	<div class="l"><a class="backOff" style="background:url({OSSURL}public/mobile/img/ic_arrow_left_48px_white.svg) no-repeat;background-size: 55% 55%;background-position: 50%;" href="javascript:history.go(-1);"></a></div>
	<div class="m">
		<span>注册</span>
	</div>
</div>
<div class="_header"></div>
		<div class="bangdingForm">
			<!--<div class="bangdingTab">-->
				<!--<div class="changeTab leftPosition {if $bdTeacher == NULL}activeTab{/if}" onclick="changeTab(this,'parent');">我是家长(闲书)</div>-->
				<!--<div class="changeTab rightPosition {if $bdTeacher != NULL}activeTab{/if}" onclick="changeTab(this,'teacher');">我是老师</div>-->
			<!--</div>-->
			<div class="bangdingBox">
				<!--<div class="headerBox">-->
					<!--<div class="leftHeader">-->
						<!--<img id="wxiconpath" alt="" src="{php echo tomedia($_W['fans']['tag']['avatar']);}" />-->
						<!--<span id="wxname">{$_W['fans']['nickname']}</span>-->
					<!--</div>-->
					<!--<div class="linkImg">-->
						<!--<img alt="" src="{OSSURL}public/mobile/img/ico_linkImg.png" />-->
					<!--</div>-->
					<!--<div class="rightHeader">-->
						<!--<img style="height:80px;" src="{OSSURL}public/mobile/img/default_babyHeader.png" />-->
						<!--<span>学生</span>-->
					<!--</div>-->
				<!--</div>-->
				{if $bdTeacher == NULL}
				<div id="parentBox" class="changeBox  activeBox">
					<ul>
						<li>
							<span class="l">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span>
							<span class="r">
								<input id="s_name" type="text" value="" />
							</span>
						</li>
						<li>
							<span class="l">手机号码：</span>
							<span class="r">
								<input id="mobile" type="tel" maxlength="11" value="" />
							</span>
						</li>
						<li onclick="showMap()">
							<span class="l">小区地址：</span>
								<span class="r">
									<input id="home_address" type="text" value="" placeholder="点击选择小区位置" disabled/>
									<input id="lng" name="lng" type="hidden" value=""/>
									<input id="lat" name="lat" type="hidden" value=""/>
								</span>
						</li>
						<!--<li>-->
						<!--<span class="l">关&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;系：</span>-->
						<!--<span class="r">-->
						<!--<label>请选择</label>-->
						<!--<select id="subjectId">-->
						<!--<option value="">请选择</option>-->
						<!--<option value="2">母亲</option>-->
						<!--<option value="3">父亲</option>-->
						<!--<option value="4">本人</option>-->
						<!--<option value="5">家长</option>-->
						<!--</select>-->
						<!--<i></i>-->
						<!--</span>-->
						<!--</li>						-->
						<!--<li class="no_padding">-->
						<!--<span class="l"></span>-->
						<!--<span class="remind">-->
						<!--<i><img alt="" src="{OSSURL}public/mobile/img/ico_attention.png" /></i>-->
						<!--<label>请输入报名时预留的手机号，一次绑定一个学生</label>-->
						<!--</span>-->
						<!--</li>-->
					</ul>
					<div class="submitBtn mainColor" onclick="bangDing();">确定</div>
				</div>
				{else}
				<div id="teacherBox" class="changeBox activeBox">
					<ul>
						<li>
							<span class="l">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：</span>
							<span class="r">
								<input id="tname" type="text" value="" />
							</span>
						</li>
						<!--<li>-->
						<!--<span class="l">性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：</span>-->
						<!--<span class="r">-->
						<!--<label>请选择</label>-->
						<!--<select id="sex">-->
						<!--<option value="">请选择</option>-->
						<!--<option value="1">男</option>-->
						<!--<option value="2">女</option>-->
						<!--</select>-->
						<!--<i></i>-->
						<!--</span>-->
						<!--</li>-->
						<li>
							<span class="l">手机号码：</span>
							<span class="r">
								<input id="tmobile" type="tel" maxlength="11" value="" />
							</span>
						</li>
						<li onclick="showMap()">
							<span class="l">小区地址：</span>
								<span class="r">
									<input id="home_address" type="text" value="" placeholder="点击选择小区位置" disabled/>
									<input id="lng" name="lng" type="hidden" value=""/>
									<input id="lat" name="lat" type="hidden" value=""/>
								</span>
						</li>
					</ul>
					<div class="submitBtn mainColor" onclick="bangDing1();">确定</div>
				</div>
				{/if}
			</div>
			<div class="form-group">
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<!--<div class="modal-header">-->
							<!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>-->
							<!--<h4 class="modal-title" id="myModalLabel">地图选择</h4>-->
							<!--</div>-->
							<div class="modal-body" id="map" style="display: none">
								<iframe id="iframe" width="100%" frameborder=10
										src="http://apis.map.qq.com/tools/locpicker?search=1&type=1&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77&referer=myapp">
								</iframe>

								<script>
									//iframe页面调用方法
									$(function(){

										adaptHeight();//动态适配高度
										window.onresize = function() { //横屏、QQ浏览器变全屏模式下的时候，需要重新计算高度
											adaptHeight();
										}
										if(window.parent.document.getElementById("iframe").height >= 500){
											window.parent.document.getElementById("iframe").height = 400;
										}
										window.addEventListener('message', function(event) {
											var loc = event.data;
											document.getElementById("lng").value=loc.latlng.lng;
											document.getElementById("lat").value=loc.latlng.lat;
											document.getElementById("home_address").value=loc.poiaddress;
										}, false);

										function adaptHeight() {
											var winH = $(window).height();
											var bodyH = document.documentElement.clientHeight;
											if (winH > bodyH) {
												window.parent.document.getElementById("iframe").height=winH;
											} else {
												window.parent.document.getElementById("iframe").height=bodyH;
											}
										}
									});
								</script>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
var PB = new PromptBox();
var campus = $("#campus").val();
var subjectId = $('#subjectId').val();
$(document).ready(function() {
	$("#sex").change(function() {
		changeSex();
	});
});
function showMap(){
	$("#map").show();
}
function changeSex(){
	$("#sex").parent().find("label").html($("#sex").find("option:selected").text());
}
function changeGx(){
	$("#subjectId").parent().find("label").html($("#subjectId").find("option:selected").text());
}
function changeTab(obj,tabName){
	$(obj).parent().children().removeClass("activeTab");
	$(obj).addClass("activeTab");
	$("#"+tabName+"Box").parent().find(".changeBox").removeClass("activeBox");
	$("#"+tabName+"Box").addClass("activeBox");
	var bangdingStr = "";
	var imgSrc = "";
	if(tabName == "parent"){
		bangdingStr = "我的孩子";
		imgSrc = "../addons/duola_club/public/mobile/img/default_babyHeader.png";
	}else if(tabName == "teacher"){
		bangdingStr = "我的校园";
		imgSrc = "../addons/duola_club/public/mobile/img/default_school.png";
	}else{
		bangdingStr = "未知绑定";
	}
	$(".rightHeader").find("span").html(bangdingStr);
	$(".rightHeader").find("img").attr("src",imgSrc);
}

function bangDing(){
	var activeBoxID = $(".bangdingBox").find(".activeBox").attr("id");
	if(activeBoxID == "parentBox"){
		if($("#s_name").val() == null || $("#s_name").val() == ""){
			PB.prompt("姓名不能为空！");
			return;
		}else if($("#home_address").val() == null || $("#home_address").val() == ""){
			PB.prompt("小区住址不能为空！");
			return;
		}else if($("#mobile").val() == null || $("#mobile").val() == ""){
			PB.prompt("手机号码不能为空！");
			return;
		}else if(!$("#mobile").val().match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/)){
			PB.prompt("手机格式不正确！");
			return;
		}
	}
	if(confirm("确认提交？")){
		var submitData = {
			openid :"{$openid}",
			schoolid :"{$schoolid}",
			weid :"{$weid}",
			uid :"{$fan['uid']}",
			name : $("#s_name").val(),
			mobile : $("#mobile").val(),
			home_address : $("#home_address").val(),
			lng : $("#lng").val(),
			lat : $("#lat").val(),
		};
	        $.post("{php echo $this->createMobileUrl('indexajax',array('op'=>'bdxs'))}",submitData,function(data){
            if(data.result){
                PB.prompt(data.msg);
				window.location.href = "{php echo $this->createMobileUrl('user', array('schoolid' => $schoolid), true)}"
            }else{
                PB.prompt(data.msg);
            }
        },'json'); 
    }
}
function bangDing1(){
	var activeBoxID = $(".bangdingBox").find(".activeBox").attr("id");
    if(activeBoxID == "teacherBox"){
		if($("#tname").val() == null || $("#tname").val() == ""){
			PB.prompt("老师姓名不能为空！");
			return;
		}else if($("#tmobile").val() == null || $("#tmobile").val() == ""){
			PB.prompt("手机号码不能为空！");
			return;
		}else if(!$("#tmobile").val().match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[0-9]|18[0-9]|14[57])[0-9]{8}$/)){
			PB.prompt("手机格式不正确！");
			return;
		}else if($("#home_address").val() == null || $("#home_address1").val() == ""){
			PB.prompt("小区住址不能为空！");
			return;
		}
	}

	if(confirm("确认提交？")){
		var submitData = {
			openid :"{$openid}",
			schoolid :"{$schoolid}",
			weid :"{$weid}",
			uid :"{$fan['uid']}",
			tname : $("#tname").val(),
			sex:$("#sex").val(),
			mobile:$("#tmobile").val(),
			home_address : $("#home_address").val(),
			lng : $("#lng").val(),
			lat : $("#lat").val(),
		};
        $.post("{php echo $this->createMobileUrl('indexajax', array('op' => 'bdls'))}",submitData,function(data){
                    if(data.result){
					    PB.prompt(data.msg);
                        window.location.href = "{php echo $this->createMobileUrl('myschool', array('schoolid' => $schoolid), true)}"
                    }else{
						PB.prompt(data.msg);
                    }
        },'json');	
    }  
}
</script>
</html>