{template 'common/header'}
<div class="main">
    <form action="" method="post" class="form-horizontal form" enctype="multipart/form-data">
    <div class="panel panel-default">
        <div class="panel-heading">
            提醒设置
        </div>

        <div class="panel-body">

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">订单成功通知模板</label>
                <div class="col-md-7">
                    <input type="text" name="tplid" class="form-control" value="{$settings['tplid']}" />
                </div>
                <!--<div class="col-md-3">-->
                    <!--<button class=" btn btn-default addtpl">添加</button><button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                <!--</div>-->
            </div>
            <div class="form-group">

                    <div class="col-md-offset-2 col-md-7">
                        <div class="col-md-4 ">
                            <input type="text" name="lefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$lefttpl[0]}" >

                        </div>
                        <div class="col-md-7 col-md-offset-1">
                            <input type="text" name="righttpl[]" class="form-control" placeholder="填写内容" value="{$righttpl[0]}" >

                        </div>

                    </div>

                </div>
{loop $lefttpl $index $v}

            {if $index>0&&$index<($count-1)}
            <div class="form-group ls">

                <div class="col-md-offset-2 col-md-7">
                    <div class="col-md-4 ">
                        <input type="text" name="lefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$lefttpl[$index]}">

                    </div>
                    <div class="col-md-7 col-md-offset-1">
                        <input type="text" name="righttpl[]" class="form-control" placeholder="填写内容" value="{$righttpl[$index]}" >

                    </div>

                </div>
                <div class="col-md-3">
                   <a href="javascript:;" onclick="deleteItem(this)" class="btn btn-default">删除</a>
                </div>

            </div>
            {/if}

            {/loop}
            <div id="last">



            </div>

            <div class="form-group" >

                <div class="col-md-offset-2 col-md-7">
                    <div class="col-md-4 ">
                        <input type="text" name="lefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$lefttpl[$num]}" >

                    </div>
                    <div class="col-md-7 col-md-offset-1">
                        <input type="text" name="righttpl[]" class="form-control" placeholder="填写内容" value="{$righttpl[$num]}" >

                    </div>

                </div>
                <div class="col-md-3">
                    <button class=" btn btn-default addtpl">添加</button> <!--<button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                </div>
            </div>

            <div class="btn-block">

                <p>提示:[sn]为订单号，[pro]为菜品列表</p>
            </div>


        </div>



    </div>



        <div class="panel panel-default">
            <div class="panel-heading">
               完成订单通知
            </div>

            <div class="panel-body">

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">完成通知模板</label>
                    <div class="col-md-7">
                        <input type="text" name="succtplid" class="form-control" value="{$settings['succtplid']}" />
                    </div>
                    <!--<div class="col-md-3">-->
                    <!--<button class=" btn btn-default addtpl">添加</button><button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                    <!--</div>-->
                </div>
                <div class="form-group">

                    <div class="col-md-offset-2 col-md-7">
                        <div class="col-md-4 ">
                            <input type="text" name="succlefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$succlefttpl[0]}" >

                        </div>
                        <div class="col-md-7 col-md-offset-1">
                            <input type="text" name="succrighttpl[]" class="form-control" placeholder="填写内容" value="{$succrighttpl[0]}" >

                        </div>

                    </div>

                </div>
                {loop $succlefttpl $index $v}

                {if $index>0&&$index<($succcount-1)}
                <div class="form-group ls">

                    <div class="col-md-offset-2 col-md-7">
                        <div class="col-md-4 ">
                            <input type="text" name="succlefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$succlefttpl[$index]}">

                        </div>
                        <div class="col-md-7 col-md-offset-1">
                            <input type="text" name="succrighttpl[]" class="form-control" placeholder="填写内容" value="{$succrighttpl[$index]}" >

                        </div>

                    </div>
                    <div class="col-md-3">
                        <a href="javascript:;" onclick="deleteItem(this)" class="btn btn-default">删除</a>
                    </div>

                </div>
                {/if}

                {/loop}
                <div id="succlast">



                </div>

                <div class="form-group" >

                    <div class="col-md-offset-2 col-md-7">
                        <div class="col-md-4 ">
                            <input type="text" name="succlefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" value="{$succlefttpl[$succnum]}" >

                        </div>
                        <div class="col-md-7 col-md-offset-1">
                            <input type="text" name="succrighttpl[]" class="form-control" placeholder="填写内容" value="{$succrighttpl[$succnum]}" >

                        </div>

                    </div>
                    <div class="col-md-3">
                        <button class=" btn btn-default succaddtpl">添加</button> <!--<button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                    </div>
                </div>

                <div class="btn-block">

                    <p>提示:[time]为完成订单时间，[sn]为订单号，[count]为消费次数,[uid]为会员卡号,[yuci]为会员卡剩余次数</p>
                </div>


            </div>



        </div>
<div id="succclonett">
        <div class="form-group">

            <div class="col-md-offset-2 col-md-7">
                <div class="col-md-4 ">
                    <input type="text" name="succlefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" >

                </div>
                <div class="col-md-7 col-md-offset-1">
                    <input type="text" name="succrighttpl[]" class="form-control" placeholder="填写内容" >

                </div>

            </div>
            <div class="col-md-3">
                <a href="javascript:;" onclick="deleteItem(this)" class="btn btn-default">删除</a>
            </div>

        </div>


</div>


        <div id="clonett">
            <div class="form-group">

                <div class="col-md-offset-2 col-md-7">
                    <div class="col-md-4 ">
                        <input type="text" name="lefttpl[]" class="form-control" placeholder="{{name.DATA}}，填写name" >

                    </div>
                    <div class="col-md-7 col-md-offset-1">
                        <input type="text" name="righttpl[]" class="form-control" placeholder="填写内容" >

                    </div>

                </div>
                <div class="col-md-3">
                    <a href="javascript:;" onclick="deleteItem(this)" class="btn btn-default">删除</a>
                </div>

            </div>


        </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                群发时间
            </div>

            <div class="panel-body">

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">选择时间</label>
                    <div class="col-md-7">


                        <select class="form-control" name="hour">

                            <option value="10" {if $settings['hour']==10}selected{/if} >10</option>
                            <option value="11" {if $settings['hour']==11}selected{/if} >11</option>

                            <option value="12" {if $settings['hour']==12}selected{/if} >12</option>

                            <option value="13" {if $settings['hour']==13}selected{/if} >13</option>
                            <option value="14" {if $settings['hour']==14}selected{/if} >14</option>
                            <option value="15" {if $settings['hour']==15}selected{/if} >15</option>
                            <option value="16" {if $settings['hour']==16}selected{/if} >16</option>
                            <option value="17" {if $settings['hour']==17}selected{/if} >17</option>
                            <option value="18" {if $settings['hour']==18}selected{/if} >18</option>
                            <option value="19" {if $settings['hour']==19}selected{/if} >19</option>
                            <option value="20" {if $settings['hour']==20}selected{/if} >20</option>
                            <option value="21" {if $settings['hour']==21}selected{/if} >21</option>
                            <option value="22" {if $settings['hour']==22}selected{/if} >22</option>


                        </select>
                    </div>
                    <!--<div class="col-md-3">-->
                    <!--<button class=" btn btn-default addtpl">添加</button><button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                    <!--</div>-->
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">网站地址目录</label>
                    <div class="col-md-7">
                        <input type="text" name="wangurl" class="form-control" placeholder="例如:www.baidu.com,不要加/。" value="{$settings['wangurl']}" />
                    </div>
                    <!--<div class="col-md-3">-->
                    <!--<button class=" btn btn-default addtpl">添加</button><button class="btn btn-default col-md-offset-1 deltpl">删除</button>-->
                    <!--</div>-->
                </div>
                </div>
            </div>


        <div class="form-group col-sm-offset-2 col-sm-12">
            <input name="submit" type="submit" value="保存设置" id="send" class="btn btn-primary span3">

            <input type="hidden" name="token" value="{$_W['token']}" />
        </div>
        </form>
    </div>
{template 'common/footer'}




<script>

    $("#clonett").hide();
    $("#succclonett").hide();


    function deleteItem(o) {
        $(o).parent().parent().remove();
    }


    $(document).ready(function(){




             $(".addtpl").on('click',function(){





              $("#last").before($("#clonett").find(".form-group").clone());


             return false;


             });


        $(".succaddtpl").on('click',function(){



            $("#succlast").before($("#succclonett").find(".form-group").clone());


            return false;


        });

     $("#send").on('click',function(){

         var wangurl = $("input[name='wangurl']").val().trim();

         if(wangurl==''){

             alert("请输入本网站地址");

             return false;
         }

         var $elements = $("input[name='lefttpl[]']");
         var rightlen= $("input[name='righttpl[]']").length;
         var leftlen = $elements.length;
         var i=1;
         var j=1;
         var x=1;
         var y=1
         var succi=1;
         var succj=1;
         var succx=1;
         var succy=1

         var $succelements = $("input[name='succlefttpl[]']");
         var succrightlen= $("input[name='succrighttpl[]']").length;
         var succleftlen = $succelements.length;

         $("input[name='lefttpl[]']").each(function(index,item){

             if(index<(leftlen-1)){

                 if(i!=j){


                     return false;

                 }
                 j+=1;

                 if($(this).val().trim()==''){

                     $(this).focus();

                     alert("左侧栏目请不要留空！");


                 }else {

                     i+=1;


                 }

             }

         })

       
         if(i!=j){


             return false;
         }

         $("input[name='righttpl[]']").each(function(index,item){

             if(index<(rightlen-1)){

                 if(x!=y){


                     return false;

                 }
                 y+=1;

                 if($(this).val().trim()==''){

                     $(this).focus();

                     alert("右侧栏目请不要留空！");


                 }else {

                     x+=1;


                 }

             }

         })
         if(x!=y){


             return false;
         }

//完成订单
         $("input[name='succlefttpl[]']").each(function(index,item){

             if(index<(succleftlen-1)){

                 if(succi!=succj){


                     return false;

                 }
                 succj+=1;

                 if($(this).val().trim()==''){

                     $(this).focus();

                     alert("左侧栏目请不要留空！");


                 }else {

                     succi+=1;


                 }

             }

         })


         if(succi!=succj){


             return false;
         }

         $("input[name='succrighttpl[]']").each(function(index,item){

             if(index<(succrightlen-1)){

                 if(succx!=succy){


                     return false;

                 }
                 succy+=1;

                 if($(this).val().trim()==''){

                     $(this).focus();

                     alert("右侧栏目请不要留空！");


                 }else {

                     succx+=1;


                 }

             }

         })
         if(succx!=succy){


             return false;
         }


       //  alert("开始");
        // return false;
     })





    })
</script>