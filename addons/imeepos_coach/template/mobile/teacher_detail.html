{template 'common/header'}
<link rel="stylesheet" href="{MODULE_URL}public/libs/ionic/css/ionic.css"/>
<link rel="stylesheet" href="{MODULE_URL}public/libs/weui/weui.min.css"/>
<link rel="stylesheet" href="{MODULE_URL}public/libs/jquery_weui/jquery-weui.css"/>
<link rel="stylesheet" href="{MODULE_URL}public/css/iconfont.css"/>
<link rel="stylesheet" href="{MODULE_URL}public/css/common.css"/>
<link rel="stylesheet" href="{MODULE_URL}public/css/index.css"/>
<div class="page-group">
    <style>
        .st{position:absolute;top:20%;left: 20%;z-index:100000;opacity:0.75;color:white;background: rgba(68, 68, 68, 0);background-image: initial;background-position-x: initial;background-position-y: initial;background-size: initial;background-repeat-x: initial;background-repeat-y: initial;background-attachment: initial;background-origin: initial;background-clip: initial;background-color: rgba(68, 68, 68, 0);}
        .page-group{background-color: #f4f4f4;}
        .h44{height:54px;background-color:#f4f4f4;}
        #advSwiper{height:150px;overflow:hidden;}
        .swiper-slide{overflow:hidden;}
        #advSwiper img{width:100%;max-height:2000px !important;}
        .meepo_tabs .meepo_tab-item{width: 50%;float: right;margin-top: 15px;}
        .all{position:absolute;z-index:99999;width: 100%;height: 100%;opacity: 0.75;background-color: #000000;}
    </style>
    <div class="page page-current" id="page-index">
        <div class="content infinite-scroll native-scroll" data-distance="10" style="padding-bottom: 0px;">
            <!--滑动广告--->
            <div class="swiper-container" id="advSwiper">
                <div class="swiper-wrapper">
                    {loop $teacher['images'] $image}
                    <a href="javascript:;" class="swiper-slide">
                        <img src="{php echo tomedia($image)}" />
                    </a>
                    {/loop}
                </div>
            </div>
            <style>
                .detail_title {background-color: #FFF;padding: 15px 10px 5px;overflow: hidden;}
                .detail_title .detail_title_h1 {font-size: 18px;color: #000;line-height: 25px;word-break: break-all;display: -webkit-box;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;max-height: 50px;}
            </style>
            <div class="detail_title">
                <h1 class="detail_title_h1" id="dt_title"></h1>
            </div>
            <style>
                .hdMan {overflow: hidden;background-color: #FFF;height: 26px;position: relative;}
                .hdMan .userPicA {overflow: hidden;width: 26px;height: 26px;border-radius: 26px;position: absolute;left: 10px;top: 0;}
                .hdMan .userPicA img {width: 26px;height: 26px;}
                a img {border: none;}
                img {vertical-align: top;border: 0;}
                .hdMan .hdman_r {padding-left: 44px;line-height: 26px;padding-right: 10px;height: 26px;overflow: hidden;}
                .hdMan .hdman_r .yhName {float: left;}
                .hdMan .hdman_r .yhName a.subinfo_name {color: #0099e9;display: inline-block;white-space: nowrap;text-overflow: ellipsis;-o-text-overflow: ellipsis;overflow: hidden;float: left;max-width: 30px;font-size: 13px;}
                .hdMan .hdman_r .yhName p {display: inline-block;float: left;padding-left: 5px;font-size: 13px;color: #999;}
                .dt_review_item_count {display: inline-block;float: right;}
                .dt_review_item_count a {display: inline-block;float: right;margin-left: 8px;font-size: 13px;color: #999;}
                .dt_review_item_count span {display: inline-block;float: right;font-size: 13px;color: #999;}
            </style>
            <div class="detail_user hdMan">
                <div class="userPicA">
                    <a href="" ontouchstart=""><img src="{php echo tomedia($teacher['avatar'])}"></a>
                </div>
                <div class="hdman_r">
                    <div class="yhName">
                        <a href="" class="subinfo_name" id="subinfo_name" ontouchstart="" style="max-width: 173px;">{$teacher['realname']}</a>
                        <p class="fbTime">{php echo date('Y-m-d H:i',$teacher['create_time'])}</p>
                    </div>
                    <div class="dt_review_item_count">
                        <a class="info_share" id="info_share" style="color: rgb(153, 153, 153);">分享 {$teacher['share_num']}+</a><span id="info_hits">阅读 {$teacher['read_num']}</span>
                    </div>
                </div>
                <div id="maUrlcanvas" style="display:none;"><div id="canvasimage"></div></div>
            </div>
            <style>
                .detail_time_attr_join {overflow: hidden;background-color: #FFF;padding: 10px;}
                div, h1, p, ul, li, label, textarea, input, button, form {margin: 0;padding: 0;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}
                div, h1, p, ul, li, label, textarea, span {word-break: break-all;}
                .detail_time_attr_join_gray {overflow: hidden;background-color: #f5f5f5;}
                .detail_time_attr_join_gray .detail_Time {overflow: hidden;border-bottom: 1px solid #e7e7e7;padding: 7px 0 5px;margin-left: 8px;position: relative;}
                .detail_time_attr_join_gray .detail_Time .icon_T {width: 14px;height: 14px;position: absolute;left: 0;top: 11px;}
                .detail_time_attr_join_gray .detail_Time .detail_Time_n p {padding-left: 20px;line-height: 20px;font-size: 14px;color: #000;}
                .detail_Attr {overflow: hidden;}
                .dt_address_item {display: block;overflow: hidden;}
                a {color: #333;background: transparent;text-decoration: none;}
                .detail_time_attr_join_gray .detail_Attr .detail_Attr_K {border-bottom: 1px solid #e7e7e7;margin-left: 8px;}
                .dt_address_item .addressP {display: block;padding: 10px 10px 10px 20px;line-height: 18px;text-align: left;color: #000;font-size: 14px;background: url(http://cdn.hudongba.com/static_v4/images/detail/xd_icon_5.png) no-repeat 0 12px;background-size: 13px 16px;}
                .detail_time_attr_join_gray .detail_Joinnum {overflow: hidden;padding: 8px 0 10px;margin-left: 8px;}
                detail_time_attr_join_gray .detail_Joinnum .detail_Joinnum_t {display: inline-block;padding-left: 20px;background: url(http://cdn.hudongba.com/static_v4/images/detail/icon_man.png) no-repeat 0 2px;background-size: 14px 14px;font-size: 14px;color: #000;padding-bottom: 5px;line-height: 16px;}
                .detail_time_attr_join_gray .detail_Joinnum .detail_Joinnum_b {padding: 2px 5px 0 20px;font-size: 12px;color: #999;}
                .detail_time_attr_join_gray .detail_Joinnum .detail_Joinnum_t {display: inline-block;padding-left: 20px;background: url(http://cdn.hudongba.com/static_v4/images/detail/icon_man.png) no-repeat 0 2px;background-size: 14px 14px;font-size: 14px;color: #000;padding-bottom: 5px;line-height: 16px;}
            </style>
            <div class="detail_time_attr_join">
                <div class="detail_time_attr_join_gray">
                    <div class="detail_Time">
                        <div class="detail_Time_n">
                            <p>
                                姓名：{$teacher['realname']}<br>
                            </p>
                        </div>
                    </div>
                    <div class="detail_Time">
                        <div class="detail_Time_n">
                            <p>
                                电话：{$teacher['mobile']}<br>
                            </p>
                        </div>
                    </div>
                    <div class="detail_Joinnum" id="detail_Joinnum">
                        <div class="detail_Joinnum_t"><p>已有<span>{$teacher['post_num']}</span>人报名</p></div>
                    </div>
                </div>
            </div>

            <div class="hd" style="padding:10px;">
                <p>
                    {php echo $teacher['desc']}
                </p>
            </div>
            <div class="weui_btn_area" id="post">
                {php $mylog = M('teacher_log')->getMy($teacher_id);}
                {if !empty($mylog)}
                {if $mylog['status'] == 0}
                <a class="weui_btn weui_btn_primary" style="{if $mylog['status'] == 0}display:block;{else}display:none;{/if}" href="javascript:" id="scanqrcode">扫码签到</a>
                <a class="weui_btn weui_btn_default" style="display:none;" href="javascript:">已完成</a>
                {else}
                <a class="weui_btn weui_btn_primary" href="javascript:">已完成</a>
                {/if}
                {else}
                <a class="weui_btn weui_btn_primary" href="javascript:" id="showTooltips">立即预约</a>
                <a class="weui_btn weui_btn_primary" style="display:none;" href="javascript:" id="scanqrcode">扫码签到</a>
                {/if}
            </div>
        </div>
        <div class="h44"></div>
        {template 'common/footerbar'}
    </div>
</div>
<div class="weui_dialog weui_dialog_visible" id="item" style="display:none;">
    <div class="weui_dialog_hd">
        <strong class="weui_dialog_title">预约表单</strong>
    </div>
    <div class="weui_dialog_bd">
        {php $member = M('member')->getInfo($_W['openid'])}
        <div class="weui_cell" style="padding: 0px;">
            <div class="weui_cell_hd"><label class="weui_label">姓名</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" type="text" name="realname" value="{$member['realname']}" placeholder="请输入姓名">
            </div>
        </div>
        <div class="weui_cell" style="padding: 0px;">
            <div class="weui_cell_hd"><label class="weui_label">手机号码</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" type="number" name="mobile" value="{$member['mobile']}" placeholder="请输入手机号码">
            </div>
        </div>
        <div class="weui_cell" style="padding: 0px;">
            <div class="weui_cell_hd"><label class="weui_label">开始时间</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="start_time" type="text" name="start_time" value="" placeholder="">
            </div>
        </div>
        <div class="weui_cell" style="padding: 0px;">
            <div class="weui_cell_hd"><label class="weui_label">结束时间</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="end_time" type="text" name="end_time" value="" placeholder="">
            </div>
        </div>
    </div>
    <div class="weui_dialog_ft">
        <a href="javascript:;" class="weui_btn_dialog default">取消</a>
        <a href="javascript:;" class="weui_btn_dialog postData">提交</a>
    </div>
</div>

<script>
    require(["{MODULE_URL}public/libs/jquery_weui/jquery-weui.js"],function(){
        var html = $('#item').html();
        wx.config(jssdkconfig);

        $("#start_time").datetimePicker();
        $("#end_time").datetimePicker();

        function scanqrcode(type){
            wx.ready(function(){
                wx.scanQRCode({
                    needResult: 1,
                    scanType: ["qrCode","barCode"],
                    success: function (res) {
                        var result = res.resultStr;
                        $.post("{php echo $this->createMobileUrl('scanqrcode')}",{type:type,result:result},function(data){
                            if(data.status == 1){

                            }else{

                            }
                        });
                    }
                });
            });
        }
        $('#scanqrcode').click(function(){
            scanqrcode('manage');
        });
        $('#showTooltips').click(function(){
            var _that = $(this);
            $('#item').show();
        });
        $('#item .default').click(function(){
            $('#item').hide();
        });
        $('#item .postData').click(function(){
            var realname = $('input[name="realname"]').val();
            var mobile = $('input[name="mobile"]').val();
            var start_time = $('#start_time').val();
            var end_time = $('#end_time').val();
            var post = {realname:realname,mobile:mobile,start_time:start_time,end_time:end_time};
            $.post("{php echo $_W['siteurl']}",post,function(data){
                $('#item').hide();
                if(data.status == 0){
                    $.toast(data.message);
                    setTimeout(function(){
                        $('.weui_toast').remove();
                    },1000);
                    var post_num = $('#detail_Joinnum span').html();
                    post_num = parseInt(post_num)+1;
                    $('#detail_Joinnum span').html(post_num);
                    $('#scanqrcode').show();
                }else{
                    $.toast(data.message,'forbidden');
                    setTimeout(function(){
                        $('.weui_toast').remove();
                    },1000);
                }
            },'json');
        });
    });
</script>
{template 'common/footer'}