<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>闲书币明细</title>
    <meta name="format-detection" content="telephone=no, address=no">
    <meta name="apple-mobile-web-app-capable" content="yes" /> <!-- apple devices fullscreen -->
    <meta name="apple-touch-fullscreen" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="keywords" content="{if empty($_W['page']['keywords'])}{if IMS_FAMILY != 'x'}微擎,微信,微信公众平台,we7.cc{/if}{else}{$_W['page']['keywords']}{/if}" />
    <meta name="description" content="{if empty($_W['page']['description'])}{if IMS_FAMILY != 'x'}公众平台自助引擎（www.we7.cc），简称微擎，微擎是一款免费开源的微信公众平台管理系统，是国内最完善移动网站及移动互联网技术解决方案。{/if}{else}{$_W['page']['description']}{/if}" />
    <link rel="shortcut icon" href="{$_W['siteroot']}{$_W['config']['upload']['attachdir']}/{if !empty($_W['setting']['copyright']['icon'])}{$_W['setting']['copyright']['icon']}{else}images/global/wechat.jpg{/if}" />
    <script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
    <script type="text/javascript" src="{$_W['siteroot']}app/resource/js/app/util.js"></script>
    <script src="{$_W['siteroot']}app/resource/js/require.js"></script>
    <script type="text/javascript" src="{$_W['siteroot']}app/resource/js/lib/jquery-1.11.1.min.js?v=20160906"></script>
    <script type="text/javascript" src="{$_W['siteroot']}app/resource/js/lib/mui.min.js?v=20160906"></script>
    <script type="text/javascript" src="{$_W['siteroot']}app/resource/js/app/common.js?v=20160906"></script>
    <link href="{$_W['siteroot']}app/resource/css/bootstrap.min.css?v=20160906" rel="stylesheet">
    <link href="{$_W['siteroot']}app/resource/css/common.min.css?v=20160906" rel="stylesheet">
    <script type="text/javascript">
        if(navigator.appName == 'Microsoft Internet Explorer'){
            if(navigator.userAgent.indexOf("MSIE 5.0")>0 || navigator.userAgent.indexOf("MSIE 6.0")>0 || navigator.userAgent.indexOf("MSIE 7.0")>0) {
                alert('您使用的 IE 浏览器版本过低, 推荐使用 Chrome 浏览器或 IE8 及以上版本浏览器.');
            }
        }
        window.sysinfo = {
        {if !empty($_W['uniacid'])}'uniacid': '{$_W['uniacid']}',{/if}
        {if !empty($_W['acid'])}'acid': '{$_W['acid']}',{/if}{if !empty($_W['openid'])}'openid': '{$_W['openid']}',{/if}
        {if !empty($_W['uid'])}'uid': '{$_W['uid']}',{/if}
        'siteroot': '{$_W['siteroot']}',
                'siteurl': '{$_W['siteurl']}',
                'attachurl': '{$_W['attachurl']}',
                'attachurl_local': '{$_W['attachurl_local']}',
                'attachurl_remote': '{$_W['attachurl_remote']}',
        {if defined('MODULE_URL')}'MODULE_URL': '{MODULE_URL}',{/if}
        'cookie' : {'pre': '{$_W['config']['cookie']['pre']}'}
        };
        // jssdk config 对象
        jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
        // 是否启用调试
        jssdkconfig.debug = false;
        jssdkconfig.jsApiList = [
            'checkJsApi',
            'onMenuShareTimeline',
            'onMenuShareAppMessage',
            'onMenuShareQQ',
            'onMenuShareWeibo',
            'hideMenuItems',
            'showMenuItems',
            'hideAllNonBaseMenuItem',
            'showAllNonBaseMenuItem',
            'translateVoice',
            'startRecord',
            'stopRecord',
            'onRecordEnd',
            'playVoice',
            'pauseVoice',
            'stopVoice',
            'uploadVoice',
            'downloadVoice',
            'chooseImage',
            'previewImage',
            'uploadImage',
            'downloadImage',
            'getNetworkType',
            'openLocation',
            'getLocation',
            'hideOptionMenu',
            'showOptionMenu',
            'closeWindow',
            'scanQRCode',
            'chooseWXPay',
            'openProductSpecificView',
            'addCard',
            'chooseCard',
            'openCard',
            'openAddress'
        ];
    </script>
</head>
<body>
<div class="container container-fill">
    {php define('MUI', true);}
    <header class="mui-bar mui-bar-nav">
        {if $_W['container'] !== 'wechat'}
        <div class="mui-row fixed-bar">
            <div class="mui-col-xs-4">
                <button class="mui-btn mui-btn-link mui-btn-nav mui-pull-left mui-action-back">
                    <span class="mui-icon mui-icon-left-nav"></span>
                    返回
                </button>
            </div>
            <div class="mui-col-xs-4 mui-text-center">{if !empty($title)}{$title}{elseif !empty($_W['page']['title'])}{$_W['page']['title']}{/if}</div>
            <div class="mui-col-xs-4 mui-text-right">
                <a href="#consume-date">
                    <span>{if $_GPC['period'] <= 0}{php echo date('Y.m', strtotime($_GPC['period'] . 'month'))}{else}查看全部{/if}</span>
                    <span class="fa fa-angle-down mui-text-muted"></span>
                </a>
            </div>
        </div>
        {else}
        <div class="mui-row fixed-bar">
            <div class="mui-col-xs-6"></div>
            <div class="mui-col-xs-6 mui-text-right">
                <a href="#consume-date">
                    <span>{if $_GPC['period'] <= 0}{php echo date('Y.m', strtotime($_GPC['period'] . 'month'))}{else}查看全部{/if}</span>
                    <span class="fa fa-angle-down mui-text-muted"></span>
                </a>
            </div>
        </div>
        {/if}
    </header>
    <div class="mui-content">
        <div class="mui-table mui-table-inline mui-pa10">
            <div class="mui-table-cell">
                <div class="mui-text-muted ">上架增额</div>{$mz_amount}元
            </div>
            <div class="mui-table-cell">
                <div class="mui-text-muted">集赞增额</div>{$jy_amount}元
            </div>
            <div class="mui-table-cell">
                <div class="mui-text-muted">押金额度</div>{$cz_amount}元
            </div>
            <div class="mui-table-cell">
                <div class="mui-text-muted">交易差额</div>{$ce_amount}元
            </div>
        </div>
        <div class="credits-display">
            <ul class="mui-table-view mui-credits">
                {loop $data $row}
                <li class="mui-table-view-cell">
                    <a href="#">
                        <div class="mui-row">
                            <div class="mui-col-xs-6 mui-ellipsis-2">
                                {$row['remark']}
                            </div>
                            <div class="mui-col-xs-6 mui-text-right">
							<span class="mui-big mui-rmb" style="color:{php echo $row['color']}">
								<span class="money" style="color:{php echo $row['color']}">{$row['amount']}</span>
							</span>
                                <span class="mui-block mui-text-muted mui-small">{$row['createDate']}</span>
                            </div>
                        </div>
                    </a>
                </li>
                {/loop}
            </ul>
        </div>
        <div id="consume-date" class="mui-popover mui-popover-top">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell">
                    <a href="{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record','period' => 1), true)}">查看全部</a>
                </li>
                <li class="mui-table-view-cell">
                    <a href="{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record','period' => 0), true)}">{php echo date('Y.m', strtotime('today'))}</a>
                </li>
                <li class="mui-table-view-cell">
                    <a href="{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record','period' => -1), true)}">{php echo date('Y.m', strtotime('-1month'))}</a>
                </li>
                <li class="mui-table-view-cell">
                    <a href="{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record','period' => -2), true)}">{php echo date('Y.m', strtotime('-2month'))}</a>
                </li>
            </ul>
        </div>
    </div>
    <script>
        require(['mui.pullrefresh'], function(mui) {
            mui.init();
            mui.ready(function() {
                var page = 2;
                var pagetotal = {$pagenums} + 1;
                if (page < pagetotal) {
                    //循环初始化所有下拉刷新，上拉加载。
                    mui.each(document.querySelectorAll('.credits-display'), function(index, pullRefreshEl) {
                        mui(pullRefreshEl).pullToRefresh({
                            up: {
                                callback: function() {
                                    var self = this;
                                    setTimeout(function() {
                                        $('.mui-pull-bottom-tips').hide();
                                        var ul = self.element.querySelector('.mui-credits');
                                        ul.appendChild(createFragment(ul, index, 5));
                                        if (pagetotal <= page) {
                                            $('.mui-pull-bottom-tips').hide();
                                            self.endPullUpToRefresh(true);
                                        } else {
                                            self.endPullUpToRefresh(false);
                                        }
                                    }, 1000);
                                }
                            }
                        });
                    });

                    var createFragment = function(ul, index, count, reverse) {
                        var length = ul.querySelectorAll('li').length;
                        var fragment = document.createDocumentFragment();
                        var li;
                        var url = "{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record', 'period' => $_GPC['period']), true)}";
                        mui.post(url, {'page' : page}, function(data){
                            data = $.parseJSON(data);
                            if (data.state == 'error') {
                                return false;
                            }
                            for (var i in data) {
                                var href = "{php echo $this->createMobileUrl('scorelist', array('schoolid' => $schoolid,'credittype' => 'credit2','type' => 'record', 'period' => $_GPC['period']), true)}";
                                li = document.createElement('li');
                                li.className = 'mui-table-view-cell';
                                li.innerHTML = '<a href="' + href + '&id=' + data[i].id + '" ><div class="mui-row"><div class="mui-col-xs-6 mui-ellipsis-2">' + data[i].remark + '</div><div class="mui-col-xs-6 mui-text-right"><span class="mui-big mui-rmb" style="color:' + data[i].color + '"><span class="money" style="color:' + data[i].color + '">' + data[i].num + '</span></span><span class="mui-block mui-text-muted mui-small">' + data[i].createtime + '</span></div></div></a>';
                                ul.appendChild(li, ul.firstChild);
                            }
                            $('.mui-pull-bottom-tips').show();
                        });
                        page++;
                        return fragment;
                    };
                }
            });
        });
    </script>
    {if empty($footer_off)}
    <div class="text-center footer" style="margin:10px 0; width:100%; text-align:center; word-break:break-all;">
        {if !empty($_W['page']['footer'])}
        {$_W['page']['footer']}
        {else}
        {if IMS_FAMILY != 'x'}<a href="http://www.we7.cc">关于微擎</a>&nbsp;&nbsp;<a href="http://bbs.we7.cc">微擎帮助</a>{/if}
        {/if}
        &nbsp;&nbsp;{$_W['setting']['copyright']['statcode']}
    </div>
    {/if}
    {if $_GPC['c'] == 'home' && $_GPC['a'] == 'page'}
    {if $bottom_menu}
    {data func="site_quickmenu"}{/data}
    {/if}
    {else}
    {if $_GPC['m'] != 'paycenter'}
    {data func="site_quickmenu"}{/data}
    {/if}
    {/if}
</div>
<style>
    h5{color:#555;}
</style>
<?php
		$_share['title'] = !empty($_share['title']) ? $_share['title'] : $_W['account']['name'];
		$_share['imgUrl'] = !empty($_share['imgUrl']) ? $_share['imgUrl'] : '';
		if(isset($_share['content'])){
			$_share['desc'] = $_share['content'];
			unset($_share['content']);
		}
		$_share['desc'] = !empty($_share['desc']) ? $_share['desc'] : '';
		$_share['desc'] = preg_replace('/\s/i', '', str_replace('	', '', cutstr(str_replace('&nbsp;', '', ihtmlspecialchars(strip_tags($_share['desc']))), 60)));
		if(empty($_share['link'])) {
			$_share['link'] = '';
			$query_string = $_SERVER['QUERY_STRING'];
			if(!empty($query_string)) {
				parse_str($query_string, $query_arr);
				$query_arr['u'] = $_W['member']['uid'];
				$query_string = http_build_query($query_arr);
				$_share['link'] = $_W['siteroot'].'app/index.php?'. $query_string;
			}
		}
	?>
<script type="text/javascript">
    $(function(){
        wx.config(jssdkconfig);
        var $_share = {php echo json_encode($_share);};
        if(typeof sharedata == 'undefined'){
            sharedata = $_share;
        } else {
            sharedata['title'] = sharedata['title'] || $_share['title'];
            sharedata['desc'] = sharedata['desc'] || $_share['desc'];
            sharedata['link'] = sharedata['link'] || $_share['link'];
            sharedata['imgUrl'] = sharedata['imgUrl'] || $_share['imgUrl'];
        }
        if(sharedata.imgUrl == ''){
            var _share_img = $('body img:eq(0)').attr("src");
            if(_share_img == ""){
                sharedata['imgUrl'] = window.sysinfo.attachurl + 'images/global/wechat_share.png';
            } else {
                sharedata['imgUrl'] = util.tomedia(_share_img);
            }
        }
        if(sharedata.desc == ''){
            var _share_content = util.removeHTMLTag($('body').html());
            if(typeof _share_content == 'string'){
                sharedata.desc = _share_content.replace($_share['title'], '')
            }
        }
        wx.ready(function () {
            wx.onMenuShareAppMessage(sharedata);
            wx.onMenuShareTimeline(sharedata);
            wx.onMenuShareQQ(sharedata);
            wx.onMenuShareWeibo(sharedata);
        });
        {if $controller == 'site' && $action == 'site'}
        $('#category_show').click(function(){
            $('.head .order').toggleClass('hide');
            return false;
        });
        //文章点击和分享加积分
        {if !empty($_GPC['u'])}
        var url = "{php echo url('site/site/handsel/', array('id' => $detail['id'], 'action' => 'click', 'u' => $_GPC['u']), true);}";
        $.post(url, function(dat){});
        {/if}
        sharedata.success = function(){
            var url = "{php echo url('site/site/handsel/', array('id' => $detail['id'], 'action' => 'share'));}";
            $.post(url, function(dat){});
        }
        {/if}
        if($('.js-quickmenu')!=null && $('.js-quickmenu')!=''){
            var h = $('.js-quickmenu .nav-home').height()+20+'px';
            $('body').css("padding-bottom",h);
            $('body .mui-content').css("bottom",h);
        }else{
            $('body').css("padding-bottom",0);
            $('body .mui-content').css("bottom", "0");
        }

        if($('.nav-menu-app')!=null && $('.nav-menu-app')!=''){
            var h = $('.nav-menu-app').height()+'px';
            $('body').css("padding-bottom",h);
            $('.mui-content').css('bottom',h);
        }else{
            $('body').css("padding-bottom", "0");
            $('.mui-content').css('bottom', "0");
        }
    });
</script>
</body>
</html>