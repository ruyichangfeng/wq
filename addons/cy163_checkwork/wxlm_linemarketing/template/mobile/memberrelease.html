<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0;" />
<title>{$config['mobile_member_title']}</title>
{template 'head'}
</head>
</head>
<body>
 <input type="hidden" id="store_id" value="{$store_id}" >
<div class="mnav mcolor-b" {if $config['mobile_diy2_bcolor']!=''} style="background-color: {$config['mobile_diy2_bcolor']}"{/if}>
    <a href="javascript:backss();" class="mbackbtn_a"><div class="mbackbtn"><img src="{RES}/public/images/m_btn_back.png"/></div></a>
   {if $config['mobile_diy2_title']!=''}{$config['mobile_diy2_title']}{else}发放{/if}
</div>
<div class="container-fluid">
    <div class="row" style="margin-top:20px;">
		<div class="col-xs-3 m_box_p1">
			<div class="mtitle">
				消费类型
			</div>
		</div>
		<div class="col-xs-8">
			<div class="btn-group" style="width:100%;">
				<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" id="spending_title" aria-expanded="false" style="width:100%;">{$spending_one['spending_title']} <span class="caret"></span></button>
				<input type="hidden" id="spending_id" value="{$spending_one['spending_id']}" >
				<ul class="dropdown-menu "  style="width:100%; text-align:center;">
					{loop $spending_list $key $item}
					<li><a href="javascript:urljump({$item['spending_id']},{$store_id});">{$item['spending_title']}</a></li>
					{/loop}
				</ul>
			</div>
		</div>
	</div>
    
    <div class="m_bg1">
    <div class="row">
		<div class="col-xs-3 m_box_p1">
			<div class="mtitle">
				消费金额
			</div>
		</div>
		<div class="col-xs-8">
            <div class="input-group">
                <span class="input-group-addon">￥</span>
                <input type="text" id="money" class="form-control" readonly value="0" maxlength="9"  style="text-align:right">
                <span class="input-group-addon">元</span>
            </div>
		</div>
	</div>
    </div>
    
    <div class="row" style="margin-top:20px; padding-left:10px; padding-right:10px;">
        <div class="col-xs-4 m_an">
			<a href="javascript:number(1);"><img src="{RES}/public/images/m_an_1.png"/></a>
		</div>
        <div class="col-xs-4 m_an" >
			<a href="javascript:number(2);"><img src="{RES}/public/images/m_an_2.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(3);"><img src="{RES}/public/images/m_an_3.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(4);"><img src="{RES}/public/images/m_an_4.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(5);"><img src="{RES}/public/images/m_an_5.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(6);"><img src="{RES}/public/images/m_an_6.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(7);"><img src="{RES}/public/images/m_an_7.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(8);"><img src="{RES}/public/images/m_an_8.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(9);"><img src="{RES}/public/images/m_an_9.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(0);"><img src="{RES}/public/images/m_an_10.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(11);"><img src="{RES}/public/images/m_an_11.png"/></a>
		</div>
        <div class="col-xs-4 m_an">
			<a href="javascript:number(12);"><img src="{RES}/public/images/m_an_12.png"/></a>
		</div>
    </div>
    
    <div class="m_box_w1">
        <a href="javascript:getqrcode();"><img src="{RES}/public/images/m_btn2.png" class="m_btn_a" /></a>
    </div>
	<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" id="tanchukuang">
	  <div class="modal-dialog modal-sm" role="document">
	    <div class="modal-content" style="text-align: center;">
	    	<div>
	    		<img src="" alt="" id="qrcodeimg" style="margin:1em auto 0em;width: 100%;">
	    	</div>
	    	<div id="tishi" style="font-size: 1.1em;margin: 2em 0em;">
	    		
	    	</div>
	    </div>
	  </div>
	</div>
    
</div>
<script>
		var storeid=$('#store_id').val();  
  		function number(num)
  		{
  			var va = $("#money").val();
  			if(num<10&&va.length<9)
  			{
  				if(va.indexOf(".")!=-1)
	  			{
	  				if(va.split(".")[1].length<2)
	  				{
	  					if (va == 0) {  
		                	$("#money").val(num);  
			            }  
			            else {  
			                $("#money").val(va + num);  
			            } 
	  				}
	  			}else{
	  				if (va == 0) {  
                	$("#money").val(num);  
		            }  
		            else {  
		                $("#money").val(va + num);  
		            } 
	  			}
  				
  			}
  			if(num==11)
  			{
				if(va.indexOf(".")==-1)
				{
					$("#money").val(va + '.');
				}
  			}
  			if(num==12)
  			{
  				if (va.length>1) {  
                	$("#money").val(va.substring(0,va.length-1));
	            }
	            if(va.length==1)
	            {
	            	$("#money").val(0);
	            }
  			}
  			 
  		}

  		/** 提交表单生成二维码 */    
  		function getqrcode()
  		{
  			/* 消费类型  消费金额 */
  			var type=$('#spending_id').val(),
  				number=$('#money').val();
  				
  			if(storeid=='')
  			{
  				alert('未获取到门店信息，请重新进入!');
  			}else if (type=='')	
  			{
  				alert('请填写消费类型!');
  			}else if (number==0){
  				alert('请填写消费金额')
  			}else{
  				$.ajax({  
		        type:"POST",
		        url: "{php echo $this->createMobileUrl('ajaxgetqrcode');}",
		        data:{type:type,number:number,storeid:storeid},
		        dataType:"json",
		        async:false,
		        success: function(data){
		        	if(data.result=='success')
		        	{
		        		 $('#tanchukuang').modal('show');
		        		 $('#qrcodeimg').attr('src',data.qr);
 						 $('#tishi').html('扫描上方二维码赠送'+data.jifen+data.type);
		        	}else if(data.result=='error'){
		        		op=data.rs1+'<br>'+data.rs2+'<br>';
		        		$('#tanchukuang').modal('show');
		        		$('#qrcodeimg').addClass('hide');
		        		$('#tishi').html(op);
		        	}else{
		        		$('#tanchukuang').modal('show');
		        		$('#qrcodeimg').addClass('hide');
		        		$('#tishi').html(data.rs);
		        	}
		        }
	        	});
  			}	
  		}  
  		function urljump(id,storeid)
  		{
  			var url="{php echo $this->createMobileUrl('memberrelease');}";
			window.location.href=url+'&spending_id='+id+"&store_id="+storeid;
  		}
  		
		function backss(){
			var url="{php echo $this->createMobileUrl('memberlogin');}";
			window.location.href=url+"&store_id="+storeid;
		}

		function closess(){
			var url="{php echo $this->createMobileUrl('memberrelease');}";
			window.location.href=url+"&store_id="+storeid;
		}

	$('#tanchukuang').on('hidden.bs.modal', function (e) {
		closess();
	})
</script>


{template 'foot-msg'}
</body>
</html>