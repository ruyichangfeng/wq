<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0,maximum-scale=1.0,minimum-scale=1,user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>{$wechatgoods['gwn_name']}</title>
    <link rel="stylesheet" href="{HLMMS_MOBILE_MESSI}messi/iconfont/iconfont.css"/>
    <link rel="stylesheet" href="{HLMMS_MOBILE_MESSI}jqueryweui/css/weui.min.css"/>
    <link rel="stylesheet" href="{HLMMS_MOBILE_MESSI}jqueryweui/css/jquery-weui.min.css"/>
    <link rel="stylesheet" href="{HLMMS_MOBILE_MESSI}messi/css/common2.css"/>
    <script>
        var deviceWidth = document.documentElement.clientWidth;
        document.documentElement.style.fontSize = deviceWidth / 7.5 + 'px';
    </script>
    {php echo register_jssdk(false);}
    <style>
        body{background:#F0EFF5;padding-bottom:1rem;}
        #header{max-width:7.5rem;padding:0 0.2rem;height:1rem;line-height:1rem;background:#f7f7f7;color:#000;}
        #header .back{width:1rem;font-size:0.32rem;}
        #header .back span{font-size:0.28rem;margin-left:0.05rem;}
        #header .title{font-size:0.32rem;flex:1;}
        #header .other{width:1rem;}

        .goods-header{border-bottom:1px solid #f1f1f1;padding:0.1rem;background:#fff;margin-bottom:0.2rem;}
        .goods-header .title{font-size:0.34rem;color:#333;}
        .goods-header .miaosha{line-height:0.4rem;height:0.4rem;font-size:0.28rem;margin:0.2rem auto;color:#C0C0C0;}
        .goods-header .miaosha span{font-size:0.4rem;color:#ef4f4f;font-weight:bold;}
        .goods-header .time{line-height:0.4rem;height:0.4rem;margin-bottom:0.2rem;}
        .goods-header .time span{display:inline-block;line-height:0.4rem;height:0.4rem;float:left;font-size:0.3rem;}
        .goods-header .time .num{background:#ef4f4f;color:#fff;padding:0 0.2rem;}
        .goods-header .time .text{color:#C0C0C0;padding:0 0.1rem;}

        .goods-header .goods-price{line-height:0.4rem;color:#f44;height:0.4rem;font-size:0.4rem;margin:0.2rem auto;}
        .goods-header .goods-price span{font-size:0.4rem;color:#ef4f4f;font-weight:bold;}
        .goods-header .goods-price span.original{font-size:0.28rem;color:#C0C0C0;padding-left:0.2rem;text-decoration:line-through;font-weight:normal;}
        .goods-header .num{height:0.4rem;line-height:0.4rem;font-size:0.28rem;color:#c0c0c0;}
        .goods-header .num div{flex:1;}

        .store{background:#fff;border-top:solid 1px #f1f1f1;border-bottom:solid 1px #f1f1f1;margin-bottom:0.2rem;padding:0.2rem;height:1.4rem;}
        .store img{width:1rem;height:1rem;}
        .store .storename{flex:1;height:1rem;line-height:1rem;font-size:0.32rem;color:#333333;padding-left:0.2rem;}
        .store a{display:block;height:0.6rem;line-height:0.6rem;font-size:0.28rem;border-radius:0.4rem;margin-top:0.2rem;border:solid 1px #7c7c7c;color:#7c7c7c;padding:0 0.2rem;}

        .detailtab{background:#fff;border-top:1px solid #f1f1f1;border-bottom:1px solid #f1f1f1;}
        .detailtab .item{width:90%;margin:0 auto;height:0.8rem;line-height:0.8rem;font-size:0.32rem;color:#333;border-bottom:1px solid #f1f1f1;}
        .detailtab .detail{padding:0.1rem;}
        .detailtab .detail img{margin-bottom:0.1rem;}

        .banquan{height:0.8rem;line-height:0.8rem;text-align:center;font-size:0.3rem;color:#999;}
        .banquan a{color:#000;}

        #footer{max-width:7.5rem;height:1rem;position:fixed;z-index:99;bottom:0;background:#fff;border-top:solid 1px #f1f1f1;}
        #footer .iconfontdiv{flex:1;height:1rem;color:#999;}
        #footer .iconfontdiv a{color:#999;}
        #footer .iconfontdiv .iconfont{font-size:0.45rem;height:0.6rem;line-height:0.6rem;}
        #footer .iconfontdiv .text{font-size:0.28rem;height:0.3rem;line-height:0.3rem;margin-top:0.05rem;}
        #footer .addtocart{height:1rem;line-height:1rem;color:#fff;font-size:0.32rem;background:#fe9402;width:2.3rem;}
        #footer .zjbuy{height:1rem;line-height:1rem;color:#fff;font-size:0.32rem;background:#fd5555;width:2.3rem;}

        .options{padding-top:0.2rem;width:100%;position:fixed;z-index:999;background:#fff;bottom:0;left:0;border-top:solid 1px #f2f2f2;clear:both;}
        .options .close{font-size:0.36rem;width:0.6rem;height:0.6rem;line-height:0.5rem;border:solid 1px #f2f2f2;border-radius:0.6rem;position:absolute;right:0.1rem;margin-top:-0.1rem;background:#fff;}
        .options .goodsmsg{width:7.1rem;height:1.4rem;border-bottom:solid 1px #f2f2f2;padding:0 0 0.2rem 0;}
        .options .goodsmsg .img{width:1.2rem;height:1.2rem;}
        .options .goodsmsg .img img{width:1.2rem;height:1.2rem;}
        .options .goodsmsg .info{width:5rem;height:1.2rem;flex:1;padding-left:0.2rem;}
        .options .goodsmsg .info .goodsname{color:#333;font-size:0.34rem;height:0.6rem;line-height:0.6rem;}
        .options .goodsmsg .info .price{font-size:0.3rem;height:0.6rem;line-height:0.6rem;}
        .options .goodsmsg .info .price div{width:50%;float:left;color:#999;}

        .options .optionname{width:7.1rem;margin:0 auto;padding-top:0.2rem;border-bottom:solid 1px #f2f2f2;float:left;padding-left:0.2rem;}
        .options .optionname .chose{height:0.4rem;line-height:0.4rem;font-size:0.32rem;color:#666;margin-bottom:0.2rem;}
        .options .optionitems{float:left;}
        .options .optionitems .item{
            border:solid 1px #666;
            border-radius:0.05rem;
            font-size:0.28rem;
            height:0.5rem;
            line-height:0.5rem;
            color:#666;
            margin-bottom:0.2rem;
            padding:0 0.1rem;
            float:left;
            display:inline-block;
            margin-right:0.2rem;
        }
        .options .optionitems .now{border:solid 1px #F44;color:#F44;}
        .options .buynum{border-bottom:solid 1px #f2f2f2;padding:0.2rem 0;height:1rem;width:7.1rem;margin:0 auto;clear:both;}
        .options .buynum .text{height:0.6rem;line-height:0.6rem;font-size:0.32rem;flex:1;color:#666;}
        .options .buynum .numgroup{height:0.6rem;width:2.1rem;}
        .options .buynum .numgroup .Decrease i,.options .buynum .numgroup .DisDe i,.options .buynum .numgroup .Increase i{width:0.6rem;height:0.5rem;line-height:0.5rem;font-size:0.55rem;color:#666;display:block;float:left;text-align:center;border:solid 1px #ccc; font-style:normal;}
        .options .buynum .numgroup .DisDe i,.options .buynum .numgroup .Decrease i{border-right:none;}
        .options .buynum .numgroup .DisDe i{background:#f2f2f2;}
        .options .buynum .numgroup .Increase i{border-left:none;}
        .options .buynum .numgroup .Amount{width:0.8rem;height:0.5rem;line-height:0.5rem;display:block;float:left;text-align:center;border:solid 1px #ccc;border-radius:0;color:#666;-webkit-appearance: none;}
        .options .next{height:0.9rem;line-height:0.9rem;color:#fff;font-size:0.32rem;background:#f44;}	.shouqing{width:1.8rem;height:1.8rem;line-height:1.8rem;font-size:1.8rem;color:#999;position:absolute;z-index:9999;margin-top:-1.2rem;right:0.6rem;}
    </style>
</head>

<body>
<div id="header" class="flex">
    <div class="back iconfont" onclick="history.go(-1)">&#xe612;<span>返回</span></div>
    <div class="title text-c">商品详情</div>
    <div class="other"></div>
</div>

<div class="swiper-container" data-space-between='10' data-pagination='.swiper-pagination' data-autoplay="1000">
    <div class="swiper-wrapper">
        {loop $piclist $row}
        <div class="swiper-slide text-c"><img src="{php echo tomedia($row);}" style="max-width:100%;" /></div>
        {/loop}
    </div>
    <div class="swiper-pagination"></div>
</div>

<div class="goods-header">
    <div class="title textellipsis2">
        {$wechatgoods['gwn_name']}
    </div>
    <div class="goods-price"><span>{$wechatgoods['gwm_wechatMallPrice']} 元</span><span class="original">原价： ￥{$wechatgoods['gwm_wechatMarketPrice']}元</span></div>
    <div class="flex num">
        <div>
            {if $goods['goo_goodsOrService'] == 1 }
            剩余:{$goods['goo_number']}件
            {else}
            无限制
            {/if}

        </div>
        <div style="color: #AA2B02">已购买: {php echo util::getGoodsConsumeCount($wechatgoods['goods_id'],$storeid);}件</div>
    </div>
</div>

<div class="store flex">
    <img src="{php echo tomedia($setStoreData['set_storeLogo']);}" />
    <div class="storename textellipsis1">{php echo $setStoreData['set_storeName']}</div>
    <a href="{php echo $this->createMobileUrl('wechatmall',array('op' => 'index','storeid'=>$storeid))}">进店逛逛</a>
</div>

<div class="detailtab">
    <div class="item">商品详情</div>
    <div class="detail">
        <div style="font-size:0.3rem;padding:0.15rem 0;">
            {php echo str_replace("\n","<br/>",$goods['goo_content']);}
        </div>
    </div>
</div>
<div class="banquan">
    {php echo $setStoreData['set_storeName']}
</div>

<div class="blackbg hide"></div>
<div class="options hide">
    <div class="iconfont close text-c">&#xe736;</div>
    <div class="goodsmsg flex">
        <div class="img"><img src="{php echo tomedia($goods['goo_picture'])}" /></div>
        <div class="info">
            <div class="goodsname textellipsis1">{$wechatgoods['gwn_name']}</div>
            <div class="price">
                <div id="showprice">{$wechatgoods['gwm_wechatMallPrice']}元</div>
                <input type="hidden" id="hidden_specificationjsonstock" value="{php echo util::getGoodsOneData($wechatgoods['goods_id'])['goo_number']}" name="hidden_specificationjsonstock"/>
                <input type="hidden" id="hidden_specification_price"  name="hidden_specification_price"/>


                <div class="text-r" id="showstock">
                    {if $goods['goo_goodsOrService'] == 1 }
                    库存：{php echo util::getGoodsOneData($wechatgoods['goods_id'])['goo_number']}
                    {else}
                   无限制
                    {/if}

                </div>
            </div>
            <div class="shouqing iconfont text-c hide">&#xe694;</div>
        </div>
    </div>
    {if !empty($goods['goo_specificationjson']) || $goods['goo_size'] == 1}
    <div class="optionname">
        <div class="chose">选择规格</div>
        <div class="optionitems">
            {loop $goo_specificationjson   $key $goo_specificationjsonitem}
            <span class="item" attr-optionid="{$goo_specificationjsonitem['specification_title']}">{$goo_specificationjsonitem['specification_title']}</span>
            {/loop}
        </div>
    </div>
    {/if}
    <div class="buynum flex">
        <div class="text">购买数量</div>
        <div class="numgroup Spinner">

        </div>
    </div>
    <div class="next text-c">确定</div>
</div>


<div id="footer" class="flex">
    <div class="iconfontdiv text-c">
        <a href="tel:{php echo $setStoreData['set_storeContactTel']}">
            <div class="iconfont">&#xe645;</div>
            <div class="text">联系商家</div>
        </a>
    </div>
    <div class="iconfontdiv text-c">
        <a href="{php echo $this->createMobileUrl('wechatmallcart',array('memberid'=>$memberid,'storeid'=>$storeid))}">
            <div class="iconfont">&#xe679;</div>
            <div class="text">购物车</div>
        </a>
    </div>
    <div class="addtocart text-c">加入购物车</div>
    <div class="zjbuy text-c">直接购买</div>
</div>
<input type="hidden" id="optionid" value="0" />
<input type="hidden" id="buttontype" value="0" />
<script type="text/javascript" src="{HLMMS_MOBILE_MESSI}messi/js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="{HLMMS_MOBILE_MESSI}jqueryweui/js/swiper.min.js"></script>
<script type="text/javascript" src="{HLMMS_MOBILE_MESSI}jqueryweui/js/jquery-weui.min.js"></script>
<script type="text/javascript" src="{HLMMS_MOBILE_MESSI}jqueryweui/js/fastclick.js"></script>
<script type="text/javascript" src="{HLMMS_MOBILE_MESSI}jqueryweui/js/jquery.Spinner.js"></script>
<script type="text/javascript">
    $(function(){
        FastClick.attach(document.body);
        $(".next").click(function(){
            if($("#buttontype").val() == 1){
                $.ajax({
                    url:"{php echo $this->createMobileUrl('bindMemberInfo',array('op' => 'WeChatAjaxJoinShopping','storeid'=>$storeid))}",
                    type:'post',
                    data:{
                        id:{$wechatgoods['id']},
                        buynum:$('.Amount').val(),
                        openid:"{php echo $openid}",
                        memberid:"{php echo $memberid}",
                        optionval:$('#optionid').val(),
                    },
                    dataType:'json',
                    success:function(data){
                        if(data.error == 1){
                            $.alert(data.message);
                            $('.blackbg').addClass('hide');
                            $('.options').addClass('hide');
                        }
                        else{

                            $.alert(data.message);
                        }
                    }
                });
            }
            if($("#buttontype").val() == 2){
                $.ajax({
                    url:"{php echo $this->createMobileUrl('bindMemberInfo',array('op' => 'directbuy','storeid'=>$storeid))}",
                    type:'post',
                    data:{
                        id:"{$wechatgoods['id']}",
                        buynum:$('.Amount').val(),
                        openid:"{php echo $openid}",
                        memberid:"{php echo $memberid}",
                        hidden_specification_price:$('#hidden_specification_price').val(),
                        hidden_specificationjsonstock:$('#hidden_specificationjsonstock').val(),
                        optionval:$('#optionid').val(),
                    },
                    dataType:'json',
                    success:function(data){
                        if(data.error == 1){
                            $.alert(data.message);
                        }else{
                            var buyurl = "{php echo $this->createMobileUrl('bindMemberInfo',array('op' => 'directBuyPointsOrder'))}"+"&openid={php echo $openid}&buynum="+$('.Amount').val()+"&goodsid={$wechatgoods['id']}&memberid={php echo $memberid}&optionval="+$('#optionid').val()+"&hidden_specification_price="+$('#hidden_specification_price').val();
                            window.location.href = buyurl;
                        }
                    }
                });
            }
        });

        $(".Spinner").Spinner({value:1, len:5, max:10000});
        $('.close').click(function(){
            $('.blackbg').addClass('hide');
            $('.options').addClass('hide');
        });
        $('.addtocart').click(function(){
            $("#buttontype").val(1);
            $('.blackbg').removeClass('hide');
            $('.options').removeClass('hide');
        });
        $('.zjbuy').click(function(){
            $("#buttontype").val(2);
            $('.blackbg').removeClass('hide');
            $('.options').removeClass('hide');
        });
    });
</script>
<script type="text/javascript">
    $(".swiper-container").swiper({
        loop: true,
        paginationType:'bullets',
        autoplay:5000
    });
    $('.optionitems .item').click(function(){
        $('.optionitems .item').removeClass('now');
        $(this).addClass('now');
        $("#optionid").val($(this).attr('attr-optionid'));
       // alert($('#optionid').val());
        $.ajax({
            url:"{php echo $this->createMobileUrl('bindMemberInfo',array('op' => 'Updatestock','storeid'=>$storeid))}",
            type:'post',
            data:{
                goodsid:{php echo $wechatgoods['goods_id']},
                optionval:$('#optionid').val(),
            },
            dataType:'json',
            success:function(data){
                if (data['message']['code'] == 0) {

                    $("#hidden_specificationjsonstock").val(data['message']['specification_stock']);
                    $("#hidden_specification_price").val(data['message']['specification_price']);
                    $("#showprice").text("￥"+data['message']['specification_price']);
                    $("#showstock").text("库存："+data['message']['specification_stock']);
                    if(data['message']['specification_stock'] <= 0){
                        $(".shouqing").removeClass('hide');
                    }else{
                        $(".shouqing").addClass('hide');
                    }
                }
            },
            error:function () {
                alert('代码错误！');
            }
        });
    });
</script>
<script type="text/javascript">
    wx.ready(function () {
        sharedata = {
            title: '{$shareres["title"]}',
            desc: '{$shareres["des"]}',
            link: '{$shareres["url"]}',
            imgUrl: '{$shareres["thumb"]}',
            trigger: function (res) {
                //alert('用户点击发送给朋友');
            },
            success: function (res) {
                //alert('已分享');
            },
            cancel: function (res) {
                //alert('已取消');
            },
            fail: function (res) {
                alert("分享失败");
            }
        };
        wx.onMenuShareAppMessage(sharedata);
        wx.onMenuShareTimeline(sharedata);
        wx.onMenuShareQQ(sharedata);
        wx.onMenuShareWeibo(sharedata);
    });
</script>
</body>
</html>