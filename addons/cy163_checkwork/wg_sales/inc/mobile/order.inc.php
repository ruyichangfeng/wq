<?php
/*   __________________________________________________
    |  Obfuscated by YAK Pro - Php Obfuscator          |
    |              on 2018-08-04 11:37:35              |
    |    GitHub: https://github.com/pk-fr/yakpro-po    |
    |__________________________________________________|
*/
 class Wg_sales_Mobile_Order extends SalesBaseController { public $data = array(); public $size = 10; public function init() { parent::init(); $this->site->loadmodule("\157\162\144\x65\x72\x4d\157\144\165\x6c\x65"); } public function ajaxGetOrder() { goto EqYTn; hVRKB: if ($_SESSION["\167\x67"]["\165\163\145\x72"][$this->site->site_id]["\151\144"]) { goto eD48L; } goto RbXUY; OrR1J: $this->site->ajaxReturn(400, "\xe6\x94\xaf\344\xbb\230\xe5\x8f\202\346\x95\260\xe9\224\231\350\257\257"); goto a_YIH; UZ3aO: $this->site->ajaxReturn($params["\143\x6f\x64\x65"], '', $params["\144\141\164\141"]); goto dhWHJ; wRNII: $order = ["\165\x6e\x69\x61\143\x69\x64" => $this->site->site_id, "\x75\x69\144" => $_SESSION["\x77\147"]["\165\x73\145\x72"][$this->site->site_id]["\151\144"], "\x63\141\164\145\147\x6f\162\x79\137\151\x64" => intval($_POST["\x63\141\164\x65\147\x6f\x72\171\x5f\x69\144"]), "\x61\162\x74\x69\143\154\x65\137\151\144" => intval($_POST["\141\162\x74\151\x63\x6c\145\137\x69\x64"]), "\x6f\162\144\145\162\x5f\x6e\x6f" => $this->getOrderId(), "\x73\164\x61\x74\165\x73" => 1, "\x6d\x6f\156\145\171" => $money_fen, "\160\x61\171\137\155\x6f\156\145\x79" => $money_fen, "\x63\x72\145\141\x74\145\137\x74\x69\155\x65" => time()]; goto gCRo7; uhJJO: $params = $this->getPayParams($order, $_SESSION["\167\147"]["\165\x73\x65\x72"][$this->site->site_id]["\x6f\x70\145\x6e\151\x64"]); goto UZ3aO; x9HF3: if ($this->checkPayConfig()) { goto X6dpz; } goto OrR1J; xWJA0: if (!($money_fen < 1)) { goto R0Amf; } goto dAjw4; EqYTn: $ad_article = $money = floatval($_POST["\155\x6f\156\145\x79"]); goto jNVUt; fd64_: R0Amf: goto x9HF3; pBYIn: if ($order_id) { goto U_SD4; } goto QTR3f; dhWHJ: G7hV0: goto csMtw; vpPHA: goto G7hV0; goto XRtI9; RbXUY: $this->site->ajaxReturn(409, "\346\202\250\346\xb2\xa1\346\234\211\347\x99\273\345\275\x95"); goto r1Eff; jNVUt: $money = number_format($money, 2); goto DUgBJ; r1Eff: eD48L: goto wRNII; dAjw4: $this->site->ajaxReturn(410, "\xe9\207\221\351\242\235\351\224\231\xe8\xaf\xaf\x2c{$money_fen}"); goto fd64_; XRtI9: U_SD4: goto uhJJO; DUgBJ: $money_fen = $money * 100; goto xWJA0; gCRo7: $order_id = $this->site->orderModule->add($order); goto pBYIn; QTR3f: $this->site->ajaxReturn(401, "\xe7\224\237\xe6\210\220\xe8\xae\242\345\215\225\151\x64\xe5\xa4\xb1\350\xb4\xa5"); goto vpPHA; a_YIH: X6dpz: goto hVRKB; csMtw: } private function getOrderId() { $randNo = sprintf("\x25\60\64\144", rand(1, 1000)); return date("\131\155\x64\110\151\x73") . $randNo; } private function getPayParams($order_info, $openid) { goto CnHvM; xy2I8: AYLzE: goto DTd1d; KvvMv: $_W["\155\x6f\144\x75\154\145\x5f\x73\x65\164\164\151\156\x67"]["\160\141\171"]["\x6d\x63\x68\x69\x64"] = $_W["\x61\143\143\157\x75\x6e\x74"]["\163\x65\x74\164\x69\156\x67"]["\x70\x61\171\155\x65\x6e\x74"]["\x77\145\143\x68\141\x74"]["\155\x63\x68\151\144"]; goto T8cBg; n61iR: $input->SetTime_expire(date("\131\x6d\x64\x48\151\163", time() + 600)); goto iynS4; tdR6Z: $input->SetOut_trade_no($order_info["\x6f\162\x64\145\162\137\156\157"]); goto Hd1yj; dH7o1: if ($order["\143\x6f\x64\x65"] == 0) { goto Sj4wP; } goto f9bkb; REbEc: $_W["\155\x6f\x64\x75\154\145\137\x73\145\x74\164\151\156\147"]["\160\141\171"]["\141\x70\x70\x69\x64"] = $_W["\x61\143\143\157\x75\156\x74"]["\153\145\171"]; goto KvvMv; bxIiZ: require_once dirname(__FILE__) . "\57\x2e\56\57\x2e\56\x2f\154\151\x62\x2f\167\x78\160\x61\171\x2f\154\151\142\x2f\127\170\x50\141\x79\56\x4e\157\164\151\146\x79\x2e\160\x68\160"; goto Gcqf7; aCo2F: $input->SetTime_start(date("\x59\x6d\144\x48\x69\163")); goto n61iR; f1Zoe: $notifyUrl = $_W["\x73\151\164\145\162\x6f\x6f\x74"] . "\57\x61\x64\144\157\156\163\57\167\147\x5f\x73\x61\154\145\x73\x2f\x6e\157\164\x69\146\x79\x2e\x70\150\160"; goto GLT4_; bfZdF: require_once dirname(__FILE__) . "\57\56\x2e\57\56\x2e\x2f\154\x69\142\57\x77\x78\x70\x61\171\57\x65\170\x61\x6d\x70\x6c\x65\x2f\127\x78\120\x61\171\56\x4a\x73\x41\160\151\x50\x61\171\x2e\160\150\160"; goto YbKo0; G7A7w: $input = new WxPayUnifiedOrder(); goto FNbGZ; Hd1yj: $input->SetTotal_fee($order_info["\x70\x61\171\x5f\x6d\157\156\145\x79"]); goto aCo2F; iynS4: $input->SetNotify_url($notifyUrl); goto jZWFD; z0j25: require_once dirname(__FILE__) . "\x2f\56\56\57\56\x2e\57\154\x69\x62\x2f\167\170\x70\141\x79\x2f\x6c\151\142\x2f\x57\170\120\141\171\x2e\x41\x70\x69\x2e\x70\x68\x70"; goto bfZdF; jqicr: $order = WxPayApi::unifiedOrder($input); goto dH7o1; P81HQ: goto AYLzE; goto Jqbb3; CnHvM: global $_W, $_GPC; goto QeUe8; FNbGZ: $input->SetBody($title); goto k8j9N; nW3mS: return ["\x63\x6f\x64\x65" => 0, "\x64\x61\x74\141" => $tools->GetJsApiParameters($order["\x64\x61\x74\141"])]; goto xy2I8; tsKLF: $input->SetOpenid($openid); goto REbEc; k8j9N: $input->SetAttach("\167\147\137\x73\141\154\145\x73\174{$_W["\165\156\x69\141\143\x69\x64"]}"); goto tdR6Z; QeUe8: require_once dirname(__FILE__) . "\57\x2e\x2e\57\x2e\x2e\57\154\x69\142\x2f\x77\x78\x70\141\x79\57\x6c\151\x62\x2f\127\170\x50\x61\x79\56\101\160\x69\56\160\150\160"; goto bxIiZ; T8cBg: $_W["\x6d\157\x64\165\154\145\x5f\163\145\x74\x74\x69\x6e\147"]["\160\x61\x79"]["\153\x65\x79"] = $_W["\141\x63\143\x6f\x75\x6e\x74"]["\x73\145\164\164\151\x6e\x67"]["\160\141\171\x6d\x65\x6e\x74"]["\x77\145\143\150\141\x74"]["\x73\x69\x67\x6e\153\x65\x79"]; goto jqicr; GLT4_: $tools = new JsApiPay(); goto z0j25; Jqbb3: Sj4wP: goto nW3mS; jZWFD: $input->SetTrade_type("\x4a\123\101\x50\111"); goto tsKLF; f9bkb: return ["\x63\157\144\x65" => $order["\x63\x6f\144\145"], "\x64\x61\164\141" => []]; goto P81HQ; YbKo0: $title = "\345\276\xae\344\277\xa1\346\224\xaf\344\273\x98"; goto G7A7w; Gcqf7: require_once dirname(__FILE__) . "\x2f\x2e\x2e\x2f\x2e\56\57\154\151\x62\57\x77\x78\x70\141\171\57\145\x78\141\155\160\154\145\x2f\x57\170\120\141\171\56\112\163\101\160\x69\x50\x61\x79\x2e\x70\150\x70"; goto f1Zoe; DTd1d: } private function checkPayConfig() { goto HA527; jS1Nc: if (!(!$_W["\x61\143\143\x6f\x75\156\164"]["\x6b\145\x79"] || !$_W["\141\143\x63\157\165\x6e\x74"]["\x73\x65\x74\164\151\156\x67"]["\x70\141\171\155\x65\x6e\164"]["\167\x65\143\150\141\164"]["\155\143\150\151\144"] || !$_W["\x61\143\x63\x6f\165\156\x74"]["\163\145\x74\x74\x69\156\x67"]["\x70\141\x79\x6d\145\x6e\164"]["\167\x65\x63\150\141\x74"]["\x73\151\x67\156\x6b\145\171"])) { goto Nfock; } goto eLlDV; JoCq9: Nfock: goto QkU1F; QkU1F: return true; goto y1P5m; HA527: global $_W; goto jS1Nc; eLlDV: return false; goto JoCq9; y1P5m: } }