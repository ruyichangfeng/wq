<?php
 class MobileBaseController extends BaseController { public $uid; public $userInfo; public $data; public $fenxiao_open; public $admin = false; public static $ORDER_STATUS = array(0 => array("\x76\x61\154\165\x65" => "\xe5\276\205\xe6\x94\xaf\xe4\xbb\x98", "\143\x6c\x61\163\163" => "\x67\x72\x65\145\x6e", "\151\144" => 0), 1 => array("\166\x61\x6c\x75\145" => "\346\234\252\xe5\217\221\xe8\xb4\247", "\x63\x6c\141\x73\163" => "\162\145\x64", "\151\144" => 1), 2 => array("\166\141\154\165\x65" => "\xe5\267\262\345\217\221\xe8\264\247", "\143\x6c\x61\163\163" => "\171\x65\154\x6c\157\x77", "\x69\144" => 2), 3 => array("\166\x61\x6c\165\145" => "\345\267\xb2\345\256\214\346\x88\220", "\143\x6c\141\x73\x73" => "\x67\162\141\x79", "\x69\144" => 3), -1 => array("\166\141\154\x75\145" => "\xe5\267\xb2\345\205\xb3\xe9\227\255", "\143\154\141\x73\163" => "\143\154\x6f\x73\x65", "\151\144" => -1)); public function __construct() { parent::__construct(); } public function init() { goto ve1T5; J6x7P: $this->W["\167\145\x69\x64"] = 4; goto L4I3J; ovQMz: $this->userInfo["\x7a\150\x65\153\x6f\165"] = self::$LEVEL_DEFAULT["\172\150\145\x6b\157\165"]; goto EBo7L; SjIG_: $this->assign("\x61\x64\x6d\x69\156", true); goto db0R2; LGTQS: $this->admin = true; goto SjIG_; d9oAD: $this->userInfo = $this->MemberModel->getOne(["\x69\x64" => $_SESSION["\x77\147\137\x66\145\156\170\x69\141\x6f"]["\x69\x64"]]); goto N1RYL; AqhwC: $this->assign("\165\x73\x65\162\137\151\x6e\x66\157", $this->userInfo); goto iZXpW; TeaCM: $admins = explode("\54", $admin); goto so1Xz; iZXpW: $this->uid = $_SESSION["\167\x67\x5f\146\x65\x6e\170\151\141\157"]["\151\144"]; goto HWbNS; db0R2: HIJRg: goto kujwD; w8iMT: $this->fenxiao_open = $this->site->configs["\143\x6f\156\146\x69\147"]["\154\145\x76\x65\x6c"]; goto nuoXw; bykgJ: $this->assign("\x66\x65\156\170\x69\x61\157\137\x6f\160\x65\x6e", $this->fenxiao_open); goto NuThw; xfbH_: $this->userInfo["\x6c\x65\166\x65\x6c\156\x61\x6d\x65"] = $levels[$this->userInfo["\x61\147\145\x6e\164\154\145\166\145\154"]]["\154\145\x76\145\x6c\156\141\x6d\x65"]; goto GiC1Q; kujwD: V8bBf: goto yPxoX; v0hM3: $this->userInfo["\x6c\x65\x76\145\x6c\x6e\141\155\x65"] = self::$LEVEL_DEFAULT["\154\x65\166\145\x6c\x6e\141\155\x65"]; goto ovQMz; SB_Uj: if (!($admin && $this->uid)) { goto V8bBf; } goto TeaCM; S2Z3e: ArilE: goto GVTGV; NuThw: $this->assign("\147\157\x75\x5f\151\156\x66\157", ["\147\x6f\x75" => $this->module["\143\x6f\x6e\x66\151\x67"]["\x67\x6f\x75"], "\x67\157\x75\137\164\x68\x75\155\142" => $this->module["\143\x6f\x6e\x66\151\147"]["\x67\157\165\x5f\164\150\x75\155\x62"], "\147\157\x75\x5f\156\141\155\145" => $this->module["\143\x6f\x6e\146\x69\147"]["\x67\157\165\x5f\156\x61\x6d\145"], "\147\157\165\x5f\165\162\154" => $this->module["\143\x6f\x6e\146\151\147"]["\147\157\x75\x5f\165\162\154"]]); goto CH7dl; hbr03: $_SESSION["\167\147\137\146\x65\156\170\151\x61\x6f"] = $this->MemberModel->getOne(["\x69\144" => 14]); goto J6x7P; CH7dl: $this->assign("\x67\x6f\165\x5f\143\154\x6f\x73\145", $gou == 1); goto AqhwC; GVTGV: $gou = $this->module["\x63\157\x6e\146\x69\147"]["\x67\x6f\165"]; goto bykgJ; L4I3J: kLyiw: goto kl7YS; kl7YS: $this->site->getAuth(WG_APP_MODULE); goto d9oAD; ySCZ5: $this->getUserInfo($agent); goto cyszA; nuoXw: if (isset($levels[$this->userInfo["\x61\x67\145\156\x74\154\x65\166\x65\x6c"]]) && $this->userInfo["\x69\x73\141\147\x65\x6e\164"] && $this->fenxiao_open) { goto SQqP8; } goto v0hM3; LOE9o: SQqP8: goto xfbH_; GiC1Q: $this->userInfo["\x7a\x68\x65\x6b\157\165"] = $levels[$this->userInfo["\141\x67\x65\156\164\x6c\x65\166\145\x6c"]]["\172\x68\x65\153\x6f\x75"]; goto S2Z3e; HWbNS: $admin = $this->module["\x63\x6f\156\x66\151\x67"]["\141\144\155\x69\x6e"]; goto SB_Uj; EBo7L: goto ArilE; goto LOE9o; cyszA: if (!($_SERVER["\x53\105\122\126\x45\x52\x5f\101\x44\104\x52"] == "\x31\62\67\56\x30\x2e\x30\56\61" && $_SERVER["\122\x45\x4d\x4f\x54\x45\137\101\x44\x44\x52"] == "\61\62\x37\x2e\x30\56\60\56\x31")) { goto kLyiw; } goto hbr03; ve1T5: $agent = $this->site->configs["\x63\157\156\146\151\x67"]["\x64\x61\151\154\x69\x74\151\141\x6f\x6a\151\x61\156"]; goto ySCZ5; so1Xz: if (!in_array($this->uid, $admins)) { goto HIJRg; } goto LGTQS; N1RYL: $levels = $this->getAllLevel('', $this->W["\165\x6e\151\141\x63\x69\x64"]); goto w8iMT; yPxoX: } public function getShoppingCartCount() { $sql = "\x73\145\x6c\145\x63\164\40\163\165\x6d\50\141\x6d\x6f\x75\x6e\x74\x29\x20\141\163\40\140\x73\x75\x6d\140\40\146\162\157\x6d\x20" . tablename($this->ShoppingCartModel->getTable()) . "\40\x77\150\x65\x72\145\40\x75\x69\x64\75" . $this->uid; return $this->ShoppingCartModel->pdo_fetch($sql)["\x73\x75\155"]; } public function getShoppingCartInfo() { return $this->ShoppingCartModel->getList(["\165\151\x64" => $this->uid], "\x2a"); } public function updateShoppingCart($data, $inc = true) { goto PzInI; pIDJY: $sql = "\111\116\123\x45\x52\124\x20\111\x4e\x54\x4f\x20" . tablename($this->ShoppingCartModel->getTable()) . "\40\x28\x75\151\144\54\x67\x6f\x6f\144\163\137\x69\x64\x2c\140\x74\171\x70\145\140\x2c\x61\155\x6f\x75\x6e\164\x29\x20\12\40\40\40\x20\x20\x20\40\40\x56\101\114\x55\105\x53\40\50" . $this->uid . "\x2c\x27" . $data["\147\x6f\157\x64\163\x5f\x69\144"] . "\x27\54\x27" . $data["\164\x79\x70\x65"] . "\47\x2c\x27" . $data["\141\x6d\157\x75\156\x74"] . "\x27\x29\x20\12\x20\40\x20\40\40\40\40\x20\x4f\x4e\x20\104\125\120\114\111\103\x41\x54\x45\x20\x4b\105\131\x20\x55\120\x44\101\x54\105\x20\141\155\157\x75\x6e\x74\75\x61\155\x6f\165\x6e\x74\53" . (int) $data["\x61\155\157\165\x6e\x74"]; goto Ucwth; PzInI: if ($inc) { goto XpC4Z; } goto s_pLE; pdPbh: XpC4Z: goto pIDJY; s_pLE: $sql = "\x49\x4e\123\x45\x52\x54\x20\x49\x4e\x54\x4f\40" . tablename($this->ShoppingCartModel->getTable()) . "\40\50\x75\151\x64\54\147\157\x6f\x64\163\137\151\144\54\x60\164\x79\160\145\140\x2c\x61\155\x6f\x75\156\164\x29\40\12\40\x20\x20\40\40\x20\x20\x20\x56\x41\x4c\x55\x45\123\40\50" . $this->uid . "\54\x27" . $data["\147\157\x6f\144\163\x5f\x69\144"] . "\x27\x2c\47" . $data["\164\171\160\x65"] . "\x27\54\x27" . $data["\x61\155\x6f\165\156\164"] . "\x27\51\40\xa\x20\x20\40\x20\40\x20\x20\40\117\x4e\40\104\125\120\x4c\111\103\x41\124\x45\x20\113\105\x59\40\125\x50\104\x41\124\x45\x20\141\155\x6f\165\x6e\164\75" . (int) $data["\x61\x6d\157\x75\156\164"]; goto s_rFo; s_rFo: goto M45hA; goto pdPbh; Ucwth: M45hA: goto m54a3; m54a3: return $this->ShoppingCartModel->query($sql); goto M7fw1; M7fw1: } public function getUserInfo($agent) { goto Z0HAj; LvcoD: if ($parent) { goto NxiLe; } goto yAq6D; ZJVKe: $parent = $this->MemberModel->getOne(["\151\x64" => $from]); goto LvcoD; tL3Mc: $member = array_merge($member, $data); goto k0agQ; pxdvy: $id = $this->MemberModel->add($data); goto NPX1y; szIGU: $parent = []; goto wSwQV; dGjEQ: pdoRC: goto pxdvy; qfYdx: Nb_uJ: goto zHE0e; yAq6D: $from = 0; goto uOudh; JMEcs: $member = $this->MemberModel->getOne(["\x6f\160\145\x6e\x69\x64" => $this->W["\157\160\145\156\x69\x64"], "\167\x65\151\x64" => $this->W["\165\x6e\x69\141\x63\151\x64"]]); goto gd0V9; sP3x_: goto sgWUb; goto oskTP; wSwQV: $from = intval($_GET["\x66\162\x6f\155\146\x75\x69\x64"]); goto MbP54; TKniq: goto Nb_uJ; goto kFpfH; jrLdH: $data = ["\x6e\x69\x63\x6b\156\141\x6d\x65" => $userinfo["\x6e\x69\x63\153\x6e\x61\x6d\145"], "\x61\166\141\x74\x61\162" => $userinfo["\x68\x65\141\x64\x69\x6d\x67\x75\162\x6c"], "\146\157\x6c\x6c\x6f\x77" => $userinfo["\163\x75\x62\x73\x63\162\x69\142\x65"]]; goto tL3Mc; uOudh: NxiLe: goto z8Woz; Z22TW: if (!$userinfo) { goto jvuio; } goto jg_cd; EC6KA: aWPCZ: goto tQAun; A8sM2: i9L4i: goto MUIgz; WTjp3: $this->sendXinZengGuanZhuTongZhi($parent, $this->site->configs["\x63\x6f\156\146\151\x67"]["\170\x69\x6e\172\x65\x6e\x67\x67\165\141\156\x7a\x68\165"], $data["\x6e\x69\x63\153\x6e\141\x6d\145"]); goto qfYdx; WMnaU: $data = ["\x6f\x70\145\156\x69\144" => $userinfo["\x6f\x70\x65\x6e\151\144"], "\167\145\151\144" => $this->W["\x75\156\151\x61\x63\151\x64"], "\x6e\x69\x63\x6b\x6e\x61\x6d\x65" => $userinfo["\x6e\151\x63\153\156\x61\155\x65"], "\141\166\141\x74\x61\x72" => $userinfo["\x68\145\141\144\x69\155\147\165\162\x6c"], "\x66\x6f\154\154\x6f\x77" => $userinfo["\x73\165\142\163\143\x72\151\x62\145"], "\x70\x61\x72\145\x6e\164\137\x69\x64" => $from]; goto FB7Rs; tQAun: return $_SESSION["\167\147\137\x66\145\156\170\151\141\x6f"]; goto m0_bk; AjVtM: Zr7xW: goto ZJVKe; gd0V9: $userinfo = mc_oauth_userinfo(); goto U8yen; Z0HAj: if (empty($_SESSION["\x77\x67\x5f\146\145\156\170\x69\141\157"])) { goto XLBPt; } goto EghZi; xLqpZ: exit; goto TKniq; azGlL: goto aWPCZ; goto bGoIk; FB7Rs: if (!($agent == 4)) { goto pdoRC; } goto e7rYc; jRDgU: $_SESSION["\167\x67\x5f\146\145\x6e\170\x69\x61\157"] = $member; goto EC6KA; tTg1r: goto Nb_uJ; goto A8sM2; oskTP: jvuio: goto bxiKb; EghZi: return $_SESSION["\167\147\137\146\145\x6e\170\x69\141\157"]; goto eL253; bGoIk: tGbet: goto jrLdH; fOYk4: if ($from) { goto Qb2n2; } goto tTg1r; jg_cd: goto sgWUb; goto sqjAl; z8Woz: uvOkr: goto WMnaU; zHE0e: $_SESSION["\167\x67\x5f\x66\x65\x6e\170\151\x61\x6f"] = $this->MemberModel->getOne(["\x69\x64" => $id]); goto sP3x_; UerBI: $from = 0; goto KZu2x; NPX1y: if (!$id) { goto i9L4i; } goto fOYk4; eL253: XLBPt: goto JMEcs; MbP54: if ($from) { goto Zr7xW; } goto UerBI; bxiKb: sgWUb: goto azGlL; k0agQ: $this->MemberModel->update(["\151\x64" => $member["\151\144"]], $data); goto jRDgU; U8yen: if (!empty($member) && $userinfo) { goto tGbet; } goto OpHfy; kFpfH: Qb2n2: goto WTjp3; sqjAl: QecAU: goto szIGU; KZu2x: goto uvOkr; goto AjVtM; MUIgz: echo "\xe7\x99\273\345\xbd\225\345\244\261\350\xb4\245\x2c\350\257\267\xe8\201\x94\xe7\xb3\273\xe5\xbc\x80\345\x8f\x91\xe8\200\205\x51\x51\x3a\70\63\x38\x35\71\x36\70\x38"; goto xLqpZ; OpHfy: if ($userinfo && empty($member)) { goto QecAU; } goto Z22TW; e7rYc: $data["\151\x73\141\147\145\156\164"] = 1; goto dGjEQ; m0_bk: } public function getMemberInfo($uid) { return $this->MemberModel->getOne(["\151\144" => $uid], ["\x69\x64", "\x77\x65\151\144", "\x69\163\x61\147\x65\156\x74", "\x6f\160\x65\x6e\x69\x64", "\x6e\151\143\153\156\141\155\x65", "\152\x69\146\145\156", "\x61\x67\x65\156\x74\154\x65\166\145\x6c", "\160\141\x72\x65\x6e\x74\137\151\x64"]); } public function getParents($parent_id) { goto tw86M; kR_Yf: if (empty($parent1)) { goto QmwMS; } goto B9GrF; Ff29i: $parent3 = $this->getMemberInfo($parent2["\x70\141\162\145\x6e\x74\x5f\151\144"]); goto G9tj8; PyiK5: QmwMS: goto hDeki; yBdNc: if (empty($parent2)) { goto RhS_o; } goto m_VRd; eATNf: $arr[3] = $parent3; goto mE5r5; G9tj8: if (empty($parent3)) { goto KGdpK; } goto eATNf; EjiUe: RhS_o: goto PyiK5; dOsOi: $parent1 = $this->getMemberInfo($parent_id); goto kR_Yf; hDeki: return $arr; goto NUlTZ; m_VRd: $arr[2] = $parent2; goto Ff29i; tw86M: $arr = array(); goto dOsOi; NPFO9: $parent2 = $this->getMemberInfo($parent1["\x70\x61\162\x65\x6e\x74\137\x69\x64"]); goto yBdNc; B9GrF: $arr[1] = $parent1; goto NPFO9; mE5r5: KGdpK: goto EjiUe; NUlTZ: } private function _addUserCommission($uid, $money, $order, $i) { goto CPFqH; TXGQY: $this->crontab_log("\xe4\xbd\xa3\xe9\207\221\x6c\x6f\147\346\xb7\xbb\xe5\212\xa0" . var_export($data), "\x65\162\x72\x6f\x72"); goto fzPs4; o8N2U: if ($add) { goto fQ0Yj; } goto TXGQY; NaYMT: $add = $this->CommissionModel->add($data); goto o8N2U; CPFqH: $data = ["\x63\x6f\155\155\x69\163\x73\151\x6f\x6e\40\53\75" => $money]; goto AQEmu; pYUYN: $data = ["\x77\145\x69\144" => $order["\167\x65\151\x64"], "\x75\x69\144" => $uid, "\x6f\162\x64\145\162\163\x6e" => $order["\157\162\x64\145\162\163\x6e"], "\160" => $i, "\155\157\x6e\145\171" => $money, "\143\162\145\x61\x74\145\164\x69\155\x65" => time()]; goto NaYMT; AQEmu: $success = $this->MemberModel->update(["\151\x64" => $uid], $data); goto O9Kfr; WrHyM: return $success; goto sxZzc; O9Kfr: if (!$success) { goto hIjAY; } goto pYUYN; jLk0F: hIjAY: goto WrHyM; fzPs4: fQ0Yj: goto jLk0F; sxZzc: } public function _sendPack() { } public function sendOrderRedPack($order, $config) { goto Ogmqr; a8H_8: E8tsg: goto b1FsV; uU143: $flag = true; goto OedLT; KYPgN: OpUl9: goto eNIyq; eNIyq: if (!($i <= 3)) { goto l2UDW; } goto CjaMW; xooXY: $commision = "\143\157\x6d\155\151\x73\x69\x6f\x6e" . $i; goto VUZvh; OedLT: $i = 1; goto KYPgN; TJ7MY: $i++; goto Ry1D4; s_zFx: $success = $this->_addUserCommission($order[$parent], $total_money, $order, $i); goto aWDn1; CRvzt: rPtyv: goto a8H_8; bWT6D: $total_money = $order[$commision]; goto s_zFx; XRS4N: $flag = false; goto CRvzt; aWDn1: if ($success) { goto rPtyv; } goto XRS4N; b1FsV: Hv_TT: goto TJ7MY; Ogmqr: $un_red_pack = $this->_getNoHongbao($config); goto uU143; Ry1D4: goto OpUl9; goto sJ0Ae; VUZvh: if (!($order[$parent] > 0 && $order[$commision] > 0)) { goto E8tsg; } goto bWT6D; OePgI: return $flag; goto ShD9R; sJ0Ae: l2UDW: goto OePgI; CjaMW: $parent = "\x70\x61\x72\145\156\164" . $i; goto xooXY; ShD9R: } protected function doResultRedPack($db_data, $order, $p, $red_pack_id, $again = false) { goto gF8nv; ON89V: return false; goto azZwO; gF8nv: $db_data_msg = unserialize($db_data["\x72\145\164\165\162\156\137\155\x73\147"]); goto PTCEm; rrfoo: return false; goto RdWqR; PTCEm: if ($db_data["\x65\x72\x72\x5f\143\x6f\x64\x65"] == "\123\x55\x43\x43\105\123\x53") { goto vAJRS; } goto GJ7k5; PnPBN: $key = "\x68\x6f\156\x67\x62\141\x6f" . $p; goto l4GYH; ff4v_: return true; goto zWII3; Uv3Or: vAJRS: goto PnPBN; l4GYH: $order_update = $this->OrderModel->update(["\x69\x64" => $order["\151\144"]], [$key . "\x20\53\75" => $db_data_msg["\x74\157\x74\x61\154\x5f\x61\155\x6f\x75\x6e\x74"]]); goto tBL0v; GJ7k5: $this->RedPackModel->update(["\151\144" => $red_pack_id], ["\163\164\x61\x74\165\163" => 2, "\163\145\x6e\144\x5f\x6c\151\x73\x74\151\x64" => $db_data["\163\145\x6e\x64\x5f\154\x69\x73\x74\x69\144"], "\145\162\162\x5f\x63\x6f\x64\x65" => $db_data["\x65\x72\162\137\x63\157\x64\145"], "\x65\162\x72\x5f\143\157\x64\x65\137\x64\145\163" => $db_data["\145\x72\x72\x5f\x63\157\144\x65\x5f\144\145\163"], "\142\151\x6c\154\156\x6f" => $db_data_msg["\155\x63\150\x5f\142\x69\154\154\x6e\157"]]); goto CqfsJ; aVlP9: $this->crontab_log("\x64\157\x52\145\163\165\154\164\122\145\x64\x50\141\143\x6b\x20\165\x70\144\x61\164\x65\x20\162\x65\x64\x20\160\x61\x63\153\x20\146\x61\x69\154\x20" . var_export($order, true) . var_export($db_data, true), "\x65\162\x72\x6f\x72"); goto rrfoo; tBL0v: if ($order_update) { goto X9rmv; } goto lN8oi; lN8oi: $this->crontab_log("\x64\x6f\122\145\x73\x75\x6c\164\x52\x65\x64\120\141\143\x6b\40\x75\160\x64\141\164\x65\40\x6f\162\144\x65\x72\x20\x66\141\151\154\40" . var_export($order, true) . var_export($db_data, true), "\145\x72\x72\157\162"); goto n5Vby; n5Vby: X9rmv: goto KNERB; zWII3: BQqUU: goto ON89V; CqfsJ: goto BQqUU; goto Uv3Or; RdWqR: czMvY: goto ff4v_; uBN6a: if ($red_pack_update) { goto czMvY; } goto aVlP9; KNERB: $red_pack_update = $this->RedPackModel->update(["\151\144" => $red_pack_id], ["\x73\164\x61\164\165\163" => 1, "\x73\145\156\144\x5f\x6c\151\163\164\151\144" => $db_data_msg["\x73\x65\x6e\x64\137\x6c\151\163\x74\x69\x64"]]); goto uBN6a; azZwO: } protected function _getNoHongbao($config) { goto opwhy; opwhy: $config = $config["\x6e\x6f\150\x6f\x6e\x67\142\x61\157"]; goto N657C; bGgHV: $config = explode("\54", $config); goto AGCoO; AGCoO: return $config; goto ffjdC; N657C: $config = str_replace("\xef\xbc\x8c", "\x2c", $config); goto bGgHV; ffjdC: } public function formatTime($time) { goto huX0Q; YL63I: if ($t < 60) { goto yB0l6; } goto h7CHQ; bxSFm: $text = floor($t / 60) . "\xe5\210\206\351\222\x9f\xe5\x89\215"; goto o1AkO; otX6C: yB0l6: goto ZM2sW; Vrj1h: mRLGX: goto Oq0nj; tI62p: goto Be_Il; goto dds45; yepxq: $text = date("\x48\x3a\151", $time); goto lvKUk; h7CHQ: if ($t < 60 * 60) { goto VIkul; } goto rcYdp; dds45: OBpFJ: goto WaJ2m; R0khj: goto Be_Il; goto KnzYi; Np0JC: return $text; goto IFrKD; o1AkO: goto Be_Il; goto QGbQI; KnzYi: VIkul: goto bxSFm; dV4li: return "\xe6\x9c\xaa\xe7\237\245"; goto Vrj1h; QGbQI: hD8A5: goto yepxq; lvKUk: Be_Il: goto Np0JC; keNG9: if ($t == 0) { goto OBpFJ; } goto YL63I; ZM2sW: $text = "\61\345\x88\206\xe9\x92\x9f\xe5\211\x8d"; goto R0khj; QsOPg: $text = date("\155\55\x64", $time); goto tI62p; huX0Q: if ($time) { goto mRLGX; } goto dV4li; rcYdp: if ($t < 60 * 60 * 24) { goto hD8A5; } goto QsOPg; WaJ2m: $text = "\xe5\210\x9a\xe5\210\x9a"; goto iUieH; Oq0nj: $t = time() - $time; goto keNG9; iUieH: goto Be_Il; goto otX6C; IFrKD: } }