!function(a){"function"==typeof define&&define.amd?define(["Zepto"],a):a(Zepto)}(function(a){"use strict";function e(b,d){this.$wrap=b,this.opts=a.extend(!0,{},c,d||{}),this.$content=a(this.opts.contentEl),this.startY=0,this.refreshHeight=0,this.isPullToRefresh=!1,this.isLoading=!1,this.finished=!1,this.wrapHeight=this.$content.height(),this.oldScrollTop=0,this.loadingFinishTime=(new Date).getTime(),this.scrollTop=this.$content.scrollTop(),this.init()}var b={elementStyle:document.createElement("div").style,vendor:function(){for(var c,a=["t","webkitT","MozT","msT","OT"],d=0,e=a.length;e>d;d++)if(c=a[d]+"ransform",c in b.elementStyle)return a[d].substr(0,a[d].length-1);return!1},prefixStyle:function(a){return b.vendor()===!1?!1:""===b.vendor()?a:b.vendor()+a.charAt(0).toUpperCase()+a.substr(1)},hasPerspective:function(){var a=b.prefixStyle("perspective")in b.elementStyle;return a&&"webkitPerspective"in b.elementStyle&&b.injectStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),!!a},translateZ:function(){return b.hasPerspective?" translateZ(0)":""}},c={contentEl:"#J_content",isRefresh:!0,isLoadingMore:!0,movePosition:null,distanceToRefresh:100,minDistanceToRefresh:100,maxDistanceToRefresh:200,interval:5,refreshCallback:function(){},loadingMoreCallback:function(){}},d=a(window).height();return e.prototype.init=function(){this.loadingRender(),this.bind(),this.reBindScroll()},e.prototype.loadingRender=function(){var c=["<style>",".preloader-refresh {position: absolute;top: -50px;left: 0;right: 0;width: 100%;text-align: center;padding: 5px 0;}",".preloader-refresh .icon-refresh {display: inline-block;width: 40px;height: 40px; background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAACgCAMAAACsXRuGAAAAt1BMVEX////FxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcXFxcU7SVrkAAAAPHRSTlMAAPONxyCMRvCjM2n59gzeD/xssVo52Akwh6sDpeTbckJLZroqfhUnRernVxifG9XDgb2ZzzxjeLThEmBcLCjmAAACDklEQVR4Xu2Y124yQQyFM9sh9BJafgik956/7fs/V4RCwiITbMdjCSGfKy4On7THnuLZ8yGTyRWUr1W54NgNIC4Dbm+VrQ+tbQxoQAMa0IAGnO4vtR44WBquCcBuJadrSslwQucNaBm2qbyHEQ3YqNN4l3fUKpdpMV7Q26ZF4T3S+5AU49OIA8RjvLpxDCAeY/PIcYB4jKf8tTzcxDt2fGBt/D3v19kPgK5fRQLkAt0MCZANdIdIgGxg7WBjgHygO1kTY/NVMla8QeBvJwHCGP84CRDG+PefBAhjrHTlo9n/InDiY9a7XfLazgewd//Jqze8AN15sAiw7Gu87XwAW/7m5ec5b+j8AXsveT6uSYAwxmrf7xNBZ+aYQJPJZDLh+20aRlkWhen8twdgnCyO0SCJfQDjUv6lUuwBmOQFJXJgGhSBQSoGhvmKQnFNo1VgBD3MmmarwAx6WDWFQOhh1RR+MvSwagqLwqw7/ndW3UkfCD2bhJcAephAvJGYn4y3OrMouIfZNriH19i4h7v0cI9ww4ce4ZEEPTt6/uJ+UdS4H28G1C9qV9yPLyjUL1vyuB/dlLh+dNtE/dpA+SdrF0XeNsqNLV96+puDfPvaaukfUvJjVP+gl19F9C9L8uuc/oVTfiXWv7TLxwr9wUc+msmHR/3xVj6A6z8RSBej/jMLp+76T1X6j2m7eP6aTO9STHV4CXebKAAAAABJRU5ErkJggg==) no-repeat 0 0;background-size: 40px 80px;-webkit-transition-property:-webkit-transform;-webkit-transition-duration:250ms;-webkit-transform:rotate(0deg) translateZ(0);}",".preloader-refresh-flip .icon-refresh {-webkit-transform:rotate(-180deg) translateZ(0);}",".preloader-refresh-loading .icon-refresh {background-position:0 100%;-webkit-transform:rotate(0deg) translateZ(0);-webkit-transition-duration:0ms;-webkit-animation-name:refreshLoading;-webkit-animation-duration:2s;-webkit-animation-iteration-count:infinite;-webkit-animation-timing-function:linear;}","@-webkit-keyframes refreshLoading {","from { -webkit-transform:rotate(0deg) translateZ(0); }","to { -webkit-transform:rotate(360deg) translateZ(0); }","}","</style>",'<div class="preloader-refresh">','<i class="icon-refresh"></i>',"</div>"].join(""),e=["<style>",".preloader-loading-more {display: block;padding: 15px 10px;text-align:center;}",'.preloader-loading-more:before,.preloader-loading-more:after {content:""}',".preloader-loading-more .loading-bounce, .preloader-loading-more:before, .preloader-loading-more:after {width: 15px;height: 15px;background-color: #04be02;-webkit-border-radius: 100%;border-radius: 100%;display: inline-block; -webkit-animation: bouncedelay 1.4s infinite ease-in-out;animation: bouncedelay 1.4s infinite ease-in-out; -webkit-animation-fill-mode: both;animation-fill-mode: both;}",".preloader-loading-more:before {-webkit-animation-delay: -0.32s;animation-delay: -0.32s;}",".preloader-loading-more .loading-bounce {-webkit-animation-delay: -0.16s;animation-delay: -0.16s;}","@-webkit-keyframes bouncedelay {","0%, 80%, 100% { -webkit-transform: scale(0.0) }","40% { -webkit-transform: scale(1.0) }","}","@keyframes bouncedelay {","0%, 80%, 100% {","transform: scale(0.0);","} 40% {","transform: scale(1.0);","}","}","</style>",'<div class="preloader-loading-more">','<span class="loading-bounce"></span>',"</div>"].join("");this.opts.isRefresh&&(this.$content.before(c),this.$pullToRefresh=a(".preloader-refresh"),this.refreshHeight=this.$pullToRefresh.height()),this.opts.isLoadingMore&&(this.$content.after(e),this.$loadingMore=a(".preloader-loading-more"),this.wrapHeight<d&&this.$loadingMore.hide())},e.prototype.bind=function(){var b=this;this.opts.isRefresh&&this.$wrap.on("touchstart",function(a){b.startX=a.touches[0].pageX,b.startY=a.touches[0].pageY}).on("touchmove",function(c){b.scrollTop=a(this).scrollTop(),b.touchMove(c,a(this))}).on("touchend",function(a){b.touchEnd(a)})},e.prototype.reBindScroll=function(){var a=this,b=null;this.$wrap.off("scroll.refresh").on("scroll.refresh",function(){b=setTimeout(function(){a.getLoadMore()},300)})},e.prototype.touchMove=function(c){var f,g,h,e=a(c.target);if(e.parents(this.opts.contentEl).size())return f=c.touches[0].pageX-this.startX,g=c.touches[0].pageY-this.startY,Math.abs(f)>Math.abs(g)?(this.isPullToRefresh=!1,this.$content[0].style[b.prefixStyle("transform")]="translate(0, 0)"+b.translateZ(),this.$pullToRefresh[0].style[b.prefixStyle("transform")]="translate(0, 0)"+b.translateZ(),void 0):(this.opts.movePosition=g>0?"down":"up",h=g,h=h<this.opts.maxDistanceToRefresh?h:this.opts.maxDistanceToRefresh,h=Math.sin(h/this.opts.maxDistanceToRefresh)*h,this.scrollTop<=this.opts.distanceToRefresh&&"down"===this.opts.movePosition?(g>=this.opts.minDistanceToRefresh?(this.$pullToRefresh.addClass("preloader-refresh-flip"),this.isPullToRefresh=!0):(this.$pullToRefresh.removeClass("preloader-refresh-flip"),this.isPullToRefresh=!1),this.$content[0].style[b.prefixStyle("transform")]="translate(0,"+h+"px)"+b.translateZ(),this.$pullToRefresh[0].style[b.prefixStyle("transform")]="translate(0,"+h+"px)"+b.translateZ(),c.preventDefault(),void 0):(this.isPullToRefresh=!1,void 0))},e.prototype.touchEnd=function(){function d(){c.$pullToRefresh.removeClass("preloader-refresh-loading"),c.wrapHeight=c.$content.height(),c.$content[0].style[b.prefixStyle("transition")]="all .3s",c.$content[0].style[b.prefixStyle("transform")]="translate(0, 0)"+b.translateZ(),c.$pullToRefresh[0].style[b.prefixStyle("transition")]="all .3s",c.$pullToRefresh[0].style[b.prefixStyle("transform")]="translate(0, 0)"+b.translateZ(),c.finished&&(c.finished=!1,c.reBindScroll()),e()}function e(){setTimeout(function(){c.$content[0].style[b.prefixStyle("transition")]="",c.$pullToRefresh[0].style[b.prefixStyle("transition")]=""},500)}var f,g,c=this;return e(),f=(new Date).getTime(),this.opts.interval&&f-this.loadingFinishTime<this.opts.interval?(d(),void 0):(this.loadingFinishTime=f,g=0,this.isPullToRefresh&&(g=this.refreshHeight),this.$content[0].style[b.prefixStyle("transition")]="all .3s",this.$content[0].style[b.prefixStyle("transform")]="translate(0, "+g+"px)"+b.translateZ(),this.$pullToRefresh[0].style[b.prefixStyle("transition")]="all .3s",this.$pullToRefresh[0].style[b.prefixStyle("transform")]="translate(0,"+g+"px)"+b.translateZ(),this.isPullToRefresh&&(this.$pullToRefresh.removeClass("preloader-refresh-flip").addClass("preloader-refresh-loading"),this.opts.refreshCallback&&this.opts.refreshCallback(d),this.isPullToRefresh=!1),void 0)},e.prototype.getLoadMore=function(){function f(b){"finish"==b&&(a.finished=!0,a.$loadingMore.hide(),a.$wrap.off("scroll.refresh")),a.isLoading=!1,a.wrapHeight=a.$content.height()}var b,c,g,a=this;if(!this.finished){if(b=this.$wrap.scrollTop(),c=d+b,this.wrapHeight<=c+10&&this.oldScrollTop<b&&!this.isLoading&&this.opts.isLoadingMore){if(g=(new Date).getTime(),this.opts.interval&&g-this.loadingFinishTime<this.opts.interval)return;this.loadingFinishTime=g,this.$loadingMore.show(),this.isLoading=!0,this.opts.loadingMoreCallback&&this.opts.loadingMoreCallback(f)}this.oldScrollTop=b}},a.fn.refresh=function(b){return this.each(function(){new e(a(this),b)})},e});