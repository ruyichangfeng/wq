{template 'public/header'}

<body onLoad="init_1()">
<div class="ub ub-ver bga page" id="page0">
  <!--pc端头部-->
  <div class="top-head ub-fh ubb ubt b-gra5 us1 c-wh">
    <div class="header">
      <div class="logo ufl"> <img src="images/logo.png" style="height:100%" alt="幸福家政" /> </div>
      <div class="menu ufr ulev-1"> <a href="index.html" class="active">首页</a> <a href="class_list.html">服务项目</a> <a href="problems.html">常见问题</a> <a href="service.html">服务说明</a> <a href="uc-index.html">会员中心</a> </div>
      <div class="clear"></div>
    </div>
    <div class="clear"></div>
  </div>
  <!--pc端头部-->
  
<div class="form_box">
  <div class="bd">
    <div class="ub-f1 tx-c ub-ac ub-pc ub-ver c-wh uinn212 ubb b-bla01">
      <div class="ulev2 t-red1 font-b">{$data['type_name']}</div>
      <div class="ulev-2 t-gra">附近有<font class="t-red1">{$total}</font>个服务商</div>
      <div class="ulev-2 t-red1 umar-t">{$data['remark']}</div>
    </div>
  </div>
  
  <!--表单开始-->
  <form name="form1" action="{php echo $this->createMobileUrl('templateok',array())}" method="post" onSubmit="return checkform()">
  <input type="hidden" name="temp_id" value="{$data['temp_id']}" >
  <input type="hidden" name="serve_type" value="{$data['id']}" >
  <input type="hidden" name="staff_id" value="{$staff_id}" >
        
  <input type="hidden" name="lat" id="lat" value="" >
  <input type="hidden" name="lng" id="lng" value="" >
            
  <div class="weui_cells weui_cells_form">
    
    <div class="weui_cell">
      <div class="weui_cell_hd">
        <label class="weui_label">时间：</label>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="text" name="ftime" id="ftime" onfocus="(this.type='datetime-local')"  placeholder="请输入时间" value="{php echo date('Y-m-d H:i:s',strtotime('+1 hour'))}"  />
      </div>
    </div>
    
    <div class="weui_cell">
      <div class="weui_cell_hd">
        <label class="weui_label">电话：</label>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <input type="tel" name="fmobile" id="fmobile" placeholder="输入联系电话" value="{$members['mobile']}" class="weui_input" />
      </div>
      <div class="weui_cell_ft"> </div>
    </div>
    
    <div class="weui_cell">
      <div class="weui_cell_hd">
        <label class="weui_label">姓名：</label>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="text" name="fname" id="fname" placeholder="输入姓名" value="{$members['realname']}">
      </div>
      <div class="kk-check t-gra">
        <input name="fsex" type="radio" id="hh1" value="2" {if $members['gender'] == 2} checked {/if}>
        <label class="block uinn3 uba b-gra ufl ulev-1 uc-a15 umar-r" for="hh1">女士<i class="iconfont icon-xuanzhong ulev0 t-org"></i></label>
        <input name="fsex" type="radio" id="hh2" value="1" {if $members['gender'] == 1} checked {/if}>
        <label class="block uinn3 uba b-gra ufl ulev-1 uc-a15" for="hh2">先生<i class="iconfont icon-xuanzhong ulev0 t-org"></i></label>
        <div class="clear"></div>
      </div>
    </div>
    
    <input type="hidden" name="fperson" id="fperson" value="1" />
    
  </div>
  
  <div class="weui_cells_title">上传照片</div>
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
      <div class="weui_cell_bd weui_cell_primary">
        <div class="weui_uploader">
          <div class="weui_uploader_bd">
            <ul class="weui_uploader_files" id="pic_show">
              <li class="weui_uploader_file" style="background-image:url({MODULE_URL}static/images/nopic.png)"></li>
          </ul>
            <div class="weui_uploader_input_wrp">
              <div class="weui_uploader_input" name="pic" id="pic" onClick="upload()"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <input type="hidden" id="random" name="random" value="{$random}" >
  
  <div class="weui_cells_title">详细地址</div>
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="text" name="fadr" id="fadr" placeholder="">
      </div>
      <div onClick="openPe()" class="block-in t-gre1" style="">点击<i class="iconfont icon-iconfontsiglyphpinlocation2 ulev1"></i></div>
    </div>
  <div class="weui_cell">
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" type="text" name="flou" id="flou" placeholder="楼栋号和房号">
      </div>
    </div>     
  </div>
  <!--表单结束-->
  <div class="umar-b1 umar-l umar-r umar-t1 pc_btn">
    <!--
    <a href="order_form_2.html" class="weui_btn weui_btn_primary">下一步</a>
    -->
    <input name="submit" type="submit" value="下一步" class="weui_btn weui_btn_primary" />
    <input type="hidden" name="token" value="{$_W['token']}" />  
  </div>
  </form>
</div>
<div class="hbt"></div>
  
  <!--手机端底部-->
  {template 'footer'}
  <!--手机端底部-->
  
  <!--pc端底部-->
  <div class="foot2 ub-fh umar-t1 c-wh">
    <div class=" tx-c uinn8"> 版权信息 </div>
  </div>
  <!--pc端底部-->
</div>

<!--map open-->
<div class="loginmask c-bla80">
  <div class="ub mban ub-ver" style="width:100%; height:100%; top:1500px">
        <div class="closealert ub-f1"></div>
        <!--<div class="" style="position:absolute; top:47px; width:100%; left:0; z-index:99">-->
            <div class="ub">
                <div class="ulev-1 tx-c uinn c-bla50 t-wh ub-f1">请拖动地图选定您需要服务的位置</div>
                <div class="closealert c-gra" style="padding:0.3rem 0.5rem"><i class="iconfont icon-guanbi ulev2 t-gra"></i></div>
            </div>
            <div class="c-org uinn t-wh tx-c ubb b-wh" id="centerDiv_1"></div>
            <div class="c-org uinn t-wh tx-c" id="centerDiv_2"></div>
            <div class="c-wh"  id="container_1" style="height:60%; "></div>
        <!--</div>-->
        <!--
        <div class="c-wh"  id="container_66" style="height:100%; ">
            <iframe id="mapPage" width="100%" height="100%" frameborder=0 src="http://apis.map.qq.com/tools/locpicker?search=1&zoom=16&type=1&key=DEZBZ-EQKKJ-CBFFB-K2SOD-GGNA3-N7BKM&referer=o2o"></iframe>
        </div>
        -->
   </div>
</div>
<!--map end--> 

<!--默认经纬度-->
<input type="hidden" id="lng_v" value="{$lng}">
<input type="hidden" id="lat_v" value="{$lat}">
<!--默认经纬度-->

<script type="text/javascript" src="{MODULE_URL}static/js/jquery-1.10.2.min.js"></script> 
<script type="text/javascript" src="{MODULE_URL}static/js/main.js"></script>
<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&libraries=convertor"></script>
<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

<script type="text/javascript">
$(document).ready(function(){
   getLocation();
});

function getLocation(){
  //判断是否支持 获取本地位置
  if(navigator.geolocation)
  {
    navigator.geolocation.getCurrentPosition(showPosition);
  }else{
    x.innerHTML="浏览器不支持定位.";
  }
}

function showPosition(position) {
  var lat_1 =position.coords.latitude; 
  var lng_1 =position.coords.longitude;
  document.getElementById('lat').value = lat_1;
  document.getElementById('lng').value = lng_1;

  //div容器
  var container_1 = document.getElementById("container_1");
  var centerDiv = document.getElementById("centerDiv_1");
  var centerDiv2 = document.getElementById("centerDiv_2");
  //初始化地图
  var map = new qq.maps.Map(container_1, {
    center: new qq.maps.LatLng(lat_1,lng_1),
    zoom: 16
  });
  //创建自定义控件
  var middleControl = document.createElement("div");
  middleControl.style.left="50%";
  middleControl.style.top="50%";
  middleControl.style.position="relative";
  middleControl.style.width="40px";
  middleControl.style.height="40px";
  middleControl.style.margin="-40px 0 0 -20px";
  middleControl.style.zIndex="100000";
  middleControl.innerHTML ='<img style="height:40px;"  src="{MODULE_URL}/template/mobile/images/dddw.png" />';
  document.getElementById("container_1").appendChild(middleControl);
  //返回地图当前中心点地理坐标
  centerDiv_1.innerHTML = "坐标:" + map.getCenter();
  var geocoder = new qq.maps.Geocoder();
  var latLng = new qq.maps.LatLng(map.getCenter().getLat(), map.getCenter().getLng());
  geocoder.getAddress(latLng);
  geocoder.setComplete(function(result) {
    centerDiv_2.innerHTML = "位置:" + result.detail.address;
    document.getElementById('fadr').value = result.detail.address;
  });
  //当地图中心属性更改时触发事件
  qq.maps.event.addListener(map, 'center_changed', function() {
    centerDiv_1.innerHTML = "坐标:" + map.getCenter();
    var geocoder = new qq.maps.Geocoder();
    var latLng = new qq.maps.LatLng(map.getCenter().getLat(), map.getCenter().getLng());
    geocoder.getAddress(latLng);
    geocoder.setComplete(function(result) {
      centerDiv_2.innerHTML = "位置:" + result.detail.address;
      document.getElementById('fadr').value = result.detail.address;
    });
  });
}

$(document).ready(function(){
   getLocation();
});

//弹出地图层
$(".closealert").click(function() {
   $(".mban").animate({top:'1500px'})
   $(".loginmask").fadeOut(500);
});

function openPe(){
  $(".loginmask").fadeIn(500), $(".mban").animate({top:'0px'});
};

function closePe(){
  $(".mban").animate({top:'1500px'})
   $(".loginmask").fadeOut(500);
};

function checkform(){
  var ftime = document.getElementById('ftime').value;
  var fmobile = document.getElementById('fmobile').value;
  var fname = document.getElementById('fname').value;
  var fadr = document.getElementById('fadr').value;
  var flou = document.getElementById('flou').value;
  
  if(ftime == ''){
    alert('请选择服务时间');
    return false;
  }
  if(fmobile == ''){
    alert('联系电话不能为空');
    return false;
  }
  if(fname == ''){
    alert('姓名不能为空');
  }
  
  if(fadr == ''){
    alert('请点击定位按钮选定您的服务地址');
    return false;
  }
}
</script>

<script type="text/javascript">
  jssdkconfig = {php echo json_encode($_W['account']['jssdkconfig']);} || {};
  
  // 是否启用调试
  jssdkconfig.debug = false;
  
  jssdkconfig.jsApiList = [
    'checkJsApi',
    'chooseImage',
    'previewImage',
    'uploadImage',
    'downloadImage',
    'openLocation',
    'getLocation',
  ];
  
  wx.config(jssdkconfig);
  
  wx.ready(function () {
    
  });
  
  //图片上传
  function upload(){
    wx.chooseImage({
      count: 1, // 默认9
      sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
      sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
      success: function (res) {
        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
        wx.uploadImage({
          localId: ''+localIds+'', // 需要上传的图片的本地ID，由chooseImage接口获得
          isShowProgressTips: 1, // 默认为1，显示进度提示
          success: function (res) {
            var serverId = res.serverId; // 返回图片的服务器端ID
            var suiji = document.getElementById('random').value; 
            
            $.ajax({
              url: "{php echo $this->createMobileUrl('UploadPic', array());}",
              type:"POST",
              data:{"random":suiji,"serverId":serverId},
              dataType:"json",
              success: function(data){
                //alert(data);
                if(data== 0){
                  alert('上传图片失败');
                  return false;
                }else{
                  var pic = "";
                  var getstr = eval(data);
                  for(var i=0;i<getstr.length;i++){
                    pic = pic + '<li class="weui_uploader_file" style="background-image:url({$_W["attachurl"]}gohome/pic/'+getstr[i].pic+')" onclick="delpic('+getstr[i].id+')"></li>';
                  }
                  document.getElementById("pic_show").innerHTML = pic;
                }
              }
            });
          }
        });
      }
    });
  }
  
  function delpic(a){
    if(window.confirm('确定删除该图片吗？')){
      var suiji = document.getElementById('random').value; 
      $.ajax({
        url: "{php echo $this->createMobileUrl('DeletePic', array());}",
        type:"POST",
        data:{"random":suiji,"id":a},
        dataType:"json",
        success: function(data){
          if(data== 0){
            alert('删除图片失败');
            return false;
          }else if(data == 1){
            document.getElementById("pic_show").innerHTML = '';
          }else{
            var pic = "";
            var getstr = eval(data);
            for(var i=0;i<getstr.length;i++){
              pic = pic + '<li class="weui_uploader_file" style="background-image:url({$_W["attachurl"]}gohome/pic/'+getstr[i].pic+')" onclick="delpic('+getstr[i].id+')"></li>';
            }
            document.getElementById("pic_show").innerHTML = pic;
          }
        }
      });
        }else{
      return false;
        }
  }
</script>

</body>
</html>
