{template 'common/header'}
<div class="main" data-send-trans-api="{$resource['urls']['SendTrans']}" data-order-num="{$order['order_num']}">
	<ul class="nav nav-tabs">
		{template 'nav'}
	</ul>
	<div class="panel panel-default">
		<div class="panel-heading">
			订单信息 | 订单号: {$order['order_num']}
		</div>
		<div class="panel-body">
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">订单号码 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{$html['order']['order_num']}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">礼品名称 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{$html['gift']['title']}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">类型 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['gift']['type'] == 1}
							{if $html['gift']['hb_mode'] == 1}
								{$html['gift']['hb_amount']}元红包
							{elseif $html['gift']['hb_mode'] == 2}
								{$html['gift']['hb_random_min']}~{$html['gift']['hb_random_max']}元随机红包
							{/if}
						{/if}

						{if $html['gift']['type'] == 2}
						虚拟卡密/优惠券等
						{/if}
						{if $html['gift']['type'] == 3}
						邮寄礼品
						{/if}
						{if $html['gift']['type'] == 4}
						自领礼品（需要用户前往指定地点领取）
						{/if}
						{if $html['gift']['type'] == 5}
						{$html['gift']['hf_amount']}元话费
						{/if}
						{if $html['gift']['type'] == 6}
						{$html['gift']['ll_amount']}M流量
						{/if}
						{if $html['gift']['type'] == 7}
						{$html['gift']['raffle_score_amount']}积分奖励
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">价格 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['gift']['buy_type'] == 1 || $html['gift']['buy_type'] == 3}
					<span class="label label-primary">{$html['gift']['score']} {if $this->module['config']['score_name']}{php echo $this->module['config']['score_name']}{else}积分{/if}	</span>
					{/if}
					{if $html['gift']['buy_type'] == 2 || $html['gift']['buy_type'] == 3}
					<span class="label label-success">{$html['gift']['money']} 元</span>
					{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">用户已支付 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['buy_type'] == 1 || $html['order']['buy_type'] == 3}
						<span class="label label-primary">{$html['order']['order_score']} {if $this->module['config']['score_name']}{php echo $this->module['config']['score_name']}{else}积分{/if}</span>
						{/if}
						{if $html['order']['buy_type'] == 2 || $html['order']['buy_type'] == 3}
						<span class="label label-success">{$html['order']['order_money']} 元</span>
						{if $html['order']['pay_status'] == 0}
						<span class="label label-danger">未支付</span>
						{elseif $html['order']['pay_status'] == 1}
						<span class="label label-primary">已支付</span>
						{/if}
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">订单状态 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						<span class="label label-success">{$module_config['order']['status'][$html['order']['status']]}</span>
						{if $html['order']['type'] == 1}
						<span class="label label-danger">{$module_config['order']['hb_status'][$html['order']['hb_status']]}</span>
						{/if}
						{if $html['order']['type'] == 3}
						<span class="label label-primary">{$module_config['order']['trans_status'][$html['order']['trans_status']]}</span>
						{/if}
						{if $html['order']['type'] == 4}
						<span class="label label-warning">{$module_config['order']['zl_status'][$html['order']['zl_status']]}</span>
						{/if}
						{if $html['order']['type'] == 5}
						<span class="label label-primary">{$module_config['order']['hf_status'][$html['order']['hf_status']]}</span>
						{/if}
						{if $html['order']['type'] == 6}
						<span class="label label-primary">{$module_config['order']['hf_status'][$html['order']['hf_status']]}</span>
						{/if}
					</p>
				</div>
			</div>

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">购买方式 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['buy_type'] == 1}
						<span class="label label-danger">积分</span>
						{/if}
						{if $html['order']['buy_type'] == 2}
						<span class="label label-primary">现金</span>
						{/if}
						{if $html['order']['buy_type'] == 3}
						<span class="label label-danger">积分</span>+<span class="label label-primary">现金</span>
						{/if}
					</p>
				</div>
			</div>

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">下单日期 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">{php echo date("Y-m-d H:i:s",$order['create_time'])}</p>
				</div>
			</div>

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">订单异常备注 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">{$html['order']['remark']}{if $html['order']['abnormal']}<span class="label label-danger">异常订单</span>{/if}</p>
				</div>
			</div>
		</div>
	</div>
	{if $html['order']['trans_fee'] >= 0 && $html['order']['type'] == 3}
	<div class="panel panel-default">
		<div class="panel-heading">
			快递相关
		</div>
		<div class="panel-body">

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">运费 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						<span class="label label-success">{$html['order']['trans_fee']} 元</span>
						{if $html['order']['trans_fee_status'] == 1}
						<span class="label label-danger">未支付</span>
						{elseif $html['order']['trans_fee_status'] == 2}
						<span class="label label-primary">已支付</span>
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">快递公司 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['trans_company']}
						{$html['order']['trans_company']}
						{else}
						<div class="row">
							<div class="col-lg-6">
								<div class="input-group">
									<input type="text" name="trans_company_input" class="form-control" placeholder="请输入快递公司名称">
								</div><!-- /input-group -->
							</div><!-- /.col-lg-6 -->
						</div><!-- /.row -->
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">运单号码 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['trans_num']}
						{$html['order']['trans_num']}
						{else}
						<div class="row">
							<div class="col-lg-6">
								<div class="input-group">
									<input type="text" name="trans_num_input" class="form-control" placeholder="请输入运单号码">
									  <span class="input-group-btn">
										<button id="trans-send-submit" class="btn btn-default" type="button">点击发货</button>
									  </span>
								</div><!-- /input-group -->
							</div><!-- /.col-lg-6 -->
						</div><!-- /.row -->
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">快递状态 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['trans_status'] == 0}
						<span class="label label-danger">未发货</span>
						{elseif $html['order']['trans_status'] == 1}
						<span class="label label-primary">已发货</span>
						{elseif $html['order']['trans_status'] == 2}
						<span class="label label-success">已确认收货</span>
						{else}
						未知
						{/if}
					</p>
				</div>
			</div>

		</div>
	</div>
	{/if}
	{if $html['order']['type'] == 2}
	<div class="panel panel-default">
		<div class="panel-heading">
			虚拟卡密相关
		</div>
		<div class="panel-body">

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">发放状态 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['order']['quan_status'] == 1}
						<span class="label label-danger">未发</span>
						{else}
						<span class="label label-primary">已发</span>
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">券号 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['quan']['hao']}
						{$html['quan']['hao']}
						{else}
						未发券
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">券密码 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['quan']['value']}
						{$html['quan']['value']}
						{else}
						未发券
						{/if}
					</p>
				</div>
			</div>
		</div>
	</div>
	{/if}
	<div class="panel panel-default">
		<div class="panel-heading">
			用户信息
		</div>
		<div class="panel-body">

			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">昵称 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{$html['user']['nickname']}&nbsp;&nbsp;({$html['user']['openid']})
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">收货人名称 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['address']['name']}
						{$html['address']['name']}
						{else}
						无
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">地址 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{$html['address']['province']}&nbsp;{$html['address']['city']}&nbsp;{$html['address']['area']}&nbsp;{$html['address']['address']}&nbsp;
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">手机号码 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['address']['mobile']}
						{$html['address']['mobile']}
						{else}
						无
						{/if}
					</p>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">备注 :</label>
				<div class="col-sm-9 col-xs-12">
					<p class="form-control-static">
						{if $html['address']['remark']}
						{$html['address']['remark']}
						{else}
						无
						{/if}
					</p>
				</div>
			</div>
		</div>
	</div>
	<a id="access" href="javascript:void(0);" class="btn btn-success btn-sm opt-gift-order" data-id="{$o['id']}" data-url="{$resource['urls']['AccessOrder']}&order_num={$html['order']['order_num']}" {if $html['order']['status'] != 0 ||( $html['order']['raffle'] >=1 && $html['order']['raffle_status'] == 0)}disabled="disabled"{/if}><i class="glyphicon glyphicon-ok"> 通过</i></a>
	<a id="refuse" href="javascript:void(0);" class="btn btn-danger btn-sm refuse-button" data-id="{$o['id']}" data-order-num="{$o['order_num']}" data-url="{$resource['urls']['RefuseOrder']}&order_num={$html['order']['order_num']}" {if $html['order']['status'] != 0 ||( $html['order']['raffle'] >=1 && $html['order']['raffle_status'] == 0)}disabled="disabled"{/if}><i class="glyphicon glyphicon-remove"> 拒绝</i></a>
</div>
<script type="text/javascript">
	$(function(){

		$("#access").on("click", function () {
			var url = $(this).data("url");
			$.get(url, function (res) {
				var json = JSON.parse(res);
				if(json.status == 200){
					window.location.reload();
				}else{
					util.message(json.message);
				}
			})
		});
		$("#refuse").on("click", function () {
			var url = $(this).data("url");
			$.get(url, function (res) {
				var json = JSON.parse(res);
				if(json.status == 200){
					window.location.reload();
				}else{
					util.message(json.message);
				}
			})
		});
		$("#trans-send-submit").on("click", function () {
			var transCompany = $("input[name=trans_company_input]").val();
			var transNum = $("input[name=trans_num_input]").val();
			if(null == transCompany || transCompany == undefined || transCompany == ""){
				util.message("快递公司名称不能为空");
				return;
			}
			if(null == transNum || transNum == undefined || transNum == ""){
				util.message("运单号不能为空");
				return;
			}
			//var url = $("div.main").data("send-trans-api");
			var url = "{$resource['urls']['SendTrans']}";
			var data = {
				trans_num : transNum,
				company : transCompany,
				order_num : "{$order['order_num']}"
			};

			$.post(url,data, function (res) {
				var json = JSON.parse(res);
				if(json.status == 200){
					window.location.reload();
				}else{
					alert(json.message);
				}

			});
		});
	});
</script>
{template 'common/footer'}