!function(t){t.mobileTimetable=function(){function a(){var t,a=f.val();t=m?d(a,7,"subtract"):d(a,1,"subtract"),n(t)}function e(){var t,a=f.val();t=m?d(a,7,"add"):d(a,1,"add"),n(t)}function i(a){var e=f.val();e=o(e),moment(e,t.urp.config.dateISO8601Format).isValid()&&(w.val(a),f.val(e),v.submit())}function n(a){if(moment(a,t.urp.config.dateISO8601Format).isValid()){var e=o(y.val()),i=o(g.val());a>=e&&a<=i&&(f.val(a),v.submit())}}function o(a){var e=moment(a,t.urp.config.dateFormat);return moment(e).format(t.urp.config.dateISO8601Format)}function c(a){var e,i={},n=F.val();e=a?"<br>":"\n","FACULTY"==n?t(".table-timetable tbody > tr").each(function(a,n){a>0&&t(this).find("td").each(function(a,n){if(a>0){var o=t(n).html();if(o=o.trim(),""!=o&&o.indexOf(e)>0){o=o.split(e)[1];var c;void 0!=i[o]?c=i[o]:(c=l(),C[c]+=1,i[o]=c),t(n).addClass("color-"+c),t(n).css("color","#FFFFFF")}}})}):"STUDENT"==n&&(a?t(".table-timetable tbody > tr:nth-child(1) > td").each(function(a,e){if(t(e).find(".current-date").length>0){var n=a+1;t(".table-timetable tbody > tr > td:nth-child("+n+")").each(function(a,e){if(a>0){var n=t(e).html();if(n=n.trim(),""!=n&&n.length>0){var o;void 0!=i[n]?o=i[n]:(o=l(),C[o]+=1,i[n]=o),t(e).addClass("color-"+o),t(e).css("color","#FFFFFF")}}})}}):t(".table-daily-timetable thead tr>th").css({color:"#333333"}))}function l(){for(var t=999999,a=0,e=0;e<19;++e)t>C[e]&&(t=C[e],a=e);return a}function r(t){t?(u.show(),s.hide(),p.val("WEEK"),b.addClass("active"),h.removeClass("active"),m=!0,c(!0)):(u.hide(),s.show(),p.val("DAY"),b.removeClass("active"),h.addClass("active"),m=!1,c(!1))}function d(a,e,i){var n=moment(a,t.urp.config.dateFormat);return"add"==i?(n.add(e,"days"),moment(n).format(t.urp.config.dateISO8601Format)):"subtract"==i?(n.subtract(e,"days"),moment(n).format(t.urp.config.dateISO8601Format)):0}var f,u,s,m,v,b,h,p,F,w,y,g,T,C={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0},k=function(){p=t("#type"),f=t("#checkedDate"),u=t("#weeklyTimetable"),s=t("#dailyTimetable"),b=t(".btn-weekly-timetable"),h=t(".btn-daily-timetable"),m=!!b.hasClass("active"),v=t("#searchTimetable"),F=t("#role"),w=t("#subjectId"),y=t("#termStart"),g=t("#termEnd"),T=t(".timetable-field"),r(m),b.on("click",function(){p.val("WEEK"),n(o(f.val()))}),h.on("click",function(){p.val("DAY"),n(o(f.val()))}),t("#preTimetable").on("click",function(){a()}),t("#nextTimetable").on("click",function(){e()});var c=t(".time-timetable");c.bind("touchmove",function(t){t.preventDefault()}),c.swipeLeft(function(){e()}).swipeRight(function(){a()}),T.bind("swipeLeft swipeRight",function(){"swipeLeft"==event.type?e():"swipeRight"==event.type&&a()});var l=t(".switch-subject");l.bind("tap",function(t){t.cancelTouch()});var d=t(".switch-subject-modal");l.tap(function(){d.showModal()}),d.find(".subject").each(function(a,e){var n=t(e);n.bind("touchmove",function(t){t.preventDefault()}),n.tap(function(){if(t(this).hasClass("active"))d.hideModal();else{var a=t(this).find("input").val();i(a)}})})};return{init:k}}()}(Zepto);