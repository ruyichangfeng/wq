<include file="Public/header.html"/>
</head>
<body style="overflow-x:hidden">
	
<div class="x-nav">
    <span class="layui-breadcrumb">
      <a><cite>首页</cite></a>
      <a><cite>系统设置</cite></a>
      <a><cite>系统设置</cite></a>
    </span>
   <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right;height:30px;padding: 0 15px;"  href="javascript:location.replace(location.href);" title="刷新"><i class="layui-icon" style="line-height:30px">ဂ</i></a>
</div>

<form class="layui-form" >
<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief" style="margin-left: 15px;">
  <ul class="layui-tab-title">
    <li class="layui-this">   	
    	<a target="_self" href="{:U('Home/MainCtr/System/system_list')}">网站设置</a>
    </li>
    <li>
    	<a target="_self" href="{:U('Home/MainCtr/System/pic_list')}">图片设置</a>
    </li>
  </ul>
  <div class="layui-tab-content" style="height: 100px;">
  	
    <div class="layui-tab-item layui-show">
    	
	   <div class="layui-form layui-form-pane" >	 		
	   	   	<div class=" layui-form-item">
			      <label class="layui-form-label">PC后端名称</label>
			      <div class="layui-input-block">
			       	  <input type="text" name="p_name" autocomplete="off" placeholder="如  xx后台管理系统" value="{$system['p_name']}" class="layui-input">
			      </div>
		   	</div>
		   
		    <div class=" layui-form-item">
		      <label class="layui-form-label">手机端名称</label>
		      <div class="layui-input-block">
		         <input type="text" name="m_name" autocomplete="off" placeholder="如 某某竞拍" value="{$system['m_name']}" class="layui-input">
		      </div>
		    </div>
		 
		  	<div class=" layui-form-item">
		      	<label class="layui-form-label">网站图标</label>
		      	<div class="layui-input-block">
		      	  	<button type="button" class="layui-btn" onclick="$('#wztb').click();">
				     	<i class="layui-icon">&#xe67c;</i>上传图片
				 	</button>
				  	<input style="display: none;" type="file" id="wztb"  onchange="previewImage(this,1,'wztb_val')"   multiple  class="input-file">
                <div>
                   	<img id="imghead1" border="0"  style="margin-top: 5px;max-height:50px;"                   	
                   	<?php 
                   	   	if( empty($system['wztb']) ){
                   	   	   	echo 'src="__ROOT__/Public/images/z_add.png"   onclick="$(\'#wztb\').click();"';
                   	   	}else{
                   	       	echo 'src="__ROOT__/Uploads/'.$system['wztb'].'"';
                   	   	}
                    ?>
                   >
		      	</div>
		   		<br/>
		 	</div>
		  
		  	<div class="layui-form-item">
		    	<label class="layui-form-label">底部版权</label>
		    	<div class="layui-input-block">
		      		<input type="text" name="copyright" autocomplete="off" placeholder="xx公司版权所有" value="{$system['copyright']}" class="layui-input">
		    	</div>
		  	</div>
		  
		  	<div class="layui-form-item">
		    	<label class="layui-form-label">网站备案号</label>
		    	<div class="layui-input-block">
		      		<input type="text" name="wzbah" autocomplete="off" placeholder="湘ICP备xx号" value="{$system['wzbah']}" class="layui-input">
		    	</div>
		  	</div>
		  
		    <div class="layui-form-item">
		      	<label class="layui-form-label">联系方式</label>
		      	<div class="layui-input-block">
		        	<input type="text" name="lxfs" autocomplete="off" placeholder="用于显示底部 " value="{$system['lxfs']}" class="layui-input">
		      	</div>
		    </div>
		    
		    <fieldset>
				<legend>短信启用设置</legend>
				<div class="layui-form-item" pane="">
				    <label class="layui-form-label">短信验证方法</label>
				    <div class="layui-input-block">
			    	   	<input type="radio" name="sms_type" value="1" title="极速短信" <?php if($system['sms_type']==1){ echo 'checked';} ?> >
	      				<input type="radio" name="sms_type" value="2" title="阿里大鱼" <?php if($system['sms_type']==2){ echo 'checked';} ?> >   
	      				<input type="radio" name="sms_type" value="3" title="新版阿里大鱼" <?php if($system['sms_type']==3){ echo 'checked';} ?> >	
	      				<input type="radio" name="sms_type" value="0" title="关闭" <?php if($system['sms_type']==0){ echo 'checked';} ?> >  				
					</div>	
			   	</div>
		 	</fieldset> 
	 		
	 		<fieldset>
				<legend>阿里云物流参数设置</legend>
				<div class=" layui-form-item">
			      	<label class="layui-form-label">AppCode</label>
			      	<div class="layui-input-block">
			       	  	<input type="text" name="appcode" autocomplete="off" placeholder="" value="{$logistics['appcode']}" class="layui-input">
			      		<span>链接地址：<a href="https://market.aliyun.com/products/57126001/cmapi011120.html#sku=yuncode512000008">https://market.aliyun.com/products/57126001/cmapi011120.html#sku=yuncode512000008</a></span>
			      	</div>
		   		</div>
		 	</fieldset> 
		 	
		 	<fieldset>
				<legend>自动下一期</legend>
				<div class="layui-form-item" pane="">
				   <label class="layui-form-label">是否开启</label>
				    <div class="layui-input-block">
				      	<input type="checkbox" name="qs_is_ok" value="1" lay-skin="switch" lay-text="ON|OFF" <?php if($bomb['qs_is_ok']==1){echo 'checked="checked"';}?>> 
				      	<span style="color: red; font-size: 12px;font-weight:bold;margin-left: 20px;">
						   	开启后，每次结算后自动下一期
						</span>							
				    </div>
				    
				</div>
		 	</fieldset> 
		 	
		 	<fieldset>
				<legend>自动出价</legend>
				<div class="layui-form-item" pane="">
				   <label class="layui-form-label">是否开启</label>
				    <div class="layui-input-block">
				      	<input type="checkbox" name="zdcj_is_ok" value="1" lay-skin="switch" lay-text="ON|OFF" <?php if($bomb['zdcj_is_ok']==1 || empty($bomb['zdcj_is_ok'])){echo 'checked="checked"';}?>> 
				      	<span style="color: red; font-size: 12px;font-weight:bold;margin-left: 20px;">
						   	关闭后，自动出价功能将无法使用
						</span>							
				    </div>				    
				</div>
		 	</fieldset> 

		 	<fieldset>
				<legend>首页导航图</legend>
				<div class="layui-form-item" pane="">
				   <label class="layui-form-label">是否开启</label>
				    <div class="layui-input-block">
				      	<input type="checkbox" name="indexpic_is_ok" value="1" lay-skin="switch" lay-text="ON|OFF" <?php if($bomb['indexpic_is_ok']==1 || empty($bomb['indexpic_is_ok'])){echo 'checked="checked"';}?>> 
				      	<span style="color: red; font-size: 12px;font-weight:bold;margin-left: 20px;">
						   	关闭后，前台首页导航图将不再显示
						</span>							
				    </div>				    
				</div>
		 	</fieldset>
		 	
		 	<fieldset>
				<legend>首页关注公众号设置</legend>
				<div class="layui-form-item" pane="">
				   	<label class="layui-form-label">是否开启</label>
				    <div class="layui-input-block">
				      	<input type="checkbox" name="gz_is_ok" value="1" lay-skin="switch" lay-text="ON|OFF" <?php if($gz['gz_is_ok']==1){echo 'checked="checked"';}?>> 
				      	<span style="color: red; font-size: 12px;font-weight:bold;margin-left: 20px;">
						   	关闭后，前台首页关注公众号悬浮框不再显示
						</span>							
				    </div>				    
				</div>
				<div class=" layui-form-item">
			      	<label class="layui-form-label">文字一</label>
			      	<div class="layui-input-block">
			       	  	<input type="text" name="gzwz_one" autocomplete="off" placeholder="" value="{$gz['gzwz_one']}" class="layui-input">	
			       	  	<span style="color: red; font-size: 12px;font-weight:bold;">
						   	关注按钮左侧文字
						</span>		
			      	</div>			      	
		   		</div>
				<div class=" layui-form-item">
			      	<label class="layui-form-label">文字二</label>
			      	<div class="layui-input-block">
			       	  	<input type="text" name="gzwz_two" autocomplete="off" placeholder="" value="{$gz['gzwz_two']}" class="layui-input">	
			       	  	<span style="color: red; font-size: 12px;font-weight:bold;">
						   	二维码顶部位置
						</span>		
			      	</div>			      	
		   		</div>
				<div class=" layui-form-item">
			      	<label class="layui-form-label">关注二维码</label>
			      	<div class="layui-input-block">
			      	  	<button type="button" class="layui-btn" onclick="$('#ewm').click();">
					     	<i class="layui-icon">&#xe67c;</i>上传图片
					 	</button>
					  	<input style="display: none;" type="file" id="ewm"  onchange="previewImage(this,2,'ewm_val')"   multiple  class="input-file">
	                <div>
	                   	<img id="imghead2" border="0"  style="margin-top: 5px;max-height:100px;"                   	
	                   	<?php 
	                   	   	if( empty($gz['ewm']) ){
	                   	   	   	echo 'src="__ROOT__/Public/images/z_add.png"   onclick="$(\'#ewm\').click();"';
	                   	   	}else{
	                   	       	echo 'src="__ROOT__/Uploads/'.$gz['ewm'].'"';
	                   	   	}
	                    ?>
	                   >
			      	</div>
			   		<br/>
			 	</div>			
		 	</fieldset>
		 	
		 	<fieldset>
				<legend>微信防封设置</legend>
				<div class="layui-form-item" pane="">
				    <label class="layui-form-label">开关</label>
				    <div class="layui-input-block">
				      	<input type="checkbox" name="bomb_is_ok" value="1" lay-skin="switch" lay-text="ON|OFF" <?php if($bomb['bomb_is_ok']==1){echo 'checked="checked"';}?>> 
				      	<span style="color: red; font-size: 12px;font-weight:bold;margin-left: 20px;">
						   	开启开关后，不是通过邀请链接进入的微信用户无法完成注册
						</span>							
				    </div>				    
				</div>
				
				<div class="layui-form-item" pane="">
				    <label class="layui-form-label">处理方式</label>
				    <div class="layui-input-block">
			    	   	<input type="radio" name="bomb_type" value="1" title="内部页面弹框" <?php if($bomb['bomb_type']==1){ echo 'checked';} ?> >
	      				<input type="radio" name="bomb_type" value="2" title="跳转外部链接" <?php if($bomb['bomb_type']==2){ echo 'checked';} ?> >	
	      				<span style="color: red; font-size: 12px;font-weight:bold;">
						   	开启开关后，不是通过邀请链接进入的微信用户会弹框提示或者跳转自定义url链接
						</span>		
					</div>	
			   	</div>
				<div class=" layui-form-item">
			      	<label class="layui-form-label">链接地址</label>
			      	<div class="layui-input-block">
			       	  	<input type="text" name="bomb_url" autocomplete="off" placeholder="" value="{$bomb['bomb_url']}" class="layui-input">	
			       	  	<span style="color: red; font-size: 12px;font-weight:bold;">
						   	如需跳转外部链接请填写该url
						</span>		
			      	</div>			      	
		   		</div>				
		 	</fieldset> 
		 	
		 	
		 	
		 	
		 	
		 	<fieldset >
 		 		<legend >微信模版推送配置</legend>
 		 		<div class="layui-form-item">
				    <label class="layui-form-label">充值凭证模板id</label>
				    <div class="layui-input-block">
				    	<input class="layui-input" placeholder='充值凭证通知模板id'  name="czpztp_id" value="{$tp['czpztp_id']}"   />
				    	<span style="color: red; font-size: 12px;font-weight:bold">
					   	编号：OPENTM410975154        标题：充值凭证通知       行业：IT科技 - 互联网|电子商务
					   </span>
					</div>	
			  	</div>
			  	
				<div class="layui-form-item">
				    <label class="layui-form-label">支付成功模板id</label>
				    <div class="layui-input-block">
				    	<input class="layui-input" placeholder='支付成功推送模板id'  name="zftp_id" value="{$tp['zftp_id']}"   />
				    	<span style="color: red; font-size: 12px;font-weight:bold">
					   	编号：OPENTM410462851        标题：支付成功提醒       行业：IT科技 - 互联网|电子商务
					   </span>
					</div>	
			  	</div>
			  	
			  	<div class="layui-form-item">
				    <label class="layui-form-label">订单发货模板id</label>
				    <div class="layui-input-block">
				    	<input class="layui-input" placeholder='订单发货模板id'  name="ddfhtp_id" value="{$tp['ddfhtp_id']}"   />
				    	<span style="color: red; font-size: 12px;font-weight:bold">
					   	编号：OPENTM410090504        标题：订单发货通知       行业：IT科技 - 互联网|电子商务
					   </span>
					</div>	
			  	</div>
			  	
			  	<div class="layui-form-item">
				    <label class="layui-form-label">竞拍成功模板id</label>
				    <div class="layui-input-block">
				    	<input class="layui-input" placeholder='竞拍成功模板id'  name="jpcgtp_id" value="{$tp['jpcgtp_id']}"   />
				    	<span style="color: red; font-size: 12px;font-weight:bold">
					   	编号：OPENTM408636375        标题：竞拍成功提醒       行业：IT科技 - 互联网|电子商务
					   </span>
					</div>	
			  	</div>
	   		</fieldset> 
	   		
		</div>
    </div>        
  	<input type="hidden"  id="wztb_val"  value="" >
  	<input type="hidden"  id="ewm_val"  value="" >
  	<input type="hidden"  name="oauth_url" value="{$system['oauth_url']}" />
  	<input type="hidden"  name="ym" value="{$system['ym']}" /> 
  	<div class="layui-form-item">  
  		<br/><br/> 
   	 	<div class="layui-input-block" style="text-align: center;">
      		<button class="layui-btn"  lay-submit="" lay-filter="subfrom" >立即提交</button>
    	</div>
  	</div>
  
   </div> 
  </div>  
</form>
<script type="text/javascript" src="__ROOT__/Public/js/jquery.min.js"></script>
<include file="Public/footer.html"/>
<script type="text/javascript" src="__ROOT__/Public/js/tools.js"></script> 
<script>	
layui.use(['form', 'laydate','element','layer'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,laydate = layui.laydate
   
   form.on('submit(subfrom)', function(data){
   		  
     	var tjing = layer.msg('提交中...', {icon: 16,shade: 0.3,time: 60*1000}); 
        var form=document.forms[0];
	    var formData = new FormData(form); 
	    
	   if($("#wztb_val").val()!=''){
	      formData.append("wztb",convertBase64UrlToBlob($("#wztb_val").val()));
		} 
		
		if($("#ewm_val").val()!=''){
	      formData.append("ewm",convertBase64UrlToBlob($("#ewm_val").val()));
		} 
		
		$.ajax({
	        url: "{:U('Home/MainCtr/System/dosystem')}",
	        type : "POST",
	        data :formData,
	        dataType:"text",
	        processData : false,         
	        contentType : false,      
	        success:function(data){
	           layer.close(tjing);
               if(data == '1'){
              	 var index = layer.getFrameIndex(window.name);
                 layer.msg('提交成功', {icon: 1,offset: '40%',time:2000,shade: 0.3},function(){ 
			       location.reload();
				 })
               }else if(data == '2'){
              	 layer.msg('提交失败', {icon: 2,offset: '40%',time:2000,shade: 0.3});
               }else{
              	 layer.msg(data, {icon: 2,offset: '40%',time:2000,shade: 0.3});
               }
	        }
	    });
 
    return false;
  });
  
  
});
    
  function convertBase64UrlToBlob(urlData){
	    var bytes=window.atob(urlData.split(',')[1]);    
	    var ab = new ArrayBuffer(bytes.length);
	    var ia = new Uint8Array(ab);
	    for (var i = 0; i < bytes.length; i++) {
	        ia[i] = bytes.charCodeAt(i);
	    }
	    return new Blob( [ab] , {type : 'image/jpg'});
    }
    
	function previewImage(file,flag,ob){
		
	     var img =$('#imghead'+flag);
	     var oFile = file.files[0]; 
	    
	     if(!new RegExp("(jpg|jpeg|png)+","gi").test(oFile.type)){  
	          layer.msg("图片上传：文件类型必须是JPG、JPEG、PNG", {icon: 2,offset: '40%',time:2000,shade: 0.3});
	          return;  
	     }
	     var reader = new FileReader();  
	     var tjing =  layer.msg('图片加载中', {icon: 16,shade: 0.3,time: 60*1000});
	     reader.onload = function(e) {  
	        var base64Img= e.target.result;
	        var _ir=ImageResizer({  
	        resizeMode:"auto"  
	        ,dataSource:base64Img  
	        ,dataSourceType:"base64"  
	        ,maxWidth:1200   
	        ,maxHeight:1200 
	        ,onTmpImgGenerate:function(img){ }   
	        ,success:function(resizeImgBase64,canvas){
			layer.close(tjing);
			img.attr("src",resizeImgBase64);  
		    $('#'+ob).val(resizeImgBase64.substr(22));
			
	        },debug:false});            
	     };  
	     reader.readAsDataURL(oFile);  
   }
</script>

</body>
</html>